<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 3 章 数据操作手 | 数据可视化与R语言</title>
  <meta name="description" content="数据操作、数据分析、数据建模和数据可视化" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="第 3 章 数据操作手 | 数据可视化与R语言" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://bookdown.org/xiangyun/RGraphics/" />
  
  <meta property="og:description" content="数据操作、数据分析、数据建模和数据可视化" />
  <meta name="github-repo" content="XiangyunHuang/RGraphics" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 3 章 数据操作手 | 数据可视化与R语言" />
  
  <meta name="twitter:description" content="数据操作、数据分析、数据建模和数据可视化" />
  

<meta name="author" content="黄湘云" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dm-import-export.html">
<link rel="next" href="dm-dplyr.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">数据可视化与R语言</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>欢迎</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-r"><i class="fa fa-check"></i>Why R</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-read-this-book"><i class="fa fa-check"></i>目标读者</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#Getting-Help-with-R"><i class="fa fa-check"></i>获取帮助</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#history-of-r"><i class="fa fa-check"></i>发展历史</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions"><i class="fa fa-check"></i>记号约定</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#session-info"><i class="fa fa-check"></i>运行环境</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>前言</a><ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#what-talk-about"><i class="fa fa-check"></i>关于本书</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#structure-of-book"><i class="fa fa-check"></i>本书结构</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#about-author"><i class="fa fa-check"></i>关于作者</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="setup-startup.html"><a href="setup-startup.html"><i class="fa fa-check"></i><b>1</b> 安装与配置</a><ul>
<li class="chapter" data-level="1.1" data-path="setup-startup.html"><a href="setup-startup.html#repo-install"><i class="fa fa-check"></i><b>1.1</b> 仓库安装</a><ul>
<li class="chapter" data-level="1.1.1" data-path="setup-startup.html"><a href="setup-startup.html#ubuntu"><i class="fa fa-check"></i><b>1.1.1</b> Ubuntu</a></li>
<li class="chapter" data-level="1.1.2" data-path="setup-startup.html"><a href="setup-startup.html#centos"><i class="fa fa-check"></i><b>1.1.2</b> CentOS</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="setup-startup.html"><a href="setup-startup.html#source-install"><i class="fa fa-check"></i><b>1.2</b> 源码安装</a><ul>
<li class="chapter" data-level="1.2.1" data-path="setup-startup.html"><a href="setup-startup.html#ubuntu-1"><i class="fa fa-check"></i><b>1.2.1</b> Ubuntu</a></li>
<li class="chapter" data-level="1.2.2" data-path="setup-startup.html"><a href="setup-startup.html#centos-1"><i class="fa fa-check"></i><b>1.2.2</b> CentOS</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="setup-startup.html"><a href="setup-startup.html#ninja-install"><i class="fa fa-check"></i><b>1.3</b> 忍者安装</a></li>
<li class="chapter" data-level="1.4" data-path="setup-startup.html"><a href="setup-startup.html#settings"><i class="fa fa-check"></i><b>1.4</b> 配置</a><ul>
<li class="chapter" data-level="1.4.1" data-path="setup-startup.html"><a href="setup-startup.html#init-session"><i class="fa fa-check"></i><b>1.4.1</b> 初始会话 <code>.Rprofile</code></a></li>
<li class="chapter" data-level="1.4.2" data-path="setup-startup.html"><a href="setup-startup.html#environ-vars"><i class="fa fa-check"></i><b>1.4.2</b> 环境变量 <code>.Renviron</code></a></li>
<li class="chapter" data-level="1.4.3" data-path="setup-startup.html"><a href="setup-startup.html#make-vars"><i class="fa fa-check"></i><b>1.4.3</b> 编译选项 <code>Makevars</code></a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="setup-startup.html"><a href="setup-startup.html#command-line-arguments"><i class="fa fa-check"></i><b>1.5</b> 命令行参数</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="dm-import-export.html"><a href="dm-import-export.html"><i class="fa fa-check"></i><b>2</b> 数据搬运工</a><ul>
<li class="chapter" data-level="2.1" data-path="dm-import-export.html"><a href="dm-import-export.html#import-data"><i class="fa fa-check"></i><b>2.1</b> 导入数据</a><ul>
<li class="chapter" data-level="2.1.1" data-path="dm-import-export.html"><a href="dm-import-export.html#scan-file"><i class="fa fa-check"></i><b>2.1.1</b> <code>scan</code></a></li>
<li class="chapter" data-level="2.1.2" data-path="dm-import-export.html"><a href="dm-import-export.html#read-write-table"><i class="fa fa-check"></i><b>2.1.2</b> <code>read.table</code></a></li>
<li class="chapter" data-level="2.1.3" data-path="dm-import-export.html"><a href="dm-import-export.html#read-write-lines"><i class="fa fa-check"></i><b>2.1.3</b> <code>readLines</code></a></li>
<li class="chapter" data-level="2.1.4" data-path="dm-import-export.html"><a href="dm-import-export.html#read-save-rds"><i class="fa fa-check"></i><b>2.1.4</b> <code>readRDS</code></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="dm-import-export.html"><a href="dm-import-export.html#other-data-source"><i class="fa fa-check"></i><b>2.2</b> 其它数据格式</a></li>
<li class="chapter" data-level="2.3" data-path="dm-import-export.html"><a href="dm-import-export.html#import-large-dataset"><i class="fa fa-check"></i><b>2.3</b> 导入大数据集</a></li>
<li class="chapter" data-level="2.4" data-path="dm-import-export.html"><a href="dm-import-export.html#import-data-from-database"><i class="fa fa-check"></i><b>2.4</b> 从数据库导入</a><ul>
<li class="chapter" data-level="2.4.1" data-path="dm-import-export.html"><a href="dm-import-export.html#postgresql"><i class="fa fa-check"></i><b>2.4.1</b> PostgreSQL</a></li>
<li class="chapter" data-level="2.4.2" data-path="dm-import-export.html"><a href="dm-import-export.html#mysql"><i class="fa fa-check"></i><b>2.4.2</b> MySQL</a></li>
<li class="chapter" data-level="2.4.3" data-path="dm-import-export.html"><a href="dm-import-export.html#spark"><i class="fa fa-check"></i><b>2.4.3</b> Spark</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="dm-import-export.html"><a href="dm-import-export.html#batch-import-data"><i class="fa fa-check"></i><b>2.5</b> 批量导入数据</a></li>
<li class="chapter" data-level="2.6" data-path="dm-import-export.html"><a href="dm-import-export.html#batch-export-data"><i class="fa fa-check"></i><b>2.6</b> 批量导出数据</a></li>
<li class="chapter" data-level="2.7" data-path="dm-import-export.html"><a href="dm-import-export.html#export-data"><i class="fa fa-check"></i><b>2.7</b> 导出数据</a><ul>
<li class="chapter" data-level="2.7.1" data-path="dm-import-export.html"><a href="dm-import-export.html#export-output"><i class="fa fa-check"></i><b>2.7.1</b> 导出运行结果</a></li>
<li class="chapter" data-level="2.7.2" data-path="dm-import-export.html"><a href="dm-import-export.html#export-data-object"><i class="fa fa-check"></i><b>2.7.2</b> 导出数据对象</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="dm-import-export.html"><a href="dm-import-export.html#dm-session-info"><i class="fa fa-check"></i><b>2.8</b> 运行环境</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dm-base-r.html"><a href="dm-base-r.html"><i class="fa fa-check"></i><b>3</b> 数据操作手</a><ul>
<li class="chapter" data-level="3.1" data-path="dm-base-r.html"><a href="dm-base-r.html#show"><i class="fa fa-check"></i><b>3.1</b> 查看数据</a></li>
<li class="chapter" data-level="3.2" data-path="dm-base-r.html"><a href="dm-base-r.html#base-reshape"><i class="fa fa-check"></i><b>3.2</b> 数据变形</a></li>
<li class="chapter" data-level="3.3" data-path="dm-base-r.html"><a href="dm-base-r.html#base-transform"><i class="fa fa-check"></i><b>3.3</b> 数据转换</a></li>
<li class="chapter" data-level="3.4" data-path="dm-base-r.html"><a href="dm-base-r.html#base-subset"><i class="fa fa-check"></i><b>3.4</b> 提取子集</a></li>
<li class="chapter" data-level="3.5" data-path="dm-base-r.html"><a href="dm-base-r.html#base-order"><i class="fa fa-check"></i><b>3.5</b> 按列排序</a></li>
<li class="chapter" data-level="3.6" data-path="dm-base-r.html"><a href="dm-base-r.html#base-split"><i class="fa fa-check"></i><b>3.6</b> 数据拆分</a></li>
<li class="chapter" data-level="3.7" data-path="dm-base-r.html"><a href="dm-base-r.html#base-merge"><i class="fa fa-check"></i><b>3.7</b> 数据合并</a></li>
<li class="chapter" data-level="3.8" data-path="dm-base-r.html"><a href="dm-base-r.html#base-duplicated"><i class="fa fa-check"></i><b>3.8</b> 数据去重</a></li>
<li class="chapter" data-level="3.9" data-path="dm-base-r.html"><a href="dm-base-r.html#base-aggregate"><i class="fa fa-check"></i><b>3.9</b> 数据聚合</a></li>
<li class="chapter" data-level="3.10" data-path="dm-base-r.html"><a href="dm-base-r.html#base-table"><i class="fa fa-check"></i><b>3.10</b> 表格统计</a></li>
<li class="chapter" data-level="3.11" data-path="dm-base-r.html"><a href="dm-base-r.html#base-index"><i class="fa fa-check"></i><b>3.11</b> 索引访问</a></li>
<li class="chapter" data-level="3.12" data-path="dm-base-r.html"><a href="dm-base-r.html#base-array"><i class="fa fa-check"></i><b>3.12</b> 多维数组</a></li>
<li class="chapter" data-level="3.13" data-path="dm-base-r.html"><a href="dm-base-r.html#base-others"><i class="fa fa-check"></i><b>3.13</b> 其它操作</a><ul>
<li class="chapter" data-level="3.13.1" data-path="dm-base-r.html"><a href="dm-base-r.html#relist-or-unlist"><i class="fa fa-check"></i><b>3.13.1</b> 列表属性</a></li>
<li class="chapter" data-level="3.13.2" data-path="dm-base-r.html"><a href="dm-base-r.html#stack-or-unstack"><i class="fa fa-check"></i><b>3.13.2</b> 堆叠向量</a></li>
<li class="chapter" data-level="3.13.3" data-path="dm-base-r.html"><a href="dm-base-r.html#class-or-unclass"><i class="fa fa-check"></i><b>3.13.3</b> 属性转化</a></li>
<li class="chapter" data-level="3.13.4" data-path="dm-base-r.html"><a href="dm-base-r.html#attach-or-detach"><i class="fa fa-check"></i><b>3.13.4</b> 绑定环境</a></li>
<li class="chapter" data-level="3.13.5" data-path="dm-base-r.html"><a href="dm-base-r.html#with-or-within"><i class="fa fa-check"></i><b>3.13.5</b> 数据环境</a></li>
</ul></li>
<li class="chapter" data-level="3.14" data-path="dm-base-r.html"><a href="dm-base-r.html#dm-base-session-info"><i class="fa fa-check"></i><b>3.14</b> 运行环境</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dm-dplyr.html"><a href="dm-dplyr.html"><i class="fa fa-check"></i><b>4</b> 净土化操作</a><ul>
<li class="chapter" data-level="4.1" data-path="dm-dplyr.html"><a href="dm-dplyr.html#common-operations"><i class="fa fa-check"></i><b>4.1</b> 常用操作</a><ul>
<li class="chapter" data-level="4.1.1" data-path="dm-dplyr.html"><a href="dm-dplyr.html#tibble-show"><i class="fa fa-check"></i><b>4.1.1</b> 查看</a></li>
<li class="chapter" data-level="4.1.2" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dplyr-subset"><i class="fa fa-check"></i><b>4.1.2</b> 筛选</a></li>
<li class="chapter" data-level="4.1.3" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dplyr-order"><i class="fa fa-check"></i><b>4.1.3</b> 排序</a></li>
<li class="chapter" data-level="4.1.4" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dplyr-aggregate"><i class="fa fa-check"></i><b>4.1.4</b> 聚合</a></li>
<li class="chapter" data-level="4.1.5" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dplyr-merge"><i class="fa fa-check"></i><b>4.1.5</b> 合并</a></li>
<li class="chapter" data-level="4.1.6" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dplyr-reshape"><i class="fa fa-check"></i><b>4.1.6</b> 重塑</a></li>
<li class="chapter" data-level="4.1.7" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dplyr-transform"><i class="fa fa-check"></i><b>4.1.7</b> 变换</a></li>
<li class="chapter" data-level="4.1.8" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dplyr-duplicated"><i class="fa fa-check"></i><b>4.1.8</b> 去重</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="dm-dplyr.html"><a href="dm-dplyr.html#common-dataframe-operations"><i class="fa fa-check"></i><b>4.2</b> 高频问题</a><ul>
<li class="chapter" data-level="4.2.1" data-path="dm-dplyr.html"><a href="dm-dplyr.html#create-empty-dataframe"><i class="fa fa-check"></i><b>4.2.1</b> 初始化数据框</a></li>
<li class="chapter" data-level="4.2.2" data-path="dm-dplyr.html"><a href="dm-dplyr.html#remove-missing-values"><i class="fa fa-check"></i><b>4.2.2</b> 移除缺失记录</a></li>
<li class="chapter" data-level="4.2.3" data-path="dm-dplyr.html"><a href="dm-dplyr.html#coerce-data-type"><i class="fa fa-check"></i><b>4.2.3</b> 数据类型转化</a></li>
<li class="chapter" data-level="4.2.4" data-path="dm-dplyr.html"><a href="dm-dplyr.html#cross-group-by"><i class="fa fa-check"></i><b>4.2.4</b> 跨列分组求和</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="dm-dplyr.html"><a href="dm-dplyr.html#pipe-manipulation"><i class="fa fa-check"></i><b>4.3</b> 管道操作</a></li>
<li class="chapter" data-level="4.4" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dm-dplyr-session-info"><i class="fa fa-check"></i><b>4.4</b> 运行环境</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html"><i class="fa fa-check"></i><b>5</b> 字符串操作</a><ul>
<li class="chapter" data-level="5.1" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-count"><i class="fa fa-check"></i><b>5.1</b> 字符数统计</a></li>
<li class="chapter" data-level="5.2" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-translations"><i class="fa fa-check"></i><b>5.2</b> 字符串翻译</a></li>
<li class="chapter" data-level="5.3" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-concatenate"><i class="fa fa-check"></i><b>5.3</b> 字符串连接</a></li>
<li class="chapter" data-level="5.4" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-strsplit"><i class="fa fa-check"></i><b>5.4</b> 字符串拆分</a></li>
<li class="chapter" data-level="5.5" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-match"><i class="fa fa-check"></i><b>5.5</b> 字符串匹配</a></li>
<li class="chapter" data-level="5.6" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-search"><i class="fa fa-check"></i><b>5.6</b> 字符串查询</a></li>
<li class="chapter" data-level="5.7" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-replacement"><i class="fa fa-check"></i><b>5.7</b> 字符串替换</a></li>
<li class="chapter" data-level="5.8" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-extract"><i class="fa fa-check"></i><b>5.8</b> 字符串提取</a></li>
<li class="chapter" data-level="5.9" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#other-string-op"><i class="fa fa-check"></i><b>5.9</b> 其它操作</a><ul>
<li class="chapter" data-level="5.9.1" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#strwrap"><i class="fa fa-check"></i><b>5.9.1</b> strwrap</a></li>
<li class="chapter" data-level="5.9.2" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#strtrim"><i class="fa fa-check"></i><b>5.9.2</b> strtrim</a></li>
<li class="chapter" data-level="5.9.3" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#strrep"><i class="fa fa-check"></i><b>5.9.3</b> strrep</a></li>
<li class="chapter" data-level="5.9.4" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#trimws"><i class="fa fa-check"></i><b>5.9.4</b> trimws</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#string-session-info"><i class="fa fa-check"></i><b>5.10</b> 运行环境</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html"><i class="fa fa-check"></i><b>6</b> 正则表达式</a><ul>
<li class="chapter" data-level="6.1" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#character-constants"><i class="fa fa-check"></i><b>6.1</b> 字符常量</a></li>
<li class="chapter" data-level="6.2" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#environments"><i class="fa fa-check"></i><b>6.2</b> 软件环境</a></li>
<li class="chapter" data-level="6.3" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#foundations"><i class="fa fa-check"></i><b>6.3</b> 基本概念</a></li>
<li class="chapter" data-level="6.4" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#match"><i class="fa fa-check"></i><b>6.4</b> 字符串匹配</a></li>
<li class="chapter" data-level="6.5" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#concatenation"><i class="fa fa-check"></i><b>6.5</b> 级联表达式</a></li>
<li class="chapter" data-level="6.6" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#backreference"><i class="fa fa-check"></i><b>6.6</b> 反向引用</a></li>
<li class="chapter" data-level="6.7" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#named-capture"><i class="fa fa-check"></i><b>6.7</b> 命名捕捉</a></li>
<li class="chapter" data-level="6.8" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#comment"><i class="fa fa-check"></i><b>6.8</b> 表达式注释</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="dv-plot.html"><a href="dv-plot.html"><i class="fa fa-check"></i><b>7</b> 绘图素材库</a><ul>
<li class="chapter" data-level="7.1" data-path="dv-plot.html"><a href="dv-plot.html#elements"><i class="fa fa-check"></i><b>7.1</b> 基本要素</a><ul>
<li class="chapter" data-level="7.1.1" data-path="dv-plot.html"><a href="dv-plot.html#base-points"><i class="fa fa-check"></i><b>7.1.1</b> 点线</a></li>
<li class="chapter" data-level="7.1.2" data-path="dv-plot.html"><a href="dv-plot.html#base-rect"><i class="fa fa-check"></i><b>7.1.2</b> 区域</a></li>
<li class="chapter" data-level="7.1.3" data-path="dv-plot.html"><a href="dv-plot.html#base-lines"><i class="fa fa-check"></i><b>7.1.3</b> 参考线</a></li>
<li class="chapter" data-level="7.1.4" data-path="dv-plot.html"><a href="dv-plot.html#base-axis"><i class="fa fa-check"></i><b>7.1.4</b> 坐标轴</a></li>
<li class="chapter" data-level="7.1.5" data-path="dv-plot.html"><a href="dv-plot.html#base-tick"><i class="fa fa-check"></i><b>7.1.5</b> 刻度线</a></li>
<li class="chapter" data-level="7.1.6" data-path="dv-plot.html"><a href="dv-plot.html#base-title"><i class="fa fa-check"></i><b>7.1.6</b> 标题</a></li>
<li class="chapter" data-level="7.1.7" data-path="dv-plot.html"><a href="dv-plot.html#base-annotation"><i class="fa fa-check"></i><b>7.1.7</b> 注释</a></li>
<li class="chapter" data-level="7.1.8" data-path="dv-plot.html"><a href="dv-plot.html#base-legend"><i class="fa fa-check"></i><b>7.1.8</b> 图例</a></li>
<li class="chapter" data-level="7.1.9" data-path="dv-plot.html"><a href="dv-plot.html#base-par"><i class="fa fa-check"></i><b>7.1.9</b> 边空</a></li>
<li class="chapter" data-level="7.1.10" data-path="dv-plot.html"><a href="dv-plot.html#base-layer"><i class="fa fa-check"></i><b>7.1.10</b> 图层</a></li>
<li class="chapter" data-level="7.1.11" data-path="dv-plot.html"><a href="dv-plot.html#base-layout"><i class="fa fa-check"></i><b>7.1.11</b> 布局</a></li>
<li class="chapter" data-level="7.1.12" data-path="dv-plot.html"><a href="dv-plot.html#base-combine"><i class="fa fa-check"></i><b>7.1.12</b> 组合</a></li>
<li class="chapter" data-level="7.1.13" data-path="dv-plot.html"><a href="dv-plot.html#base-screen"><i class="fa fa-check"></i><b>7.1.13</b> 分屏</a></li>
<li class="chapter" data-level="7.1.14" data-path="dv-plot.html"><a href="dv-plot.html#identify-locator"><i class="fa fa-check"></i><b>7.1.14</b> 交互</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="dv-plot.html"><a href="dv-plot.html#plot-gallary"><i class="fa fa-check"></i><b>7.2</b> 统计图形</a><ul>
<li class="chapter" data-level="7.2.1" data-path="dv-plot.html"><a href="dv-plot.html#plot-bar"><i class="fa fa-check"></i><b>7.2.1</b> 条形图</a></li>
<li class="chapter" data-level="7.2.2" data-path="dv-plot.html"><a href="dv-plot.html#plot-hist"><i class="fa fa-check"></i><b>7.2.2</b> 直方图</a></li>
<li class="chapter" data-level="7.2.3" data-path="dv-plot.html"><a href="dv-plot.html#plot-density"><i class="fa fa-check"></i><b>7.2.3</b> 密度图</a></li>
<li class="chapter" data-level="7.2.4" data-path="dv-plot.html"><a href="dv-plot.html#plot-ecdf"><i class="fa fa-check"></i><b>7.2.4</b> 经验图</a></li>
<li class="chapter" data-level="7.2.5" data-path="dv-plot.html"><a href="dv-plot.html#plot-qqnorm"><i class="fa fa-check"></i><b>7.2.5</b> QQ 图</a></li>
<li class="chapter" data-level="7.2.6" data-path="dv-plot.html"><a href="dv-plot.html#plot-ts"><i class="fa fa-check"></i><b>7.2.6</b> 时序图</a></li>
<li class="chapter" data-level="7.2.7" data-path="dv-plot.html"><a href="dv-plot.html#plot-pie"><i class="fa fa-check"></i><b>7.2.7</b> 饼图</a></li>
<li class="chapter" data-level="7.2.8" data-path="dv-plot.html"><a href="dv-plot.html#plot-stem-leaf"><i class="fa fa-check"></i><b>7.2.8</b> 茎叶图</a></li>
<li class="chapter" data-level="7.2.9" data-path="dv-plot.html"><a href="dv-plot.html#plot-scatter"><i class="fa fa-check"></i><b>7.2.9</b> 散点图</a></li>
<li class="chapter" data-level="7.2.10" data-path="dv-plot.html"><a href="dv-plot.html#base-jitter"><i class="fa fa-check"></i><b>7.2.10</b> 抖动图</a></li>
<li class="chapter" data-level="7.2.11" data-path="dv-plot.html"><a href="dv-plot.html#plot-box"><i class="fa fa-check"></i><b>7.2.11</b> 箱线图</a></li>
<li class="chapter" data-level="7.2.12" data-path="dv-plot.html"><a href="dv-plot.html#error-bars"><i class="fa fa-check"></i><b>7.2.12</b> 残差图</a></li>
<li class="chapter" data-level="7.2.13" data-path="dv-plot.html"><a href="dv-plot.html#plot-violin"><i class="fa fa-check"></i><b>7.2.13</b> 提琴图</a></li>
<li class="chapter" data-level="7.2.14" data-path="dv-plot.html"><a href="dv-plot.html#plot-contour"><i class="fa fa-check"></i><b>7.2.14</b> 轮廓图</a></li>
<li class="chapter" data-level="7.2.15" data-path="dv-plot.html"><a href="dv-plot.html#plot-line"><i class="fa fa-check"></i><b>7.2.15</b> 折线图</a></li>
<li class="chapter" data-level="7.2.16" data-path="dv-plot.html"><a href="dv-plot.html#function"><i class="fa fa-check"></i><b>7.2.16</b> 函数图</a></li>
<li class="chapter" data-level="7.2.17" data-path="dv-plot.html"><a href="dv-plot.html#plot-mosaic"><i class="fa fa-check"></i><b>7.2.17</b> 马赛克图</a></li>
<li class="chapter" data-level="7.2.18" data-path="dv-plot.html"><a href="dv-plot.html#plot-dotchart"><i class="fa fa-check"></i><b>7.2.18</b> 克利夫兰点图</a></li>
<li class="chapter" data-level="7.2.19" data-path="dv-plot.html"><a href="dv-plot.html#plot-matrix"><i class="fa fa-check"></i><b>7.2.19</b> 矩阵图</a></li>
<li class="chapter" data-level="7.2.20" data-path="dv-plot.html"><a href="dv-plot.html#plot-radar"><i class="fa fa-check"></i><b>7.2.20</b> 雷达图</a></li>
<li class="chapter" data-level="7.2.21" data-path="dv-plot.html"><a href="dv-plot.html#plot-rose"><i class="fa fa-check"></i><b>7.2.21</b> 玫瑰图</a></li>
<li class="chapter" data-level="7.2.22" data-path="dv-plot.html"><a href="dv-plot.html#plot-map"><i class="fa fa-check"></i><b>7.2.22</b> 地形图</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="dv-plot.html"><a href="dv-plot.html#plot-session-info"><i class="fa fa-check"></i><b>7.3</b> 运行环境</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html"><i class="fa fa-check"></i><b>8</b> 数据可视化</a><ul>
<li class="chapter" data-level="8.1" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#intro-ggplot2"><i class="fa fa-check"></i><b>8.1</b> 基础语法</a><ul>
<li class="chapter" data-level="8.1.1" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-layer"><i class="fa fa-check"></i><b>8.1.1</b> 图层</a></li>
<li class="chapter" data-level="8.1.2" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-theme"><i class="fa fa-check"></i><b>8.1.2</b> 主题</a></li>
<li class="chapter" data-level="8.1.3" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-color"><i class="fa fa-check"></i><b>8.1.3</b> 配色</a></li>
<li class="chapter" data-level="8.1.4" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-scale"><i class="fa fa-check"></i><b>8.1.4</b> 刻度</a></li>
<li class="chapter" data-level="8.1.5" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-annotate"><i class="fa fa-check"></i><b>8.1.5</b> 注释</a></li>
<li class="chapter" data-level="8.1.6" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-legend"><i class="fa fa-check"></i><b>8.1.6</b> 图例</a></li>
<li class="chapter" data-level="8.1.7" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-grid"><i class="fa fa-check"></i><b>8.1.7</b> 组合</a></li>
<li class="chapter" data-level="8.1.8" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-coord"><i class="fa fa-check"></i><b>8.1.8</b> 坐标系</a></li>
<li class="chapter" data-level="8.1.9" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-axes"><i class="fa fa-check"></i><b>8.1.9</b> 坐标轴</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-gallary"><i class="fa fa-check"></i><b>8.2</b> 统计图形</a><ul>
<li class="chapter" data-level="8.2.1" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-scatter"><i class="fa fa-check"></i><b>8.2.1</b> 散点图</a></li>
<li class="chapter" data-level="8.2.2" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-boxplot"><i class="fa fa-check"></i><b>8.2.2</b> 箱线图</a></li>
<li class="chapter" data-level="8.2.3" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-barplot"><i class="fa fa-check"></i><b>8.2.3</b> 条形图</a></li>
<li class="chapter" data-level="8.2.4" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-line"><i class="fa fa-check"></i><b>8.2.4</b> 折线图</a></li>
<li class="chapter" data-level="8.2.5" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-histogram"><i class="fa fa-check"></i><b>8.2.5</b> 直方图</a></li>
<li class="chapter" data-level="8.2.6" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-violin"><i class="fa fa-check"></i><b>8.2.6</b> 提琴图</a></li>
<li class="chapter" data-level="8.2.7" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-jitter"><i class="fa fa-check"></i><b>8.2.7</b> 抖动图</a></li>
<li class="chapter" data-level="8.2.8" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-ridge"><i class="fa fa-check"></i><b>8.2.8</b> 密度图</a></li>
<li class="chapter" data-level="8.2.9" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-rose"><i class="fa fa-check"></i><b>8.2.9</b> 玫瑰图</a></li>
<li class="chapter" data-level="8.2.10" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-wordcloud"><i class="fa fa-check"></i><b>8.2.10</b> 词云图</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-session-info"><i class="fa fa-check"></i><b>8.3</b> 运行环境</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html"><i class="fa fa-check"></i><b>9</b> 时空数据可视化</a><ul>
<li class="chapter" data-level="9.1" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#map"><i class="fa fa-check"></i><b>9.1</b> 地图</a><ul>
<li class="chapter" data-level="9.1.1" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#project-orientation"><i class="fa fa-check"></i><b>9.1.1</b> 投影和观察方位</a></li>
<li class="chapter" data-level="9.1.2" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#USA-crime-rates"><i class="fa fa-check"></i><b>9.1.2</b> 美国各州犯罪率</a></li>
<li class="chapter" data-level="9.1.3" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#fiji-earthquake-map"><i class="fa fa-check"></i><b>9.1.3</b> 斐济地震带</a></li>
<li class="chapter" data-level="9.1.4" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#USA-unemployment-ratio"><i class="fa fa-check"></i><b>9.1.4</b> 美国各城镇失业率</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#spatial-op"><i class="fa fa-check"></i><b>9.2</b> 空间数据对象</a><ul>
<li class="chapter" data-level="9.2.1" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#ggplot2-sp"><i class="fa fa-check"></i><b>9.2.1</b> sp</a></li>
<li class="chapter" data-level="9.2.2" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#ggplot2-raster"><i class="fa fa-check"></i><b>9.2.2</b> raster</a></li>
<li class="chapter" data-level="9.2.3" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#ggplot2-sf"><i class="fa fa-check"></i><b>9.2.3</b> sf</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="cs-cran-network.html"><a href="cs-cran-network.html"><i class="fa fa-check"></i><b>10</b> 案例：分析 CRAN</a><ul>
<li class="chapter" data-level="10.1" data-path="cs-cran-network.html"><a href="cs-cran-network.html#R-Core-Team"><i class="fa fa-check"></i><b>10.1</b> R 核心团队</a></li>
<li class="chapter" data-level="10.2" data-path="cs-cran-network.html"><a href="cs-cran-network.html#Top-Creators"><i class="fa fa-check"></i><b>10.2</b> 高产的开发者</a></li>
<li class="chapter" data-level="10.3" data-path="cs-cran-network.html"><a href="cs-cran-network.html#R-Package-Developers"><i class="fa fa-check"></i><b>10.3</b> 社区开发者</a></li>
<li class="chapter" data-level="10.4" data-path="cs-cran-network.html"><a href="cs-cran-network.html#first-commit"><i class="fa fa-check"></i><b>10.4</b> 首次贡献 R 包</a></li>
<li class="chapter" data-level="10.5" data-path="cs-cran-network.html"><a href="cs-cran-network.html#Contribution-Network"><i class="fa fa-check"></i><b>10.5</b> 贡献关系网络</a></li>
<li class="chapter" data-level="10.6" data-path="cs-cran-network.html"><a href="cs-cran-network.html#CRAN-Update-Packages"><i class="fa fa-check"></i><b>10.6</b> 更新知多少</a></li>
<li class="chapter" data-level="10.7" data-path="cs-cran-network.html"><a href="cs-cran-network.html#Package-Licenses"><i class="fa fa-check"></i><b>10.7</b> 使用许可证</a></li>
<li class="chapter" data-level="10.8" data-path="cs-cran-network.html"><a href="cs-cran-network.html#r-"><i class="fa fa-check"></i><b>10.8</b> R 包增长速度</a></li>
<li class="chapter" data-level="10.9" data-path="cs-cran-network.html"><a href="cs-cran-network.html#Choose-Package"><i class="fa fa-check"></i><b>10.9</b> 选择 R 包</a></li>
<li class="chapter" data-level="10.10" data-path="cs-cran-network.html"><a href="cs-cran-network.html#cs-network-session-info"><i class="fa fa-check"></i><b>10.10</b> 运行环境</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="99-references.html"><a href="99-references.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://r-graphics.netlify.com/" target="blank">Published with netlify</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">数据可视化与R语言</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-manipulator" class="section level1">
<h1><span class="header-section-number">第 3 章</span> 数据操作手</h1>
<blockquote>
<p>参考 Data Manipulation With R <span class="citation">(Spector <a href="#ref-Spector_2008_Manipulation" role="doc-biblioref">2008</a>)</span> 重新捋一遍本章
本章的操作对象是 data.frame</p>
</blockquote>
<div class="sidebar">
<p>介绍 Base R 提供的数据操作，关于采用 Base R 还是 tidyverse 做数据操作的 <a href="https://d.cosx.org/d/420697">讨论</a></p>
<p>数据操作的动画展示参考 <a href="https://github.com/gadenbuie/tidyexplain" class="uri">https://github.com/gadenbuie/tidyexplain</a> 提供 Base R 对应的实现</p>
</div>
<p>什么是 Base R? Base R 指的是 R 语言/软件的核心组件，由 R Core Team 维护</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="dm-base-r.html#cb99-1"></a>Pkgs &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">list.files</span>(<span class="kw">R.home</span>(<span class="st">&quot;library&quot;</span>)), <span class="cf">function</span>(x)</span>
<span id="cb99-2"><a href="dm-base-r.html#cb99-2"></a>  <span class="kw">packageDescription</span>(<span class="dt">pkg =</span> x, <span class="dt">fields =</span> <span class="st">&quot;Priority&quot;</span>))</span>
<span id="cb99-3"><a href="dm-base-r.html#cb99-3"></a><span class="kw">names</span>(Pkgs[Pkgs <span class="op">==</span><span class="st"> &quot;base&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(Pkgs)])</span>
<span id="cb99-4"><a href="dm-base-r.html#cb99-4"></a><span class="co">#&gt;  [1] &quot;base&quot;      &quot;compiler&quot;  &quot;datasets&quot;  &quot;graphics&quot;  &quot;grDevices&quot;</span></span>
<span id="cb99-5"><a href="dm-base-r.html#cb99-5"></a><span class="co">#&gt;  [6] &quot;grid&quot;      &quot;methods&quot;   &quot;parallel&quot;  &quot;splines&quot;   &quot;stats&quot;    </span></span>
<span id="cb99-6"><a href="dm-base-r.html#cb99-6"></a><span class="co">#&gt; [11] &quot;stats4&quot;    &quot;tcltk&quot;     &quot;tools&quot;     &quot;utils&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="dm-base-r.html#cb100-1"></a><span class="kw">names</span>(Pkgs[Pkgs <span class="op">==</span><span class="st"> &quot;recommended&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(Pkgs)])</span>
<span id="cb100-2"><a href="dm-base-r.html#cb100-2"></a><span class="co">#&gt; character(0)</span></span></code></pre></div>
<p>数据变形，分组统计聚合等，用以作为模型的输入，绘图的对象，操作的数据对象是数据框(data.frame)类型的，而且如果没有特别说明，文中出现的数据集都是 Base R 内置的，第三方 R 包或者来源于网上的数据集都会加以说明。</p>
<div id="show" class="section level2">
<h2><span class="header-section-number">3.1</span> 查看数据</h2>
<p>查看属性</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="dm-base-r.html#cb101-1"></a><span class="kw">str</span>(iris)</span>
<span id="cb101-2"><a href="dm-base-r.html#cb101-2"></a><span class="co">#&gt; &#39;data.frame&#39;:    150 obs. of  5 variables:</span></span>
<span id="cb101-3"><a href="dm-base-r.html#cb101-3"></a><span class="co">#&gt;  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...</span></span>
<span id="cb101-4"><a href="dm-base-r.html#cb101-4"></a><span class="co">#&gt;  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...</span></span>
<span id="cb101-5"><a href="dm-base-r.html#cb101-5"></a><span class="co">#&gt;  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...</span></span>
<span id="cb101-6"><a href="dm-base-r.html#cb101-6"></a><span class="co">#&gt;  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...</span></span>
<span id="cb101-7"><a href="dm-base-r.html#cb101-7"></a><span class="co">#&gt;  $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1..</span></span></code></pre></div>
<p>查看部分数据集</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="dm-base-r.html#cb102-1"></a><span class="kw">head</span>(iris, <span class="dv">5</span>)</span>
<span id="cb102-2"><a href="dm-base-r.html#cb102-2"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb102-3"><a href="dm-base-r.html#cb102-3"></a><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa</span></span>
<span id="cb102-4"><a href="dm-base-r.html#cb102-4"></a><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></span>
<span id="cb102-5"><a href="dm-base-r.html#cb102-5"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb102-6"><a href="dm-base-r.html#cb102-6"></a><span class="co">#&gt; 4          4.6         3.1          1.5         0.2  setosa</span></span>
<span id="cb102-7"><a href="dm-base-r.html#cb102-7"></a><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></span>
<span id="cb102-8"><a href="dm-base-r.html#cb102-8"></a><span class="kw">tail</span>(iris, <span class="dv">5</span>)</span>
<span id="cb102-9"><a href="dm-base-r.html#cb102-9"></a><span class="co">#&gt;     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species</span></span>
<span id="cb102-10"><a href="dm-base-r.html#cb102-10"></a><span class="co">#&gt; 146          6.7         3.0          5.2         2.3 virginica</span></span>
<span id="cb102-11"><a href="dm-base-r.html#cb102-11"></a><span class="co">#&gt; 147          6.3         2.5          5.0         1.9 virginica</span></span>
<span id="cb102-12"><a href="dm-base-r.html#cb102-12"></a><span class="co">#&gt; 148          6.5         3.0          5.2         2.0 virginica</span></span>
<span id="cb102-13"><a href="dm-base-r.html#cb102-13"></a><span class="co">#&gt; 149          6.2         3.4          5.4         2.3 virginica</span></span>
<span id="cb102-14"><a href="dm-base-r.html#cb102-14"></a><span class="co">#&gt; 150          5.9         3.0          5.1         1.8 virginica</span></span></code></pre></div>
<p>查看文件前（后）5行</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb103-1"><a href="dm-base-r.html#cb103-1"></a><span class="fu">head</span> -n 5 test.csv</span>
<span id="cb103-2"><a href="dm-base-r.html#cb103-2"></a><span class="fu">tail</span> -n 5 test.csv</span></code></pre></div>
<p>对象的类型，存储方式</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="dm-base-r.html#cb104-1"></a><span class="kw">class</span>(iris)</span>
<span id="cb104-2"><a href="dm-base-r.html#cb104-2"></a><span class="co">#&gt; [1] &quot;data.frame&quot;</span></span>
<span id="cb104-3"><a href="dm-base-r.html#cb104-3"></a><span class="kw">mode</span>(iris)</span>
<span id="cb104-4"><a href="dm-base-r.html#cb104-4"></a><span class="co">#&gt; [1] &quot;list&quot;</span></span>
<span id="cb104-5"><a href="dm-base-r.html#cb104-5"></a><span class="kw">typeof</span>(iris)</span>
<span id="cb104-6"><a href="dm-base-r.html#cb104-6"></a><span class="co">#&gt; [1] &quot;list&quot;</span></span></code></pre></div>
<p>查看对象在R环境中所占空间的大小</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="dm-base-r.html#cb105-1"></a><span class="kw">object.size</span>(iris)</span>
<span id="cb105-2"><a href="dm-base-r.html#cb105-2"></a><span class="co">#&gt; 7256 bytes</span></span>
<span id="cb105-3"><a href="dm-base-r.html#cb105-3"></a><span class="kw">object.size</span>(letters)</span>
<span id="cb105-4"><a href="dm-base-r.html#cb105-4"></a><span class="co">#&gt; 1712 bytes</span></span>
<span id="cb105-5"><a href="dm-base-r.html#cb105-5"></a><span class="kw">object.size</span>(ls)</span>
<span id="cb105-6"><a href="dm-base-r.html#cb105-6"></a><span class="co">#&gt; 89904 bytes</span></span>
<span id="cb105-7"><a href="dm-base-r.html#cb105-7"></a><span class="kw">format</span>(<span class="kw">object.size</span>(library), <span class="dt">units =</span> <span class="st">&quot;auto&quot;</span>)</span>
<span id="cb105-8"><a href="dm-base-r.html#cb105-8"></a><span class="co">#&gt; [1] &quot;1.8 Mb&quot;</span></span></code></pre></div>
</div>
<div id="base-reshape" class="section level2">
<h2><span class="header-section-number">3.2</span> 数据变形</h2>
<p>重复测量数据的变形 Reshape Grouped Data，将宽格式 wide 的数据框变长格式 long的，反之也行。reshape 还支持正则表达式</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="dm-base-r.html#cb106-1"></a><span class="kw">str</span>(Indometh)</span>
<span id="cb106-2"><a href="dm-base-r.html#cb106-2"></a><span class="co">#&gt; Classes &#39;nfnGroupedData&#39;, &#39;nfGroupedData&#39;, &#39;groupedData&#39; and &#39;data.frame&#39;:   66 obs. of  3 variables:</span></span>
<span id="cb106-3"><a href="dm-base-r.html#cb106-3"></a><span class="co">#&gt;  $ Subject: Ord.factor w/ 6 levels &quot;1&quot;&lt;&quot;4&quot;&lt;&quot;2&quot;&lt;&quot;5&quot;&lt;..: 1 1 1 1 1 1 1 1 1 ..</span></span>
<span id="cb106-4"><a href="dm-base-r.html#cb106-4"></a><span class="co">#&gt;  $ time   : num  0.25 0.5 0.75 1 1.25 2 3 4 5 6 ...</span></span>
<span id="cb106-5"><a href="dm-base-r.html#cb106-5"></a><span class="co">#&gt;  $ conc   : num  1.5 0.94 0.78 0.48 0.37 0.19 0.12 0.11 0.08 0.07 ...</span></span>
<span id="cb106-6"><a href="dm-base-r.html#cb106-6"></a><span class="co">#&gt;  - attr(*, &quot;formula&quot;)=Class &#39;formula&#39;  language conc ~ time | Subject</span></span>
<span id="cb106-7"><a href="dm-base-r.html#cb106-7"></a><span class="co">#&gt;   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_EmptyEnv&gt; </span></span>
<span id="cb106-8"><a href="dm-base-r.html#cb106-8"></a><span class="co">#&gt;  - attr(*, &quot;labels&quot;)=List of 2</span></span>
<span id="cb106-9"><a href="dm-base-r.html#cb106-9"></a><span class="co">#&gt;   ..$ x: chr &quot;Time since drug administration&quot;</span></span>
<span id="cb106-10"><a href="dm-base-r.html#cb106-10"></a><span class="co">#&gt;   ..$ y: chr &quot;Indomethacin concentration&quot;</span></span>
<span id="cb106-11"><a href="dm-base-r.html#cb106-11"></a><span class="co">#&gt;  - attr(*, &quot;units&quot;)=List of 2</span></span>
<span id="cb106-12"><a href="dm-base-r.html#cb106-12"></a><span class="co">#&gt;   ..$ x: chr &quot;(hr)&quot;</span></span>
<span id="cb106-13"><a href="dm-base-r.html#cb106-13"></a><span class="co">#&gt;   ..$ y: chr &quot;(mcg/ml)&quot;</span></span>
<span id="cb106-14"><a href="dm-base-r.html#cb106-14"></a><span class="kw">summary</span>(Indometh)</span>
<span id="cb106-15"><a href="dm-base-r.html#cb106-15"></a><span class="co">#&gt;  Subject      time            conc       </span></span>
<span id="cb106-16"><a href="dm-base-r.html#cb106-16"></a><span class="co">#&gt;  1:11    Min.   :0.250   Min.   :0.0500  </span></span>
<span id="cb106-17"><a href="dm-base-r.html#cb106-17"></a><span class="co">#&gt;  4:11    1st Qu.:0.750   1st Qu.:0.1100  </span></span>
<span id="cb106-18"><a href="dm-base-r.html#cb106-18"></a><span class="co">#&gt;  2:11    Median :2.000   Median :0.3400  </span></span>
<span id="cb106-19"><a href="dm-base-r.html#cb106-19"></a><span class="co">#&gt;  5:11    Mean   :2.886   Mean   :0.5918  </span></span>
<span id="cb106-20"><a href="dm-base-r.html#cb106-20"></a><span class="co">#&gt;  6:11    3rd Qu.:5.000   3rd Qu.:0.8325  </span></span>
<span id="cb106-21"><a href="dm-base-r.html#cb106-21"></a><span class="co">#&gt;  3:11    Max.   :8.000   Max.   :2.7200</span></span></code></pre></div>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="dm-base-r.html#cb107-1"></a><span class="co"># 长的变宽</span></span>
<span id="cb107-2"><a href="dm-base-r.html#cb107-2"></a>wide &lt;-<span class="st"> </span><span class="kw">reshape</span>(Indometh,</span>
<span id="cb107-3"><a href="dm-base-r.html#cb107-3"></a>  <span class="dt">v.names =</span> <span class="st">&quot;conc&quot;</span>, <span class="dt">idvar =</span> <span class="st">&quot;Subject&quot;</span>,</span>
<span id="cb107-4"><a href="dm-base-r.html#cb107-4"></a>  <span class="dt">timevar =</span> <span class="st">&quot;time&quot;</span>, <span class="dt">direction =</span> <span class="st">&quot;wide&quot;</span></span>
<span id="cb107-5"><a href="dm-base-r.html#cb107-5"></a>)</span>
<span id="cb107-6"><a href="dm-base-r.html#cb107-6"></a>wide[, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</span>
<span id="cb107-7"><a href="dm-base-r.html#cb107-7"></a><span class="co">#&gt;    Subject conc.0.25 conc.0.5 conc.0.75 conc.1 conc.1.25</span></span>
<span id="cb107-8"><a href="dm-base-r.html#cb107-8"></a><span class="co">#&gt; 1        1      1.50     0.94      0.78   0.48      0.37</span></span>
<span id="cb107-9"><a href="dm-base-r.html#cb107-9"></a><span class="co">#&gt; 12       2      2.03     1.63      0.71   0.70      0.64</span></span>
<span id="cb107-10"><a href="dm-base-r.html#cb107-10"></a><span class="co">#&gt; 23       3      2.72     1.49      1.16   0.80      0.80</span></span>
<span id="cb107-11"><a href="dm-base-r.html#cb107-11"></a><span class="co">#&gt; 34       4      1.85     1.39      1.02   0.89      0.59</span></span>
<span id="cb107-12"><a href="dm-base-r.html#cb107-12"></a><span class="co">#&gt; 45       5      2.05     1.04      0.81   0.39      0.30</span></span>
<span id="cb107-13"><a href="dm-base-r.html#cb107-13"></a>....</span>
<span id="cb107-14"><a href="dm-base-r.html#cb107-14"></a></span>
<span id="cb107-15"><a href="dm-base-r.html#cb107-15"></a><span class="co"># 宽的变长</span></span>
<span id="cb107-16"><a href="dm-base-r.html#cb107-16"></a><span class="kw">reshape</span>(wide, <span class="dt">direction =</span> <span class="st">&quot;long&quot;</span>)</span>
<span id="cb107-17"><a href="dm-base-r.html#cb107-17"></a><span class="co">#&gt;        Subject time conc</span></span>
<span id="cb107-18"><a href="dm-base-r.html#cb107-18"></a><span class="co">#&gt; 1.0.25       1 0.25 1.50</span></span>
<span id="cb107-19"><a href="dm-base-r.html#cb107-19"></a><span class="co">#&gt; 2.0.25       2 0.25 2.03</span></span>
<span id="cb107-20"><a href="dm-base-r.html#cb107-20"></a><span class="co">#&gt; 3.0.25       3 0.25 2.72</span></span>
<span id="cb107-21"><a href="dm-base-r.html#cb107-21"></a><span class="co">#&gt; 4.0.25       4 0.25 1.85</span></span>
<span id="cb107-22"><a href="dm-base-r.html#cb107-22"></a><span class="co">#&gt; 5.0.25       5 0.25 2.05</span></span>
<span id="cb107-23"><a href="dm-base-r.html#cb107-23"></a>....</span></code></pre></div>
<p>宽的格式变成长的格式 <a href="https://stackoverflow.com/questions/2185252" class="uri">https://stackoverflow.com/questions/2185252</a></p>
<p>长的格式变成宽的格式 <a href="https://stackoverflow.com/questions/5890584/" class="uri">https://stackoverflow.com/questions/5890584/</a></p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="dm-base-r.html#cb108-1"></a><span class="kw">set.seed</span>(<span class="dv">45</span>)</span>
<span id="cb108-2"><a href="dm-base-r.html#cb108-2"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb108-3"><a href="dm-base-r.html#cb108-3"></a>    <span class="dt">name =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;Orange&quot;</span>, <span class="st">&quot;Apple&quot;</span>), <span class="dt">each=</span><span class="dv">4</span>),</span>
<span id="cb108-4"><a href="dm-base-r.html#cb108-4"></a>    <span class="dt">numbers =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb108-5"><a href="dm-base-r.html#cb108-5"></a>    <span class="dt">value =</span> <span class="kw">rnorm</span>(<span class="dv">8</span>))</span>
<span id="cb108-6"><a href="dm-base-r.html#cb108-6"></a>dat</span>
<span id="cb108-7"><a href="dm-base-r.html#cb108-7"></a><span class="co">#&gt;     name numbers      value</span></span>
<span id="cb108-8"><a href="dm-base-r.html#cb108-8"></a><span class="co">#&gt; 1 Orange       1  0.3407997</span></span>
<span id="cb108-9"><a href="dm-base-r.html#cb108-9"></a><span class="co">#&gt; 2 Orange       2 -0.7033403</span></span>
<span id="cb108-10"><a href="dm-base-r.html#cb108-10"></a><span class="co">#&gt; 3 Orange       3 -0.3795377</span></span>
<span id="cb108-11"><a href="dm-base-r.html#cb108-11"></a><span class="co">#&gt; 4 Orange       4 -0.7460474</span></span>
<span id="cb108-12"><a href="dm-base-r.html#cb108-12"></a><span class="co">#&gt; 5  Apple       1 -0.8981073</span></span>
<span id="cb108-13"><a href="dm-base-r.html#cb108-13"></a><span class="co">#&gt; 6  Apple       2 -0.3347941</span></span>
<span id="cb108-14"><a href="dm-base-r.html#cb108-14"></a><span class="co">#&gt; 7  Apple       3 -0.5013782</span></span>
<span id="cb108-15"><a href="dm-base-r.html#cb108-15"></a><span class="co">#&gt; 8  Apple       4 -0.1745357</span></span>
<span id="cb108-16"><a href="dm-base-r.html#cb108-16"></a></span>
<span id="cb108-17"><a href="dm-base-r.html#cb108-17"></a><span class="kw">reshape</span>(dat, <span class="dt">idvar =</span> <span class="st">&quot;name&quot;</span>, <span class="dt">timevar =</span> <span class="st">&quot;numbers&quot;</span>, <span class="dt">direction =</span> <span class="st">&quot;wide&quot;</span>)</span>
<span id="cb108-18"><a href="dm-base-r.html#cb108-18"></a><span class="co">#&gt;     name    value.1    value.2    value.3    value.4</span></span>
<span id="cb108-19"><a href="dm-base-r.html#cb108-19"></a><span class="co">#&gt; 1 Orange  0.3407997 -0.7033403 -0.3795377 -0.7460474</span></span>
<span id="cb108-20"><a href="dm-base-r.html#cb108-20"></a><span class="co">#&gt; 5  Apple -0.8981073 -0.3347941 -0.5013782 -0.1745357</span></span></code></pre></div>
<p>更加复杂的例子， gambia 数据集，重塑的效果是使得个体水平的长格式变为村庄水平的宽格式</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="dm-base-r.html#cb109-1"></a><span class="co"># data(gambia, package = &quot;geoR&quot;)</span></span>
<span id="cb109-2"><a href="dm-base-r.html#cb109-2"></a><span class="co"># 在线下载数据集</span></span>
<span id="cb109-3"><a href="dm-base-r.html#cb109-3"></a>gambia &lt;-<span class="st"> </span><span class="kw">read.table</span>(</span>
<span id="cb109-4"><a href="dm-base-r.html#cb109-4"></a>  <span class="dt">file =</span></span>
<span id="cb109-5"><a href="dm-base-r.html#cb109-5"></a>    <span class="kw">paste</span>(<span class="st">&quot;http://www.leg.ufpr.br/lib/exe/fetch.php&quot;</span>,</span>
<span id="cb109-6"><a href="dm-base-r.html#cb109-6"></a>      <span class="st">&quot;pessoais:paulojus:mbgbook:datasets:gambia.txt&quot;</span>,</span>
<span id="cb109-7"><a href="dm-base-r.html#cb109-7"></a>      <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span></span>
<span id="cb109-8"><a href="dm-base-r.html#cb109-8"></a>    ), <span class="dt">header =</span> <span class="ot">TRUE</span></span>
<span id="cb109-9"><a href="dm-base-r.html#cb109-9"></a>)</span>
<span id="cb109-10"><a href="dm-base-r.html#cb109-10"></a><span class="kw">head</span>(gambia)</span>
<span id="cb109-11"><a href="dm-base-r.html#cb109-11"></a><span class="co">#&gt;          x       y pos  age netuse treated green phc</span></span>
<span id="cb109-12"><a href="dm-base-r.html#cb109-12"></a><span class="co">#&gt; 1 349631.3 1458055   1 1783      0       0 40.85   1</span></span>
<span id="cb109-13"><a href="dm-base-r.html#cb109-13"></a><span class="co">#&gt; 2 349631.3 1458055   0  404      1       0 40.85   1</span></span>
<span id="cb109-14"><a href="dm-base-r.html#cb109-14"></a><span class="co">#&gt; 3 349631.3 1458055   0  452      1       0 40.85   1</span></span>
<span id="cb109-15"><a href="dm-base-r.html#cb109-15"></a><span class="co">#&gt; 4 349631.3 1458055   1  566      1       0 40.85   1</span></span>
<span id="cb109-16"><a href="dm-base-r.html#cb109-16"></a><span class="co">#&gt; 5 349631.3 1458055   0  598      1       0 40.85   1</span></span>
<span id="cb109-17"><a href="dm-base-r.html#cb109-17"></a><span class="co">#&gt; 6 349631.3 1458055   1  590      1       0 40.85   1</span></span>
<span id="cb109-18"><a href="dm-base-r.html#cb109-18"></a><span class="co"># Building a &quot;village-level&quot; data frame</span></span>
<span id="cb109-19"><a href="dm-base-r.html#cb109-19"></a>ind &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;x&quot;</span>, gambia[, <span class="dv">1</span>], <span class="st">&quot;y&quot;</span>, gambia[, <span class="dv">2</span>], <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb109-20"><a href="dm-base-r.html#cb109-20"></a>village &lt;-<span class="st"> </span>gambia[<span class="op">!</span><span class="kw">duplicated</span>(ind), <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">7</span><span class="op">:</span><span class="dv">8</span>)]</span>
<span id="cb109-21"><a href="dm-base-r.html#cb109-21"></a>village<span class="op">$</span>prev &lt;-<span class="st"> </span><span class="kw">as.vector</span>(<span class="kw">tapply</span>(gambia<span class="op">$</span>pos, ind, mean))</span>
<span id="cb109-22"><a href="dm-base-r.html#cb109-22"></a><span class="kw">head</span>(village)</span>
<span id="cb109-23"><a href="dm-base-r.html#cb109-23"></a><span class="co">#&gt;            x       y green phc      prev</span></span>
<span id="cb109-24"><a href="dm-base-r.html#cb109-24"></a><span class="co">#&gt; 1   349631.3 1458055 40.85   1 0.5151515</span></span>
<span id="cb109-25"><a href="dm-base-r.html#cb109-25"></a><span class="co">#&gt; 34  358543.1 1460112 40.85   1 0.3015873</span></span>
<span id="cb109-26"><a href="dm-base-r.html#cb109-26"></a><span class="co">#&gt; 97  360308.1 1460026 40.10   0 0.4117647</span></span>
<span id="cb109-27"><a href="dm-base-r.html#cb109-27"></a><span class="co">#&gt; 114 363795.7 1496919 40.85   0 0.3333333</span></span>
<span id="cb109-28"><a href="dm-base-r.html#cb109-28"></a><span class="co">#&gt; 138 366400.5 1460248 40.85   0 0.3846154</span></span>
<span id="cb109-29"><a href="dm-base-r.html#cb109-29"></a><span class="co">#&gt; 164 366687.5 1463002 40.85   0 0.3888889</span></span></code></pre></div>
</div>
<div id="base-transform" class="section level2">
<h2><span class="header-section-number">3.3</span> 数据转换</h2>
<p>transform 对数据框中的某些列做计算，取对数，将计算的结果单存一列加到数据框中</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="dm-base-r.html#cb110-1"></a><span class="kw">transform</span>(iris, <span class="dt">scale.sl =</span> (<span class="kw">max</span>(Sepal.Length) <span class="op">-</span><span class="st"> </span>Sepal.Length) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(Sepal.Length) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(Sepal.Length)))</span>
<span id="cb110-2"><a href="dm-base-r.html#cb110-2"></a><span class="co">#&gt;     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span></span>
<span id="cb110-3"><a href="dm-base-r.html#cb110-3"></a><span class="co">#&gt; 1            5.1         3.5          1.4         0.2     setosa</span></span>
<span id="cb110-4"><a href="dm-base-r.html#cb110-4"></a><span class="co">#&gt; 2            4.9         3.0          1.4         0.2     setosa</span></span>
<span id="cb110-5"><a href="dm-base-r.html#cb110-5"></a><span class="co">#&gt; 3            4.7         3.2          1.3         0.2     setosa</span></span>
<span id="cb110-6"><a href="dm-base-r.html#cb110-6"></a><span class="co">#&gt; 4            4.6         3.1          1.5         0.2     setosa</span></span>
<span id="cb110-7"><a href="dm-base-r.html#cb110-7"></a><span class="co">#&gt; 5            5.0         3.6          1.4         0.2     setosa</span></span>
<span id="cb110-8"><a href="dm-base-r.html#cb110-8"></a>....</span></code></pre></div>
<p>验证一下 <code>scale.sl</code> 变量的第一个值</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="dm-base-r.html#cb111-1"></a>(<span class="kw">max</span>(iris<span class="op">$</span>Sepal.Length) <span class="op">-</span><span class="st"> </span><span class="fl">5.1</span>) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(iris<span class="op">$</span>Sepal.Length) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(iris<span class="op">$</span>Sepal.Length))</span>
<span id="cb111-2"><a href="dm-base-r.html#cb111-2"></a><span class="co">#&gt; [1] 0.7777778</span></span></code></pre></div>
<div class="sidebar">
<p>Warning: This is a convenience function intended for use interactively. For programming it is better to use the standard subsetting arithmetic functions, and in particular the non-standard evaluation of argument <code>transform</code> can have unanticipated consequences.</p>
</div>
</div>
<div id="base-subset" class="section level2">
<h2><span class="header-section-number">3.4</span> 提取子集</h2>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="dm-base-r.html#cb112-1"></a><span class="kw">subset</span>(x, subset, select, <span class="dt">drop =</span> <span class="ot">FALSE</span>, ...)</span></code></pre></div>
<p>参数 <code>subset</code>代表行操作，<code>select</code> 代表列操作，函数 <code>subset</code> 从数据框中提取部分数据</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="dm-base-r.html#cb113-1"></a><span class="kw">subset</span>(iris, Species <span class="op">==</span><span class="st"> &quot;virginica&quot;</span>)</span>
<span id="cb113-2"><a href="dm-base-r.html#cb113-2"></a><span class="co">#&gt;     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species</span></span>
<span id="cb113-3"><a href="dm-base-r.html#cb113-3"></a><span class="co">#&gt; 101          6.3         3.3          6.0         2.5 virginica</span></span>
<span id="cb113-4"><a href="dm-base-r.html#cb113-4"></a><span class="co">#&gt; 102          5.8         2.7          5.1         1.9 virginica</span></span>
<span id="cb113-5"><a href="dm-base-r.html#cb113-5"></a><span class="co">#&gt; 103          7.1         3.0          5.9         2.1 virginica</span></span>
<span id="cb113-6"><a href="dm-base-r.html#cb113-6"></a><span class="co">#&gt; 104          6.3         2.9          5.6         1.8 virginica</span></span>
<span id="cb113-7"><a href="dm-base-r.html#cb113-7"></a><span class="co">#&gt; 105          6.5         3.0          5.8         2.2 virginica</span></span>
<span id="cb113-8"><a href="dm-base-r.html#cb113-8"></a>....</span>
<span id="cb113-9"><a href="dm-base-r.html#cb113-9"></a><span class="co"># summary(iris$Sepal.Length)  mean(iris$Sepal.Length)</span></span>
<span id="cb113-10"><a href="dm-base-r.html#cb113-10"></a><span class="co"># 且的逻辑</span></span>
<span id="cb113-11"><a href="dm-base-r.html#cb113-11"></a><span class="co"># subset(iris, Species == &quot;virginica&quot; &amp; Sepal.Length &gt; 5.84333)</span></span>
<span id="cb113-12"><a href="dm-base-r.html#cb113-12"></a><span class="kw">subset</span>(iris, Species <span class="op">==</span><span class="st"> &quot;virginica&quot;</span> <span class="op">&amp;</span></span>
<span id="cb113-13"><a href="dm-base-r.html#cb113-13"></a><span class="st">  </span>Sepal.Length <span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(Sepal.Length))</span>
<span id="cb113-14"><a href="dm-base-r.html#cb113-14"></a><span class="co">#&gt;     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species</span></span>
<span id="cb113-15"><a href="dm-base-r.html#cb113-15"></a><span class="co">#&gt; 101          6.3         3.3          6.0         2.5 virginica</span></span>
<span id="cb113-16"><a href="dm-base-r.html#cb113-16"></a><span class="co">#&gt; 103          7.1         3.0          5.9         2.1 virginica</span></span>
<span id="cb113-17"><a href="dm-base-r.html#cb113-17"></a><span class="co">#&gt; 104          6.3         2.9          5.6         1.8 virginica</span></span>
<span id="cb113-18"><a href="dm-base-r.html#cb113-18"></a><span class="co">#&gt; 105          6.5         3.0          5.8         2.2 virginica</span></span>
<span id="cb113-19"><a href="dm-base-r.html#cb113-19"></a><span class="co">#&gt; 106          7.6         3.0          6.6         2.1 virginica</span></span>
<span id="cb113-20"><a href="dm-base-r.html#cb113-20"></a>....</span>
<span id="cb113-21"><a href="dm-base-r.html#cb113-21"></a><span class="co"># 在行的子集范围内</span></span>
<span id="cb113-22"><a href="dm-base-r.html#cb113-22"></a><span class="kw">subset</span>(iris, Species <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;virginica&quot;</span>, <span class="st">&quot;versicolor&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb113-23"><a href="dm-base-r.html#cb113-23"></a><span class="st">  </span>Sepal.Length <span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(Sepal.Length))</span>
<span id="cb113-24"><a href="dm-base-r.html#cb113-24"></a><span class="co">#&gt;     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span></span>
<span id="cb113-25"><a href="dm-base-r.html#cb113-25"></a><span class="co">#&gt; 51           7.0         3.2          4.7         1.4 versicolor</span></span>
<span id="cb113-26"><a href="dm-base-r.html#cb113-26"></a><span class="co">#&gt; 52           6.4         3.2          4.5         1.5 versicolor</span></span>
<span id="cb113-27"><a href="dm-base-r.html#cb113-27"></a><span class="co">#&gt; 53           6.9         3.1          4.9         1.5 versicolor</span></span>
<span id="cb113-28"><a href="dm-base-r.html#cb113-28"></a><span class="co">#&gt; 55           6.5         2.8          4.6         1.5 versicolor</span></span>
<span id="cb113-29"><a href="dm-base-r.html#cb113-29"></a><span class="co">#&gt; 57           6.3         3.3          4.7         1.6 versicolor</span></span>
<span id="cb113-30"><a href="dm-base-r.html#cb113-30"></a>....</span>
<span id="cb113-31"><a href="dm-base-r.html#cb113-31"></a><span class="co"># 在列的子集内 先选中列</span></span>
<span id="cb113-32"><a href="dm-base-r.html#cb113-32"></a><span class="kw">subset</span>(iris, Sepal.Length <span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(Sepal.Length),</span>
<span id="cb113-33"><a href="dm-base-r.html#cb113-33"></a>  <span class="dt">select =</span> <span class="kw">c</span>(<span class="st">&quot;Sepal.Length&quot;</span>, <span class="st">&quot;Species&quot;</span>)</span>
<span id="cb113-34"><a href="dm-base-r.html#cb113-34"></a>)</span>
<span id="cb113-35"><a href="dm-base-r.html#cb113-35"></a><span class="co">#&gt;     Sepal.Length    Species</span></span>
<span id="cb113-36"><a href="dm-base-r.html#cb113-36"></a><span class="co">#&gt; 51           7.0 versicolor</span></span>
<span id="cb113-37"><a href="dm-base-r.html#cb113-37"></a><span class="co">#&gt; 52           6.4 versicolor</span></span>
<span id="cb113-38"><a href="dm-base-r.html#cb113-38"></a><span class="co">#&gt; 53           6.9 versicolor</span></span>
<span id="cb113-39"><a href="dm-base-r.html#cb113-39"></a><span class="co">#&gt; 55           6.5 versicolor</span></span>
<span id="cb113-40"><a href="dm-base-r.html#cb113-40"></a><span class="co">#&gt; 57           6.3 versicolor</span></span>
<span id="cb113-41"><a href="dm-base-r.html#cb113-41"></a>....</span></code></pre></div>
<p>高级操作：加入正则表达式筛选</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="dm-base-r.html#cb114-1"></a><span class="co">## sometimes requiring a logical &#39;subset&#39; argument is a nuisance</span></span>
<span id="cb114-2"><a href="dm-base-r.html#cb114-2"></a>nm &lt;-<span class="st"> </span><span class="kw">rownames</span>(state.x77)</span>
<span id="cb114-3"><a href="dm-base-r.html#cb114-3"></a>start_with_M &lt;-<span class="st"> </span>nm <span class="op">%in%</span><span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;^M&quot;</span>, nm, <span class="dt">value =</span> <span class="ot">TRUE</span>)</span>
<span id="cb114-4"><a href="dm-base-r.html#cb114-4"></a><span class="kw">subset</span>(state.x77, start_with_M, Illiteracy<span class="op">:</span>Murder)</span>
<span id="cb114-5"><a href="dm-base-r.html#cb114-5"></a><span class="co">#&gt;               Illiteracy Life Exp Murder</span></span>
<span id="cb114-6"><a href="dm-base-r.html#cb114-6"></a><span class="co">#&gt; Maine                0.7    70.39    2.7</span></span>
<span id="cb114-7"><a href="dm-base-r.html#cb114-7"></a><span class="co">#&gt; Maryland             0.9    70.22    8.5</span></span>
<span id="cb114-8"><a href="dm-base-r.html#cb114-8"></a><span class="co">#&gt; Massachusetts        1.1    71.83    3.3</span></span>
<span id="cb114-9"><a href="dm-base-r.html#cb114-9"></a><span class="co">#&gt; Michigan             0.9    70.63   11.1</span></span>
<span id="cb114-10"><a href="dm-base-r.html#cb114-10"></a><span class="co">#&gt; Minnesota            0.6    72.96    2.3</span></span>
<span id="cb114-11"><a href="dm-base-r.html#cb114-11"></a><span class="co">#&gt; Mississippi          2.4    68.09   12.5</span></span>
<span id="cb114-12"><a href="dm-base-r.html#cb114-12"></a><span class="co">#&gt; Missouri             0.8    70.69    9.3</span></span>
<span id="cb114-13"><a href="dm-base-r.html#cb114-13"></a><span class="co">#&gt; Montana              0.6    70.56    5.0</span></span>
<span id="cb114-14"><a href="dm-base-r.html#cb114-14"></a><span class="co"># 简化</span></span>
<span id="cb114-15"><a href="dm-base-r.html#cb114-15"></a><span class="kw">subset</span>(state.x77, <span class="dt">subset =</span> <span class="kw">grepl</span>(<span class="st">&quot;^M&quot;</span>, <span class="kw">rownames</span>(state.x77)), <span class="dt">select =</span> Illiteracy<span class="op">:</span>Murder)</span>
<span id="cb114-16"><a href="dm-base-r.html#cb114-16"></a><span class="co">#&gt;               Illiteracy Life Exp Murder</span></span>
<span id="cb114-17"><a href="dm-base-r.html#cb114-17"></a><span class="co">#&gt; Maine                0.7    70.39    2.7</span></span>
<span id="cb114-18"><a href="dm-base-r.html#cb114-18"></a><span class="co">#&gt; Maryland             0.9    70.22    8.5</span></span>
<span id="cb114-19"><a href="dm-base-r.html#cb114-19"></a><span class="co">#&gt; Massachusetts        1.1    71.83    3.3</span></span>
<span id="cb114-20"><a href="dm-base-r.html#cb114-20"></a><span class="co">#&gt; Michigan             0.9    70.63   11.1</span></span>
<span id="cb114-21"><a href="dm-base-r.html#cb114-21"></a><span class="co">#&gt; Minnesota            0.6    72.96    2.3</span></span>
<span id="cb114-22"><a href="dm-base-r.html#cb114-22"></a><span class="co">#&gt; Mississippi          2.4    68.09   12.5</span></span>
<span id="cb114-23"><a href="dm-base-r.html#cb114-23"></a><span class="co">#&gt; Missouri             0.8    70.69    9.3</span></span>
<span id="cb114-24"><a href="dm-base-r.html#cb114-24"></a><span class="co">#&gt; Montana              0.6    70.56    5.0</span></span>
<span id="cb114-25"><a href="dm-base-r.html#cb114-25"></a><span class="co"># 继续简化</span></span>
<span id="cb114-26"><a href="dm-base-r.html#cb114-26"></a><span class="kw">subset</span>(state.x77, <span class="kw">grepl</span>(<span class="st">&quot;^M&quot;</span>, <span class="kw">rownames</span>(state.x77)), Illiteracy<span class="op">:</span>Murder)</span>
<span id="cb114-27"><a href="dm-base-r.html#cb114-27"></a><span class="co">#&gt;               Illiteracy Life Exp Murder</span></span>
<span id="cb114-28"><a href="dm-base-r.html#cb114-28"></a><span class="co">#&gt; Maine                0.7    70.39    2.7</span></span>
<span id="cb114-29"><a href="dm-base-r.html#cb114-29"></a><span class="co">#&gt; Maryland             0.9    70.22    8.5</span></span>
<span id="cb114-30"><a href="dm-base-r.html#cb114-30"></a><span class="co">#&gt; Massachusetts        1.1    71.83    3.3</span></span>
<span id="cb114-31"><a href="dm-base-r.html#cb114-31"></a><span class="co">#&gt; Michigan             0.9    70.63   11.1</span></span>
<span id="cb114-32"><a href="dm-base-r.html#cb114-32"></a><span class="co">#&gt; Minnesota            0.6    72.96    2.3</span></span>
<span id="cb114-33"><a href="dm-base-r.html#cb114-33"></a><span class="co">#&gt; Mississippi          2.4    68.09   12.5</span></span>
<span id="cb114-34"><a href="dm-base-r.html#cb114-34"></a><span class="co">#&gt; Missouri             0.8    70.69    9.3</span></span>
<span id="cb114-35"><a href="dm-base-r.html#cb114-35"></a><span class="co">#&gt; Montana              0.6    70.56    5.0</span></span></code></pre></div>
<div class="sidebar">
<p>警告：这是一个为了交互使用打造的便捷函数。对于编程，最好使用标准的子集函数，如 <code>[</code>，特别地，参数 <code>subset</code> 的非标准计算(non-standard evaluation)<a href="99-references.html#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a> 可能带来意想不到的后果。</p>
</div>
<p>使用索引 <code>[</code></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="dm-base-r.html#cb115-1"></a>iris[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;virginica&quot;</span>, ]</span>
<span id="cb115-2"><a href="dm-base-r.html#cb115-2"></a><span class="co">#&gt;     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species</span></span>
<span id="cb115-3"><a href="dm-base-r.html#cb115-3"></a><span class="co">#&gt; 101          6.3         3.3          6.0         2.5 virginica</span></span>
<span id="cb115-4"><a href="dm-base-r.html#cb115-4"></a><span class="co">#&gt; 102          5.8         2.7          5.1         1.9 virginica</span></span>
<span id="cb115-5"><a href="dm-base-r.html#cb115-5"></a><span class="co">#&gt; 103          7.1         3.0          5.9         2.1 virginica</span></span>
<span id="cb115-6"><a href="dm-base-r.html#cb115-6"></a><span class="co">#&gt; 104          6.3         2.9          5.6         1.8 virginica</span></span>
<span id="cb115-7"><a href="dm-base-r.html#cb115-7"></a><span class="co">#&gt; 105          6.5         3.0          5.8         2.2 virginica</span></span>
<span id="cb115-8"><a href="dm-base-r.html#cb115-8"></a>....</span>
<span id="cb115-9"><a href="dm-base-r.html#cb115-9"></a>iris[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;virginica&quot;</span> <span class="op">&amp;</span></span>
<span id="cb115-10"><a href="dm-base-r.html#cb115-10"></a><span class="st">  </span>iris<span class="op">$</span>Sepal.Length <span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(iris<span class="op">$</span>Sepal.Length), ]</span>
<span id="cb115-11"><a href="dm-base-r.html#cb115-11"></a><span class="co">#&gt;     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species</span></span>
<span id="cb115-12"><a href="dm-base-r.html#cb115-12"></a><span class="co">#&gt; 101          6.3         3.3          6.0         2.5 virginica</span></span>
<span id="cb115-13"><a href="dm-base-r.html#cb115-13"></a><span class="co">#&gt; 103          7.1         3.0          5.9         2.1 virginica</span></span>
<span id="cb115-14"><a href="dm-base-r.html#cb115-14"></a><span class="co">#&gt; 104          6.3         2.9          5.6         1.8 virginica</span></span>
<span id="cb115-15"><a href="dm-base-r.html#cb115-15"></a><span class="co">#&gt; 105          6.5         3.0          5.8         2.2 virginica</span></span>
<span id="cb115-16"><a href="dm-base-r.html#cb115-16"></a><span class="co">#&gt; 106          7.6         3.0          6.6         2.1 virginica</span></span>
<span id="cb115-17"><a href="dm-base-r.html#cb115-17"></a>....</span>
<span id="cb115-18"><a href="dm-base-r.html#cb115-18"></a></span>
<span id="cb115-19"><a href="dm-base-r.html#cb115-19"></a>iris[</span>
<span id="cb115-20"><a href="dm-base-r.html#cb115-20"></a>  iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;virginica&quot;</span> <span class="op">&amp;</span></span>
<span id="cb115-21"><a href="dm-base-r.html#cb115-21"></a><span class="st">    </span>iris<span class="op">$</span>Sepal.Length <span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(iris<span class="op">$</span>Sepal.Length),</span>
<span id="cb115-22"><a href="dm-base-r.html#cb115-22"></a>  <span class="kw">c</span>(<span class="st">&quot;Sepal.Length&quot;</span>, <span class="st">&quot;Species&quot;</span>)</span>
<span id="cb115-23"><a href="dm-base-r.html#cb115-23"></a>]</span>
<span id="cb115-24"><a href="dm-base-r.html#cb115-24"></a><span class="co">#&gt;     Sepal.Length   Species</span></span>
<span id="cb115-25"><a href="dm-base-r.html#cb115-25"></a><span class="co">#&gt; 101          6.3 virginica</span></span>
<span id="cb115-26"><a href="dm-base-r.html#cb115-26"></a><span class="co">#&gt; 103          7.1 virginica</span></span>
<span id="cb115-27"><a href="dm-base-r.html#cb115-27"></a><span class="co">#&gt; 104          6.3 virginica</span></span>
<span id="cb115-28"><a href="dm-base-r.html#cb115-28"></a><span class="co">#&gt; 105          6.5 virginica</span></span>
<span id="cb115-29"><a href="dm-base-r.html#cb115-29"></a><span class="co">#&gt; 106          7.6 virginica</span></span>
<span id="cb115-30"><a href="dm-base-r.html#cb115-30"></a>....</span></code></pre></div>
</div>
<div id="base-order" class="section level2">
<h2><span class="header-section-number">3.5</span> 按列排序</h2>
<p>在数据框内，根据(order)某一列或几列对行进行排序(sort)，根据鸢尾花(iris)的类别(Species)对萼片(sepal)的长度进行排序，其余的列随之变化</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="dm-base-r.html#cb116-1"></a><span class="co"># 对萼片的长度排序</span></span>
<span id="cb116-2"><a href="dm-base-r.html#cb116-2"></a>iris[<span class="kw">order</span>(iris<span class="op">$</span>Species, iris<span class="op">$</span>Sepal.Length), ]</span>
<span id="cb116-3"><a href="dm-base-r.html#cb116-3"></a><span class="co">#&gt;     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span></span>
<span id="cb116-4"><a href="dm-base-r.html#cb116-4"></a><span class="co">#&gt; 14           4.3         3.0          1.1         0.1     setosa</span></span>
<span id="cb116-5"><a href="dm-base-r.html#cb116-5"></a><span class="co">#&gt; 9            4.4         2.9          1.4         0.2     setosa</span></span>
<span id="cb116-6"><a href="dm-base-r.html#cb116-6"></a><span class="co">#&gt; 39           4.4         3.0          1.3         0.2     setosa</span></span>
<span id="cb116-7"><a href="dm-base-r.html#cb116-7"></a><span class="co">#&gt; 43           4.4         3.2          1.3         0.2     setosa</span></span>
<span id="cb116-8"><a href="dm-base-r.html#cb116-8"></a><span class="co">#&gt; 42           4.5         2.3          1.3         0.3     setosa</span></span>
<span id="cb116-9"><a href="dm-base-r.html#cb116-9"></a>....</span>
<span id="cb116-10"><a href="dm-base-r.html#cb116-10"></a><span class="co"># 对花瓣的长度排序</span></span>
<span id="cb116-11"><a href="dm-base-r.html#cb116-11"></a>iris[<span class="kw">order</span>(iris<span class="op">$</span>Species, iris<span class="op">$</span>Petal.Length), ]</span>
<span id="cb116-12"><a href="dm-base-r.html#cb116-12"></a><span class="co">#&gt;     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span></span>
<span id="cb116-13"><a href="dm-base-r.html#cb116-13"></a><span class="co">#&gt; 23           4.6         3.6          1.0         0.2     setosa</span></span>
<span id="cb116-14"><a href="dm-base-r.html#cb116-14"></a><span class="co">#&gt; 14           4.3         3.0          1.1         0.1     setosa</span></span>
<span id="cb116-15"><a href="dm-base-r.html#cb116-15"></a><span class="co">#&gt; 15           5.8         4.0          1.2         0.2     setosa</span></span>
<span id="cb116-16"><a href="dm-base-r.html#cb116-16"></a><span class="co">#&gt; 36           5.0         3.2          1.2         0.2     setosa</span></span>
<span id="cb116-17"><a href="dm-base-r.html#cb116-17"></a><span class="co">#&gt; 3            4.7         3.2          1.3         0.2     setosa</span></span>
<span id="cb116-18"><a href="dm-base-r.html#cb116-18"></a>....</span>
<span id="cb116-19"><a href="dm-base-r.html#cb116-19"></a><span class="co"># 先对花瓣的宽度排序，再对花瓣的长度排序</span></span>
<span id="cb116-20"><a href="dm-base-r.html#cb116-20"></a>iris[<span class="kw">order</span>(iris<span class="op">$</span>Petal.Width, iris<span class="op">$</span>Petal.Length), ]</span>
<span id="cb116-21"><a href="dm-base-r.html#cb116-21"></a><span class="co">#&gt;     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span></span>
<span id="cb116-22"><a href="dm-base-r.html#cb116-22"></a><span class="co">#&gt; 14           4.3         3.0          1.1         0.1     setosa</span></span>
<span id="cb116-23"><a href="dm-base-r.html#cb116-23"></a><span class="co">#&gt; 13           4.8         3.0          1.4         0.1     setosa</span></span>
<span id="cb116-24"><a href="dm-base-r.html#cb116-24"></a><span class="co">#&gt; 38           4.9         3.6          1.4         0.1     setosa</span></span>
<span id="cb116-25"><a href="dm-base-r.html#cb116-25"></a><span class="co">#&gt; 10           4.9         3.1          1.5         0.1     setosa</span></span>
<span id="cb116-26"><a href="dm-base-r.html#cb116-26"></a><span class="co">#&gt; 33           5.2         4.1          1.5         0.1     setosa</span></span>
<span id="cb116-27"><a href="dm-base-r.html#cb116-27"></a>....</span></code></pre></div>
<p>sort/ordered 排序， 默认是升序</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="dm-base-r.html#cb117-1"></a>dd &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb117-2"><a href="dm-base-r.html#cb117-2"></a>  <span class="dt">b =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Hi&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;Hi&quot;</span>, <span class="st">&quot;Low&quot;</span>),</span>
<span id="cb117-3"><a href="dm-base-r.html#cb117-3"></a>    <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;Hi&quot;</span>), <span class="dt">ordered =</span> <span class="ot">TRUE</span></span>
<span id="cb117-4"><a href="dm-base-r.html#cb117-4"></a>  ),</span>
<span id="cb117-5"><a href="dm-base-r.html#cb117-5"></a>  <span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;C&quot;</span>), <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">9</span>, <span class="dv">9</span>),</span>
<span id="cb117-6"><a href="dm-base-r.html#cb117-6"></a>  <span class="dt">z =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb117-7"><a href="dm-base-r.html#cb117-7"></a>)</span>
<span id="cb117-8"><a href="dm-base-r.html#cb117-8"></a><span class="kw">str</span>(dd)</span>
<span id="cb117-9"><a href="dm-base-r.html#cb117-9"></a><span class="co">#&gt; &#39;data.frame&#39;:    4 obs. of  4 variables:</span></span>
<span id="cb117-10"><a href="dm-base-r.html#cb117-10"></a><span class="co">#&gt;  $ b: Ord.factor w/ 3 levels &quot;Low&quot;&lt;&quot;Med&quot;&lt;&quot;Hi&quot;: 3 2 3 1</span></span>
<span id="cb117-11"><a href="dm-base-r.html#cb117-11"></a><span class="co">#&gt;  $ x: chr  &quot;A&quot; &quot;D&quot; &quot;A&quot; &quot;C&quot;</span></span>
<span id="cb117-12"><a href="dm-base-r.html#cb117-12"></a><span class="co">#&gt;  $ y: num  8 3 9 9</span></span>
<span id="cb117-13"><a href="dm-base-r.html#cb117-13"></a><span class="co">#&gt;  $ z: num  1 1 1 2</span></span>
<span id="cb117-14"><a href="dm-base-r.html#cb117-14"></a>dd[<span class="kw">order</span>(<span class="op">-</span>dd[,<span class="dv">4</span>], dd[,<span class="dv">1</span>]), ]</span>
<span id="cb117-15"><a href="dm-base-r.html#cb117-15"></a><span class="co">#&gt;     b x y z</span></span>
<span id="cb117-16"><a href="dm-base-r.html#cb117-16"></a><span class="co">#&gt; 4 Low C 9 2</span></span>
<span id="cb117-17"><a href="dm-base-r.html#cb117-17"></a><span class="co">#&gt; 2 Med D 3 1</span></span>
<span id="cb117-18"><a href="dm-base-r.html#cb117-18"></a><span class="co">#&gt; 1  Hi A 8 1</span></span>
<span id="cb117-19"><a href="dm-base-r.html#cb117-19"></a><span class="co">#&gt; 3  Hi A 9 1</span></span></code></pre></div>
<p>根据变量 z</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="dm-base-r.html#cb118-1"></a>dd[<span class="kw">order</span>(dd<span class="op">$</span>z, dd<span class="op">$</span>b), ]</span>
<span id="cb118-2"><a href="dm-base-r.html#cb118-2"></a><span class="co">#&gt;     b x y z</span></span>
<span id="cb118-3"><a href="dm-base-r.html#cb118-3"></a><span class="co">#&gt; 2 Med D 3 1</span></span>
<span id="cb118-4"><a href="dm-base-r.html#cb118-4"></a><span class="co">#&gt; 1  Hi A 8 1</span></span>
<span id="cb118-5"><a href="dm-base-r.html#cb118-5"></a><span class="co">#&gt; 3  Hi A 9 1</span></span>
<span id="cb118-6"><a href="dm-base-r.html#cb118-6"></a><span class="co">#&gt; 4 Low C 9 2</span></span></code></pre></div>
</div>
<div id="base-split" class="section level2">
<h2><span class="header-section-number">3.6</span> 数据拆分</h2>
<p>数据拆分通常是按找某一个分类变量分组，分完组就是计算，计算完就把结果按照原来的分组方式合并</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="dm-base-r.html#cb119-1"></a><span class="co">## Notice that assignment form is not used since a variable is being added</span></span>
<span id="cb119-2"><a href="dm-base-r.html#cb119-2"></a>g &lt;-<span class="st"> </span>airquality<span class="op">$</span>Month</span>
<span id="cb119-3"><a href="dm-base-r.html#cb119-3"></a>l &lt;-<span class="st"> </span><span class="kw">split</span>(airquality, g) <span class="co"># 分组</span></span>
<span id="cb119-4"><a href="dm-base-r.html#cb119-4"></a>l &lt;-<span class="st"> </span><span class="kw">lapply</span>(l, transform, <span class="dt">Oz.Z =</span> <span class="kw">scale</span>(Ozone)) <span class="co"># 计算：按月对 Ozone 标准化</span></span>
<span id="cb119-5"><a href="dm-base-r.html#cb119-5"></a>aq2 &lt;-<span class="st"> </span><span class="kw">unsplit</span>(l, g) <span class="co"># 合并</span></span>
<span id="cb119-6"><a href="dm-base-r.html#cb119-6"></a><span class="kw">head</span>(aq2)</span>
<span id="cb119-7"><a href="dm-base-r.html#cb119-7"></a><span class="co">#&gt;   Ozone Solar.R Wind Temp Month Day       Oz.Z</span></span>
<span id="cb119-8"><a href="dm-base-r.html#cb119-8"></a><span class="co">#&gt; 1    41     190  7.4   67     5   1  0.7822293</span></span>
<span id="cb119-9"><a href="dm-base-r.html#cb119-9"></a><span class="co">#&gt; 2    36     118  8.0   72     5   2  0.5572518</span></span>
<span id="cb119-10"><a href="dm-base-r.html#cb119-10"></a><span class="co">#&gt; 3    12     149 12.6   74     5   3 -0.5226399</span></span>
<span id="cb119-11"><a href="dm-base-r.html#cb119-11"></a><span class="co">#&gt; 4    18     313 11.5   62     5   4 -0.2526670</span></span>
<span id="cb119-12"><a href="dm-base-r.html#cb119-12"></a><span class="co">#&gt; 5    NA      NA 14.3   56     5   5         NA</span></span>
<span id="cb119-13"><a href="dm-base-r.html#cb119-13"></a><span class="co">#&gt; 6    28      NA 14.9   66     5   6  0.1972879</span></span></code></pre></div>
<p>tapply 自带分组的功能，按月份 Month 对 Ozone 中心标准化，其返回一个列表</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="dm-base-r.html#cb120-1"></a><span class="kw">with</span>(airquality, <span class="kw">tapply</span>(Ozone, Month, scale))</span>
<span id="cb120-2"><a href="dm-base-r.html#cb120-2"></a><span class="co">#&gt; $`5`</span></span>
<span id="cb120-3"><a href="dm-base-r.html#cb120-3"></a><span class="co">#&gt;              [,1]</span></span>
<span id="cb120-4"><a href="dm-base-r.html#cb120-4"></a><span class="co">#&gt;  [1,]  0.78222929</span></span>
<span id="cb120-5"><a href="dm-base-r.html#cb120-5"></a><span class="co">#&gt;  [2,]  0.55725184</span></span>
<span id="cb120-6"><a href="dm-base-r.html#cb120-6"></a><span class="co">#&gt;  [3,] -0.52263993</span></span>
<span id="cb120-7"><a href="dm-base-r.html#cb120-7"></a><span class="co">#&gt;  [4,] -0.25266698</span></span>
<span id="cb120-8"><a href="dm-base-r.html#cb120-8"></a><span class="co">#&gt;  [5,]          NA</span></span>
<span id="cb120-9"><a href="dm-base-r.html#cb120-9"></a><span class="co">#&gt;  [6,]  0.19728792</span></span>
<span id="cb120-10"><a href="dm-base-r.html#cb120-10"></a><span class="co">#&gt;  [7,] -0.02768953</span></span>
<span id="cb120-11"><a href="dm-base-r.html#cb120-11"></a><span class="co">#&gt;  [8,] -0.20767149</span></span>
<span id="cb120-12"><a href="dm-base-r.html#cb120-12"></a>....</span></code></pre></div>
<p>上面的过程等价于</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="dm-base-r.html#cb121-1"></a><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, <span class="kw">lapply</span>(<span class="kw">split</span>(airquality, airquality<span class="op">$</span>Month), transform, <span class="dt">Oz.Z =</span> <span class="kw">scale</span>(Ozone)))</span>
<span id="cb121-2"><a href="dm-base-r.html#cb121-2"></a><span class="co">#&gt;       Ozone Solar.R Wind Temp Month Day         Oz.Z</span></span>
<span id="cb121-3"><a href="dm-base-r.html#cb121-3"></a><span class="co">#&gt; 5.1      41     190  7.4   67     5   1  0.782229293</span></span>
<span id="cb121-4"><a href="dm-base-r.html#cb121-4"></a><span class="co">#&gt; 5.2      36     118  8.0   72     5   2  0.557251841</span></span>
<span id="cb121-5"><a href="dm-base-r.html#cb121-5"></a><span class="co">#&gt; 5.3      12     149 12.6   74     5   3 -0.522639926</span></span>
<span id="cb121-6"><a href="dm-base-r.html#cb121-6"></a><span class="co">#&gt; 5.4      18     313 11.5   62     5   4 -0.252666984</span></span>
<span id="cb121-7"><a href="dm-base-r.html#cb121-7"></a><span class="co">#&gt; 5.5      NA      NA 14.3   56     5   5           NA</span></span>
<span id="cb121-8"><a href="dm-base-r.html#cb121-8"></a><span class="co">#&gt; 5.6      28      NA 14.9   66     5   6  0.197287919</span></span>
<span id="cb121-9"><a href="dm-base-r.html#cb121-9"></a><span class="co">#&gt; 5.7      23     299  8.6   65     5   7 -0.027689532</span></span>
<span id="cb121-10"><a href="dm-base-r.html#cb121-10"></a><span class="co">#&gt; 5.8      19      99 13.8   59     5   8 -0.207671494</span></span>
<span id="cb121-11"><a href="dm-base-r.html#cb121-11"></a><span class="co">#&gt; 5.9       8      19 20.1   61     5   9 -0.702621887</span></span>
<span id="cb121-12"><a href="dm-base-r.html#cb121-12"></a>....</span></code></pre></div>
<p>由于上面对 Ozone 正态标准化，所以标准化后的 <code>Oz.z</code> 再按月分组计算方差自然每个月都是 1，而均值都是 0。</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="dm-base-r.html#cb122-1"></a><span class="kw">with</span>(aq2, <span class="kw">tapply</span>(Oz.Z, Month, sd, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb122-2"><a href="dm-base-r.html#cb122-2"></a><span class="co">#&gt; 5 6 7 8 9 </span></span>
<span id="cb122-3"><a href="dm-base-r.html#cb122-3"></a><span class="co">#&gt; 1 1 1 1 1</span></span>
<span id="cb122-4"><a href="dm-base-r.html#cb122-4"></a><span class="kw">with</span>(aq2, <span class="kw">tapply</span>(Oz.Z, Month, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb122-5"><a href="dm-base-r.html#cb122-5"></a><span class="co">#&gt;             5             6             7             8             9 </span></span>
<span id="cb122-6"><a href="dm-base-r.html#cb122-6"></a><span class="co">#&gt; -4.240273e-17  1.052760e-16  5.841432e-17  5.898060e-17  2.571709e-17</span></span></code></pre></div>
<blockquote>
<p>循着这个思路，我们可以用 tapply 实现分组计算，上面函数 <code>sd</code> 和 <code>mean</code> 完全可以用自定义的更加复杂的函数替代</p>
</blockquote>
<p><code>cut</code> 函数可以将连续型变量划分为分类变量</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="dm-base-r.html#cb123-1"></a><span class="kw">set.seed</span>(<span class="dv">2019</span>)</span>
<span id="cb123-2"><a href="dm-base-r.html#cb123-2"></a>Z &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb123-3"><a href="dm-base-r.html#cb123-3"></a><span class="kw">cut</span>(Z, <span class="dt">breaks =</span> <span class="dv">-6</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb123-4"><a href="dm-base-r.html#cb123-4"></a><span class="co">#&gt;  [1] (0,1]   (-1,0]  (-2,-1] (0,1]   (-2,-1] (0,1]   (-1,0]  (0,1]  </span></span>
<span id="cb123-5"><a href="dm-base-r.html#cb123-5"></a><span class="co">#&gt;  [9] (-2,-1] (-1,0] </span></span>
<span id="cb123-6"><a href="dm-base-r.html#cb123-6"></a><span class="co">#&gt; 12 Levels: (-6,-5] (-5,-4] (-4,-3] (-3,-2] (-2,-1] (-1,0] (0,1] ... (5,6]</span></span>
<span id="cb123-7"><a href="dm-base-r.html#cb123-7"></a><span class="co"># labels = FALSE 返回每个数所落的区间位置</span></span>
<span id="cb123-8"><a href="dm-base-r.html#cb123-8"></a><span class="kw">cut</span>(Z, <span class="dt">breaks =</span> <span class="dv">-6</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">labels =</span> <span class="ot">FALSE</span>)</span>
<span id="cb123-9"><a href="dm-base-r.html#cb123-9"></a><span class="co">#&gt;  [1] 7 6 5 7 5 7 6 7 5 6</span></span></code></pre></div>
<p>我们还可以指定参数 <code>dig.lab</code> 设置分组的精度，<code>ordered</code> 将分组变量看作是有序的，<code>breaks</code> 传递单个数时，表示分组数，而不是断点</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="dm-base-r.html#cb124-1"></a><span class="kw">cut</span>(Z, <span class="dt">breaks =</span> <span class="dv">3</span>, <span class="dt">dig.lab =</span> <span class="dv">4</span>, <span class="dt">ordered =</span> <span class="ot">TRUE</span>)</span>
<span id="cb124-2"><a href="dm-base-r.html#cb124-2"></a><span class="co">#&gt;  [1] (0.06396,0.9186]  (-0.7881,0.06396] (-1.643,-0.7881] </span></span>
<span id="cb124-3"><a href="dm-base-r.html#cb124-3"></a><span class="co">#&gt;  [4] (0.06396,0.9186]  (-1.643,-0.7881]  (0.06396,0.9186] </span></span>
<span id="cb124-4"><a href="dm-base-r.html#cb124-4"></a><span class="co">#&gt;  [7] (-0.7881,0.06396] (0.06396,0.9186]  (-1.643,-0.7881] </span></span>
<span id="cb124-5"><a href="dm-base-r.html#cb124-5"></a><span class="co">#&gt; [10] (-0.7881,0.06396]</span></span>
<span id="cb124-6"><a href="dm-base-r.html#cb124-6"></a><span class="co">#&gt; Levels: (-1.643,-0.7881] &lt; (-0.7881,0.06396] &lt; (0.06396,0.9186]</span></span></code></pre></div>
<p>此时，统计每组的频数，如图 <a href="dm-base-r.html#fig:cut">3.1</a></p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="dm-base-r.html#cb125-1"></a><span class="co"># 条形图</span></span>
<span id="cb125-2"><a href="dm-base-r.html#cb125-2"></a><span class="kw">plot</span>(<span class="kw">cut</span>(Z, <span class="dt">breaks =</span> <span class="dv">-6</span><span class="op">:</span><span class="dv">6</span>))</span>
<span id="cb125-3"><a href="dm-base-r.html#cb125-3"></a><span class="co"># 直方图</span></span>
<span id="cb125-4"><a href="dm-base-r.html#cb125-4"></a><span class="kw">hist</span>(Z, <span class="dt">breaks =</span> <span class="dv">-6</span><span class="op">:</span><span class="dv">6</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:cut"></span>
<img src="dm-base-r_files/figure-html/cut-1.png" alt="连续型变量分组统计" width="35%" /><img src="dm-base-r_files/figure-html/cut-2.png" alt="连续型变量分组统计" width="35%" />
<p class="caption">
图 3.1: 连续型变量分组统计
</p>
</div>
<p>在指定分组数的情况下，我们还想获取分组的断点</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="dm-base-r.html#cb126-1"></a>labs &lt;-<span class="st"> </span><span class="kw">levels</span>(<span class="kw">cut</span>(Z, <span class="dv">3</span>))</span>
<span id="cb126-2"><a href="dm-base-r.html#cb126-2"></a>labs</span>
<span id="cb126-3"><a href="dm-base-r.html#cb126-3"></a><span class="co">#&gt; [1] &quot;(-1.64,-0.788]&quot; &quot;(-0.788,0.064]&quot; &quot;(0.064,0.919]&quot;</span></span></code></pre></div>
<p>用正则表达式抽取断点</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="dm-base-r.html#cb127-1"></a><span class="kw">cbind</span>(</span>
<span id="cb127-2"><a href="dm-base-r.html#cb127-2"></a>  <span class="dt">lower =</span> <span class="kw">as.numeric</span>(<span class="kw">sub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">((.+),.*&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&quot;</span>, labs)),</span>
<span id="cb127-3"><a href="dm-base-r.html#cb127-3"></a>  <span class="dt">upper =</span> <span class="kw">as.numeric</span>(<span class="kw">sub</span>(<span class="st">&quot;[^,]*,([^]]*)</span><span class="ch">\\</span><span class="st">]&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&quot;</span>, labs))</span>
<span id="cb127-4"><a href="dm-base-r.html#cb127-4"></a>)</span>
<span id="cb127-5"><a href="dm-base-r.html#cb127-5"></a><span class="co">#&gt;       lower  upper</span></span>
<span id="cb127-6"><a href="dm-base-r.html#cb127-6"></a><span class="co">#&gt; [1,] -1.640 -0.788</span></span>
<span id="cb127-7"><a href="dm-base-r.html#cb127-7"></a><span class="co">#&gt; [2,] -0.788  0.064</span></span>
<span id="cb127-8"><a href="dm-base-r.html#cb127-8"></a><span class="co">#&gt; [3,]  0.064  0.919</span></span></code></pre></div>
<p>更多相关函数可以参考 <code>findInterval</code> 和 <code>embed</code></p>
<p>tabulate 和 table 有所不同，它表示排列</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="dm-base-r.html#cb128-1"></a><span class="kw">t</span>(<span class="kw">combn</span>(<span class="dv">8</span>, <span class="dv">4</span>, tabulate, <span class="dt">nbins =</span> <span class="dv">8</span>))</span>
<span id="cb128-2"><a href="dm-base-r.html#cb128-2"></a><span class="co">#&gt;       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]</span></span>
<span id="cb128-3"><a href="dm-base-r.html#cb128-3"></a><span class="co">#&gt;  [1,]    1    1    1    1    0    0    0    0</span></span>
<span id="cb128-4"><a href="dm-base-r.html#cb128-4"></a><span class="co">#&gt;  [2,]    1    1    1    0    1    0    0    0</span></span>
<span id="cb128-5"><a href="dm-base-r.html#cb128-5"></a><span class="co">#&gt;  [3,]    1    1    1    0    0    1    0    0</span></span>
<span id="cb128-6"><a href="dm-base-r.html#cb128-6"></a><span class="co">#&gt;  [4,]    1    1    1    0    0    0    1    0</span></span>
<span id="cb128-7"><a href="dm-base-r.html#cb128-7"></a><span class="co">#&gt;  [5,]    1    1    1    0    0    0    0    1</span></span>
<span id="cb128-8"><a href="dm-base-r.html#cb128-8"></a>....</span></code></pre></div>
</div>
<div id="base-merge" class="section level2">
<h2><span class="header-section-number">3.7</span> 数据合并</h2>
<p>merge 合并两个数据框</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="dm-base-r.html#cb129-1"></a>authors &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb129-2"><a href="dm-base-r.html#cb129-2"></a>  <span class="co">## I(*) : use character columns of names to get sensible sort order</span></span>
<span id="cb129-3"><a href="dm-base-r.html#cb129-3"></a>  <span class="dt">surname =</span> <span class="kw">I</span>(<span class="kw">c</span>(<span class="st">&quot;Tukey&quot;</span>, <span class="st">&quot;Venables&quot;</span>, <span class="st">&quot;Tierney&quot;</span>, <span class="st">&quot;Ripley&quot;</span>, <span class="st">&quot;McNeil&quot;</span>)),</span>
<span id="cb129-4"><a href="dm-base-r.html#cb129-4"></a>  <span class="dt">nationality =</span> <span class="kw">c</span>(<span class="st">&quot;US&quot;</span>, <span class="st">&quot;Australia&quot;</span>, <span class="st">&quot;US&quot;</span>, <span class="st">&quot;UK&quot;</span>, <span class="st">&quot;Australia&quot;</span>),</span>
<span id="cb129-5"><a href="dm-base-r.html#cb129-5"></a>  <span class="dt">deceased =</span> <span class="kw">c</span>(<span class="st">&quot;yes&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;no&quot;</span>, <span class="dv">4</span>))</span>
<span id="cb129-6"><a href="dm-base-r.html#cb129-6"></a>)</span>
<span id="cb129-7"><a href="dm-base-r.html#cb129-7"></a>authorN &lt;-<span class="st"> </span><span class="kw">within</span>(authors, {</span>
<span id="cb129-8"><a href="dm-base-r.html#cb129-8"></a>  name &lt;-<span class="st"> </span>surname</span>
<span id="cb129-9"><a href="dm-base-r.html#cb129-9"></a>  <span class="kw">rm</span>(surname)</span>
<span id="cb129-10"><a href="dm-base-r.html#cb129-10"></a>})</span>
<span id="cb129-11"><a href="dm-base-r.html#cb129-11"></a>books &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb129-12"><a href="dm-base-r.html#cb129-12"></a>  <span class="dt">name =</span> <span class="kw">I</span>(<span class="kw">c</span>(</span>
<span id="cb129-13"><a href="dm-base-r.html#cb129-13"></a>    <span class="st">&quot;Tukey&quot;</span>, <span class="st">&quot;Venables&quot;</span>, <span class="st">&quot;Tierney&quot;</span>,</span>
<span id="cb129-14"><a href="dm-base-r.html#cb129-14"></a>    <span class="st">&quot;Ripley&quot;</span>, <span class="st">&quot;Ripley&quot;</span>, <span class="st">&quot;McNeil&quot;</span>, <span class="st">&quot;R Core&quot;</span></span>
<span id="cb129-15"><a href="dm-base-r.html#cb129-15"></a>  )),</span>
<span id="cb129-16"><a href="dm-base-r.html#cb129-16"></a>  <span class="dt">title =</span> <span class="kw">c</span>(</span>
<span id="cb129-17"><a href="dm-base-r.html#cb129-17"></a>    <span class="st">&quot;Exploratory Data Analysis&quot;</span>,</span>
<span id="cb129-18"><a href="dm-base-r.html#cb129-18"></a>    <span class="st">&quot;Modern Applied Statistics ...&quot;</span>,</span>
<span id="cb129-19"><a href="dm-base-r.html#cb129-19"></a>    <span class="st">&quot;LISP-STAT&quot;</span>,</span>
<span id="cb129-20"><a href="dm-base-r.html#cb129-20"></a>    <span class="st">&quot;Spatial Statistics&quot;</span>, <span class="st">&quot;Stochastic Simulation&quot;</span>,</span>
<span id="cb129-21"><a href="dm-base-r.html#cb129-21"></a>    <span class="st">&quot;Interactive Data Analysis&quot;</span>,</span>
<span id="cb129-22"><a href="dm-base-r.html#cb129-22"></a>    <span class="st">&quot;An Introduction to R&quot;</span></span>
<span id="cb129-23"><a href="dm-base-r.html#cb129-23"></a>  ),</span>
<span id="cb129-24"><a href="dm-base-r.html#cb129-24"></a>  <span class="dt">other.author =</span> <span class="kw">c</span>(</span>
<span id="cb129-25"><a href="dm-base-r.html#cb129-25"></a>    <span class="ot">NA</span>, <span class="st">&quot;Ripley&quot;</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>,</span>
<span id="cb129-26"><a href="dm-base-r.html#cb129-26"></a>    <span class="st">&quot;Venables &amp; Smith&quot;</span></span>
<span id="cb129-27"><a href="dm-base-r.html#cb129-27"></a>  )</span>
<span id="cb129-28"><a href="dm-base-r.html#cb129-28"></a>)</span>
<span id="cb129-29"><a href="dm-base-r.html#cb129-29"></a></span>
<span id="cb129-30"><a href="dm-base-r.html#cb129-30"></a>authors</span>
<span id="cb129-31"><a href="dm-base-r.html#cb129-31"></a><span class="co">#&gt;    surname nationality deceased</span></span>
<span id="cb129-32"><a href="dm-base-r.html#cb129-32"></a><span class="co">#&gt; 1    Tukey          US      yes</span></span>
<span id="cb129-33"><a href="dm-base-r.html#cb129-33"></a><span class="co">#&gt; 2 Venables   Australia       no</span></span>
<span id="cb129-34"><a href="dm-base-r.html#cb129-34"></a><span class="co">#&gt; 3  Tierney          US       no</span></span>
<span id="cb129-35"><a href="dm-base-r.html#cb129-35"></a><span class="co">#&gt; 4   Ripley          UK       no</span></span>
<span id="cb129-36"><a href="dm-base-r.html#cb129-36"></a><span class="co">#&gt; 5   McNeil   Australia       no</span></span>
<span id="cb129-37"><a href="dm-base-r.html#cb129-37"></a>authorN</span>
<span id="cb129-38"><a href="dm-base-r.html#cb129-38"></a><span class="co">#&gt;   nationality deceased     name</span></span>
<span id="cb129-39"><a href="dm-base-r.html#cb129-39"></a><span class="co">#&gt; 1          US      yes    Tukey</span></span>
<span id="cb129-40"><a href="dm-base-r.html#cb129-40"></a><span class="co">#&gt; 2   Australia       no Venables</span></span>
<span id="cb129-41"><a href="dm-base-r.html#cb129-41"></a><span class="co">#&gt; 3          US       no  Tierney</span></span>
<span id="cb129-42"><a href="dm-base-r.html#cb129-42"></a><span class="co">#&gt; 4          UK       no   Ripley</span></span>
<span id="cb129-43"><a href="dm-base-r.html#cb129-43"></a><span class="co">#&gt; 5   Australia       no   McNeil</span></span>
<span id="cb129-44"><a href="dm-base-r.html#cb129-44"></a>books</span>
<span id="cb129-45"><a href="dm-base-r.html#cb129-45"></a><span class="co">#&gt;       name                         title     other.author</span></span>
<span id="cb129-46"><a href="dm-base-r.html#cb129-46"></a><span class="co">#&gt; 1    Tukey     Exploratory Data Analysis             &lt;NA&gt;</span></span>
<span id="cb129-47"><a href="dm-base-r.html#cb129-47"></a><span class="co">#&gt; 2 Venables Modern Applied Statistics ...           Ripley</span></span>
<span id="cb129-48"><a href="dm-base-r.html#cb129-48"></a><span class="co">#&gt; 3  Tierney                     LISP-STAT             &lt;NA&gt;</span></span>
<span id="cb129-49"><a href="dm-base-r.html#cb129-49"></a><span class="co">#&gt; 4   Ripley            Spatial Statistics             &lt;NA&gt;</span></span>
<span id="cb129-50"><a href="dm-base-r.html#cb129-50"></a><span class="co">#&gt; 5   Ripley         Stochastic Simulation             &lt;NA&gt;</span></span>
<span id="cb129-51"><a href="dm-base-r.html#cb129-51"></a><span class="co">#&gt; 6   McNeil     Interactive Data Analysis             &lt;NA&gt;</span></span>
<span id="cb129-52"><a href="dm-base-r.html#cb129-52"></a><span class="co">#&gt; 7   R Core          An Introduction to R Venables &amp; Smith</span></span></code></pre></div>
<p>默认找到同名的列，然后是同名的行合并，多余的没有匹配到的就丢掉</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="dm-base-r.html#cb130-1"></a><span class="kw">merge</span>(authorN, books)</span>
<span id="cb130-2"><a href="dm-base-r.html#cb130-2"></a><span class="co">#&gt;       name nationality deceased                         title other.author</span></span>
<span id="cb130-3"><a href="dm-base-r.html#cb130-3"></a><span class="co">#&gt; 1   McNeil   Australia       no     Interactive Data Analysis         &lt;NA&gt;</span></span>
<span id="cb130-4"><a href="dm-base-r.html#cb130-4"></a><span class="co">#&gt; 2   Ripley          UK       no            Spatial Statistics         &lt;NA&gt;</span></span>
<span id="cb130-5"><a href="dm-base-r.html#cb130-5"></a><span class="co">#&gt; 3   Ripley          UK       no         Stochastic Simulation         &lt;NA&gt;</span></span>
<span id="cb130-6"><a href="dm-base-r.html#cb130-6"></a><span class="co">#&gt; 4  Tierney          US       no                     LISP-STAT         &lt;NA&gt;</span></span>
<span id="cb130-7"><a href="dm-base-r.html#cb130-7"></a><span class="co">#&gt; 5    Tukey          US      yes     Exploratory Data Analysis         &lt;NA&gt;</span></span>
<span id="cb130-8"><a href="dm-base-r.html#cb130-8"></a><span class="co">#&gt; 6 Venables   Australia       no Modern Applied Statistics ...       Ripley</span></span></code></pre></div>
<p>还可以指定合并的列，先按照 surname 合并，留下 surname</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="dm-base-r.html#cb131-1"></a><span class="kw">merge</span>(authors, books, <span class="dt">by.x =</span> <span class="st">&quot;surname&quot;</span>, <span class="dt">by.y =</span> <span class="st">&quot;name&quot;</span>)</span>
<span id="cb131-2"><a href="dm-base-r.html#cb131-2"></a><span class="co">#&gt;    surname nationality deceased                         title other.author</span></span>
<span id="cb131-3"><a href="dm-base-r.html#cb131-3"></a><span class="co">#&gt; 1   McNeil   Australia       no     Interactive Data Analysis         &lt;NA&gt;</span></span>
<span id="cb131-4"><a href="dm-base-r.html#cb131-4"></a><span class="co">#&gt; 2   Ripley          UK       no            Spatial Statistics         &lt;NA&gt;</span></span>
<span id="cb131-5"><a href="dm-base-r.html#cb131-5"></a><span class="co">#&gt; 3   Ripley          UK       no         Stochastic Simulation         &lt;NA&gt;</span></span>
<span id="cb131-6"><a href="dm-base-r.html#cb131-6"></a><span class="co">#&gt; 4  Tierney          US       no                     LISP-STAT         &lt;NA&gt;</span></span>
<span id="cb131-7"><a href="dm-base-r.html#cb131-7"></a><span class="co">#&gt; 5    Tukey          US      yes     Exploratory Data Analysis         &lt;NA&gt;</span></span>
<span id="cb131-8"><a href="dm-base-r.html#cb131-8"></a><span class="co">#&gt; 6 Venables   Australia       no Modern Applied Statistics ...       Ripley</span></span></code></pre></div>
<p>留下的是 name</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="dm-base-r.html#cb132-1"></a><span class="kw">merge</span>(books, authors, <span class="dt">by.x =</span> <span class="st">&quot;name&quot;</span>, <span class="dt">by.y =</span> <span class="st">&quot;surname&quot;</span>)</span>
<span id="cb132-2"><a href="dm-base-r.html#cb132-2"></a><span class="co">#&gt;       name                         title other.author nationality deceased</span></span>
<span id="cb132-3"><a href="dm-base-r.html#cb132-3"></a><span class="co">#&gt; 1   McNeil     Interactive Data Analysis         &lt;NA&gt;   Australia       no</span></span>
<span id="cb132-4"><a href="dm-base-r.html#cb132-4"></a><span class="co">#&gt; 2   Ripley            Spatial Statistics         &lt;NA&gt;          UK       no</span></span>
<span id="cb132-5"><a href="dm-base-r.html#cb132-5"></a><span class="co">#&gt; 3   Ripley         Stochastic Simulation         &lt;NA&gt;          UK       no</span></span>
<span id="cb132-6"><a href="dm-base-r.html#cb132-6"></a><span class="co">#&gt; 4  Tierney                     LISP-STAT         &lt;NA&gt;          US       no</span></span>
<span id="cb132-7"><a href="dm-base-r.html#cb132-7"></a><span class="co">#&gt; 5    Tukey     Exploratory Data Analysis         &lt;NA&gt;          US      yes</span></span>
<span id="cb132-8"><a href="dm-base-r.html#cb132-8"></a><span class="co">#&gt; 6 Venables Modern Applied Statistics ...       Ripley   Australia       no</span></span></code></pre></div>
<p>为了比较清楚地观察几种合并的区别，这里提供对应的动画展示 <a href="https://github.com/gadenbuie/tidyexplain" class="uri">https://github.com/gadenbuie/tidyexplain</a></p>
<p>(inner, outer, left, right, cross) join 共5种合并方式详情请看 <a href="https://stackoverflow.com/questions/1299871" class="uri">https://stackoverflow.com/questions/1299871</a></p>
<p>cbind 和 rbind 分别是按列和行合并数据框</p>
</div>
<div id="base-duplicated" class="section level2">
<h2><span class="header-section-number">3.8</span> 数据去重</h2>
<p>单个数值型向量去重，此时和 unique 函数作用一样</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="dm-base-r.html#cb133-1"></a>(x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">9</span><span class="op">:</span><span class="dv">20</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">3</span><span class="op">:</span><span class="dv">7</span>, <span class="dv">0</span><span class="op">:</span><span class="dv">8</span>))</span>
<span id="cb133-2"><a href="dm-base-r.html#cb133-2"></a><span class="co">#&gt;  [1]  9 10 11 12 13 14 15 16 17 18 19 20  1  2  3  4  5  3  4  5  6  7  0</span></span>
<span id="cb133-3"><a href="dm-base-r.html#cb133-3"></a><span class="co">#&gt; [24]  1  2  3  4  5  6  7  8</span></span>
<span id="cb133-4"><a href="dm-base-r.html#cb133-4"></a><span class="co">## extract unique elements</span></span>
<span id="cb133-5"><a href="dm-base-r.html#cb133-5"></a>x[<span class="op">!</span><span class="kw">duplicated</span>(x)]</span>
<span id="cb133-6"><a href="dm-base-r.html#cb133-6"></a><span class="co">#&gt;  [1]  9 10 11 12 13 14 15 16 17 18 19 20  1  2  3  4  5  6  7  0  8</span></span>
<span id="cb133-7"><a href="dm-base-r.html#cb133-7"></a><span class="kw">unique</span>(x)</span>
<span id="cb133-8"><a href="dm-base-r.html#cb133-8"></a><span class="co">#&gt;  [1]  9 10 11 12 13 14 15 16 17 18 19 20  1  2  3  4  5  6  7  0  8</span></span></code></pre></div>
<p>数据框类型数据中，去除重复的行，这个重复可以是多个变量对应的向量</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="dm-base-r.html#cb134-1"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb134-2"><a href="dm-base-r.html#cb134-2"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb134-3"><a href="dm-base-r.html#cb134-3"></a>  <span class="dt">x =</span> <span class="kw">sample</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dv">10</span>, <span class="dt">replace =</span> T),</span>
<span id="cb134-4"><a href="dm-base-r.html#cb134-4"></a>  <span class="dt">y =</span> <span class="kw">sample</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dv">10</span>, <span class="dt">replace =</span> T),</span>
<span id="cb134-5"><a href="dm-base-r.html#cb134-5"></a>  <span class="dt">z =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb134-6"><a href="dm-base-r.html#cb134-6"></a>)</span>
<span id="cb134-7"><a href="dm-base-r.html#cb134-7"></a>df</span>
<span id="cb134-8"><a href="dm-base-r.html#cb134-8"></a><span class="co">#&gt;    x y  z</span></span>
<span id="cb134-9"><a href="dm-base-r.html#cb134-9"></a><span class="co">#&gt; 1  0 1  1</span></span>
<span id="cb134-10"><a href="dm-base-r.html#cb134-10"></a><span class="co">#&gt; 2  0 1  2</span></span>
<span id="cb134-11"><a href="dm-base-r.html#cb134-11"></a><span class="co">#&gt; 3  0 1  3</span></span>
<span id="cb134-12"><a href="dm-base-r.html#cb134-12"></a><span class="co">#&gt; 4  1 0  4</span></span>
<span id="cb134-13"><a href="dm-base-r.html#cb134-13"></a><span class="co">#&gt; 5  0 1  5</span></span>
<span id="cb134-14"><a href="dm-base-r.html#cb134-14"></a><span class="co">#&gt; 6  1 0  6</span></span>
<span id="cb134-15"><a href="dm-base-r.html#cb134-15"></a><span class="co">#&gt; 7  1 1  7</span></span>
<span id="cb134-16"><a href="dm-base-r.html#cb134-16"></a><span class="co">#&gt; 8  1 0  8</span></span>
<span id="cb134-17"><a href="dm-base-r.html#cb134-17"></a><span class="co">#&gt; 9  0 0  9</span></span>
<span id="cb134-18"><a href="dm-base-r.html#cb134-18"></a><span class="co">#&gt; 10 0 0 10</span></span>
<span id="cb134-19"><a href="dm-base-r.html#cb134-19"></a>df[<span class="op">!</span><span class="kw">duplicated</span>(df[, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]), ]</span>
<span id="cb134-20"><a href="dm-base-r.html#cb134-20"></a><span class="co">#&gt;   x y z</span></span>
<span id="cb134-21"><a href="dm-base-r.html#cb134-21"></a><span class="co">#&gt; 1 0 1 1</span></span>
<span id="cb134-22"><a href="dm-base-r.html#cb134-22"></a><span class="co">#&gt; 4 1 0 4</span></span>
<span id="cb134-23"><a href="dm-base-r.html#cb134-23"></a><span class="co">#&gt; 7 1 1 7</span></span>
<span id="cb134-24"><a href="dm-base-r.html#cb134-24"></a><span class="co">#&gt; 9 0 0 9</span></span></code></pre></div>
</div>
<div id="base-aggregate" class="section level2">
<h2><span class="header-section-number">3.9</span> 数据聚合</h2>
<p>分组求和 <a href="https://stackoverflow.com/questions/1660124" class="uri">https://stackoverflow.com/questions/1660124</a></p>
<p>主要是分组统计</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="dm-base-r.html#cb135-1"></a><span class="kw">apropos</span>(<span class="st">&quot;apply&quot;</span>)</span>
<span id="cb135-2"><a href="dm-base-r.html#cb135-2"></a><span class="co">#&gt;  [1] &quot;apply&quot;      &quot;dendrapply&quot; &quot;eapply&quot;     &quot;kernapply&quot;  &quot;lapply&quot;    </span></span>
<span id="cb135-3"><a href="dm-base-r.html#cb135-3"></a><span class="co">#&gt;  [6] &quot;mapply&quot;     &quot;rapply&quot;     &quot;sapply&quot;     &quot;tapply&quot;     &quot;vapply&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="dm-base-r.html#cb136-1"></a><span class="co"># 分组求和 colSums colMeans max</span></span>
<span id="cb136-2"><a href="dm-base-r.html#cb136-2"></a><span class="kw">unique</span>(iris<span class="op">$</span>Species)</span>
<span id="cb136-3"><a href="dm-base-r.html#cb136-3"></a><span class="co">#&gt; [1] setosa     versicolor virginica </span></span>
<span id="cb136-4"><a href="dm-base-r.html#cb136-4"></a><span class="co">#&gt; Levels: setosa versicolor virginica</span></span>
<span id="cb136-5"><a href="dm-base-r.html#cb136-5"></a><span class="co"># 分类求和</span></span>
<span id="cb136-6"><a href="dm-base-r.html#cb136-6"></a><span class="co"># colSums(iris[iris$Species == &quot;setosa&quot;, -5])</span></span>
<span id="cb136-7"><a href="dm-base-r.html#cb136-7"></a><span class="co"># colSums(iris[iris$Species == &quot;virginica&quot;, -5])</span></span>
<span id="cb136-8"><a href="dm-base-r.html#cb136-8"></a><span class="kw">colSums</span>(iris[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;versicolor&quot;</span>, <span class="dv">-5</span>])</span>
<span id="cb136-9"><a href="dm-base-r.html#cb136-9"></a><span class="co">#&gt; Sepal.Length  Sepal.Width Petal.Length  Petal.Width </span></span>
<span id="cb136-10"><a href="dm-base-r.html#cb136-10"></a><span class="co">#&gt;        296.8        138.5        213.0         66.3</span></span>
<span id="cb136-11"><a href="dm-base-r.html#cb136-11"></a><span class="co"># apply(iris[iris$Species == &quot;setosa&quot;, -5], 2, sum)</span></span>
<span id="cb136-12"><a href="dm-base-r.html#cb136-12"></a><span class="co"># apply(iris[iris$Species == &quot;setosa&quot;, -5], 2, mean)</span></span>
<span id="cb136-13"><a href="dm-base-r.html#cb136-13"></a><span class="co"># apply(iris[iris$Species == &quot;setosa&quot;, -5], 2, min)</span></span>
<span id="cb136-14"><a href="dm-base-r.html#cb136-14"></a><span class="co"># apply(iris[iris$Species == &quot;setosa&quot;, -5], 2, max)</span></span>
<span id="cb136-15"><a href="dm-base-r.html#cb136-15"></a><span class="kw">apply</span>(iris[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;setosa&quot;</span>, <span class="dv">-5</span>], <span class="dv">2</span>, quantile)</span>
<span id="cb136-16"><a href="dm-base-r.html#cb136-16"></a><span class="co">#&gt;      Sepal.Length Sepal.Width Petal.Length Petal.Width</span></span>
<span id="cb136-17"><a href="dm-base-r.html#cb136-17"></a><span class="co">#&gt; 0%            4.3       2.300        1.000         0.1</span></span>
<span id="cb136-18"><a href="dm-base-r.html#cb136-18"></a><span class="co">#&gt; 25%           4.8       3.200        1.400         0.2</span></span>
<span id="cb136-19"><a href="dm-base-r.html#cb136-19"></a><span class="co">#&gt; 50%           5.0       3.400        1.500         0.2</span></span>
<span id="cb136-20"><a href="dm-base-r.html#cb136-20"></a><span class="co">#&gt; 75%           5.2       3.675        1.575         0.3</span></span>
<span id="cb136-21"><a href="dm-base-r.html#cb136-21"></a><span class="co">#&gt; 100%          5.8       4.400        1.900         0.6</span></span></code></pre></div>
<p>aggregate: Compute Summary Statistics of Data Subsets</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="dm-base-r.html#cb137-1"></a><span class="co"># 按分类变量 Species 分组求和</span></span>
<span id="cb137-2"><a href="dm-base-r.html#cb137-2"></a><span class="co"># aggregate(subset(iris, select = -Species), by = list(iris[, &quot;Species&quot;]), FUN = sum)</span></span>
<span id="cb137-3"><a href="dm-base-r.html#cb137-3"></a><span class="kw">aggregate</span>(iris[, <span class="dv">-5</span>], <span class="kw">list</span>(iris[, <span class="dv">5</span>]), sum)</span>
<span id="cb137-4"><a href="dm-base-r.html#cb137-4"></a><span class="co">#&gt;      Group.1 Sepal.Length Sepal.Width Petal.Length Petal.Width</span></span>
<span id="cb137-5"><a href="dm-base-r.html#cb137-5"></a><span class="co">#&gt; 1     setosa        250.3       171.4         73.1        12.3</span></span>
<span id="cb137-6"><a href="dm-base-r.html#cb137-6"></a><span class="co">#&gt; 2 versicolor        296.8       138.5        213.0        66.3</span></span>
<span id="cb137-7"><a href="dm-base-r.html#cb137-7"></a><span class="co">#&gt; 3  virginica        329.4       148.7        277.6       101.3</span></span>
<span id="cb137-8"><a href="dm-base-r.html#cb137-8"></a><span class="co"># 先确定位置，假设有很多分类变量</span></span>
<span id="cb137-9"><a href="dm-base-r.html#cb137-9"></a>ind &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="st">&quot;Species&quot;</span> <span class="op">==</span><span class="st"> </span><span class="kw">colnames</span>(iris))</span>
<span id="cb137-10"><a href="dm-base-r.html#cb137-10"></a><span class="co"># 分组统计</span></span>
<span id="cb137-11"><a href="dm-base-r.html#cb137-11"></a><span class="kw">aggregate</span>(iris[, <span class="op">-</span>ind], <span class="kw">list</span>(iris[, ind]), sum)</span>
<span id="cb137-12"><a href="dm-base-r.html#cb137-12"></a><span class="co">#&gt;      Group.1 Sepal.Length Sepal.Width Petal.Length Petal.Width</span></span>
<span id="cb137-13"><a href="dm-base-r.html#cb137-13"></a><span class="co">#&gt; 1     setosa        250.3       171.4         73.1        12.3</span></span>
<span id="cb137-14"><a href="dm-base-r.html#cb137-14"></a><span class="co">#&gt; 2 versicolor        296.8       138.5        213.0        66.3</span></span>
<span id="cb137-15"><a href="dm-base-r.html#cb137-15"></a><span class="co">#&gt; 3  virginica        329.4       148.7        277.6       101.3</span></span></code></pre></div>
<p>按照 Species 划分的类别，分组计算，使用公式表示形式，右边一定是分类变量，否则会报错误或者警告，输出奇怪的结果，请读者尝试运行<code>aggregate(Species ~ Sepal.Length, data = iris, mean)</code>。公式法表示分组计算，<code>~</code> 左手边可以做加 <code>+</code> 减 <code>-</code> 乘 <code>*</code> 除 <code>/</code> 取余 <code>%%</code> 等数学运算。下面以数据集 iris 为例，只对 Sepal.Length 按 Species 分组计算</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="dm-base-r.html#cb138-1"></a><span class="kw">aggregate</span>(Sepal.Length <span class="op">~</span><span class="st"> </span>Species, <span class="dt">data =</span> iris, mean)</span>
<span id="cb138-2"><a href="dm-base-r.html#cb138-2"></a><span class="co">#&gt;      Species Sepal.Length</span></span>
<span id="cb138-3"><a href="dm-base-r.html#cb138-3"></a><span class="co">#&gt; 1     setosa        5.006</span></span>
<span id="cb138-4"><a href="dm-base-r.html#cb138-4"></a><span class="co">#&gt; 2 versicolor        5.936</span></span>
<span id="cb138-5"><a href="dm-base-r.html#cb138-5"></a><span class="co">#&gt; 3  virginica        6.588</span></span></code></pre></div>
<p>与上述分组统计结果一样的命令，在大数据集上， 与 aggregate 相比，tapply 要快很多，by 是 tapply 的包裹，处理速度差不多。读者可以构造伪随机数据集验证。</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="dm-base-r.html#cb139-1"></a><span class="co"># tapply(iris$Sepal.Length, list(iris$Species), mean)</span></span>
<span id="cb139-2"><a href="dm-base-r.html#cb139-2"></a><span class="kw">with</span>(iris, <span class="kw">tapply</span>(Sepal.Length, Species, mean))</span>
<span id="cb139-3"><a href="dm-base-r.html#cb139-3"></a><span class="co">#&gt;     setosa versicolor  virginica </span></span>
<span id="cb139-4"><a href="dm-base-r.html#cb139-4"></a><span class="co">#&gt;      5.006      5.936      6.588</span></span>
<span id="cb139-5"><a href="dm-base-r.html#cb139-5"></a><span class="kw">by</span>(iris<span class="op">$</span>Sepal.Length, iris<span class="op">$</span>Species, mean)</span>
<span id="cb139-6"><a href="dm-base-r.html#cb139-6"></a><span class="co">#&gt; iris$Species: setosa</span></span>
<span id="cb139-7"><a href="dm-base-r.html#cb139-7"></a><span class="co">#&gt; [1] 5.006</span></span>
<span id="cb139-8"><a href="dm-base-r.html#cb139-8"></a><span class="co">#&gt; -------------------------------------------------------- </span></span>
<span id="cb139-9"><a href="dm-base-r.html#cb139-9"></a><span class="co">#&gt; iris$Species: versicolor</span></span>
<span id="cb139-10"><a href="dm-base-r.html#cb139-10"></a><span class="co">#&gt; [1] 5.936</span></span>
<span id="cb139-11"><a href="dm-base-r.html#cb139-11"></a><span class="co">#&gt; -------------------------------------------------------- </span></span>
<span id="cb139-12"><a href="dm-base-r.html#cb139-12"></a><span class="co">#&gt; iris$Species: virginica</span></span>
<span id="cb139-13"><a href="dm-base-r.html#cb139-13"></a><span class="co">#&gt; [1] 6.588</span></span></code></pre></div>
<p>对所有变量按 Species 分组计算</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="dm-base-r.html#cb140-1"></a><span class="kw">aggregate</span>(. <span class="op">~</span><span class="st"> </span>Species, <span class="dt">data =</span> iris, mean)</span>
<span id="cb140-2"><a href="dm-base-r.html#cb140-2"></a><span class="co">#&gt;      Species Sepal.Length Sepal.Width Petal.Length Petal.Width</span></span>
<span id="cb140-3"><a href="dm-base-r.html#cb140-3"></a><span class="co">#&gt; 1     setosa        5.006       3.428        1.462       0.246</span></span>
<span id="cb140-4"><a href="dm-base-r.html#cb140-4"></a><span class="co">#&gt; 2 versicolor        5.936       2.770        4.260       1.326</span></span>
<span id="cb140-5"><a href="dm-base-r.html#cb140-5"></a><span class="co">#&gt; 3  virginica        6.588       2.974        5.552       2.026</span></span></code></pre></div>
<p>对变量 Sepal.Length 和 Sepal.Width 求和后，按 Species 分组计算</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="dm-base-r.html#cb141-1"></a><span class="kw">aggregate</span>(Sepal.Length <span class="op">+</span><span class="st"> </span>Sepal.Width <span class="op">~</span><span class="st"> </span>Species, <span class="dt">data =</span> iris, mean)</span>
<span id="cb141-2"><a href="dm-base-r.html#cb141-2"></a><span class="co">#&gt;      Species Sepal.Length + Sepal.Width</span></span>
<span id="cb141-3"><a href="dm-base-r.html#cb141-3"></a><span class="co">#&gt; 1     setosa                      8.434</span></span>
<span id="cb141-4"><a href="dm-base-r.html#cb141-4"></a><span class="co">#&gt; 2 versicolor                      8.706</span></span>
<span id="cb141-5"><a href="dm-base-r.html#cb141-5"></a><span class="co">#&gt; 3  virginica                      9.562</span></span></code></pre></div>
<p>对多个分类变量做分组计算，在数据集 ChickWeight 中 Chick和Diet都是数字编码的分类变量，其中 Chick 是有序的因子变量，Diet 是无序的因子变量，而 Time 是数值型的变量，表示小鸡出生的天数。</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="dm-base-r.html#cb142-1"></a><span class="co"># 查看数据</span></span>
<span id="cb142-2"><a href="dm-base-r.html#cb142-2"></a><span class="kw">str</span>(ChickWeight)</span>
<span id="cb142-3"><a href="dm-base-r.html#cb142-3"></a><span class="co">#&gt; Classes &#39;nfnGroupedData&#39;, &#39;nfGroupedData&#39;, &#39;groupedData&#39; and &#39;data.frame&#39;:   578 obs. of  4 variables:</span></span>
<span id="cb142-4"><a href="dm-base-r.html#cb142-4"></a><span class="co">#&gt;  $ weight: num  42 51 59 64 76 93 106 125 149 171 ...</span></span>
<span id="cb142-5"><a href="dm-base-r.html#cb142-5"></a><span class="co">#&gt;  $ Time  : num  0 2 4 6 8 10 12 14 16 18 ...</span></span>
<span id="cb142-6"><a href="dm-base-r.html#cb142-6"></a><span class="co">#&gt;  $ Chick : Ord.factor w/ 50 levels &quot;18&quot;&lt;&quot;16&quot;&lt;&quot;15&quot;&lt;..: 15 15 15 15 15 15 1..</span></span>
<span id="cb142-7"><a href="dm-base-r.html#cb142-7"></a><span class="co">#&gt;  $ Diet  : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb142-8"><a href="dm-base-r.html#cb142-8"></a><span class="co">#&gt;  - attr(*, &quot;formula&quot;)=Class &#39;formula&#39;  language weight ~ Time | Chick</span></span>
<span id="cb142-9"><a href="dm-base-r.html#cb142-9"></a><span class="co">#&gt;   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_EmptyEnv&gt; </span></span>
<span id="cb142-10"><a href="dm-base-r.html#cb142-10"></a><span class="co">#&gt;  - attr(*, &quot;outer&quot;)=Class &#39;formula&#39;  language ~Diet</span></span>
<span id="cb142-11"><a href="dm-base-r.html#cb142-11"></a><span class="co">#&gt;   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_EmptyEnv&gt; </span></span>
<span id="cb142-12"><a href="dm-base-r.html#cb142-12"></a><span class="co">#&gt;  - attr(*, &quot;labels&quot;)=List of 2</span></span>
<span id="cb142-13"><a href="dm-base-r.html#cb142-13"></a><span class="co">#&gt;   ..$ x: chr &quot;Time&quot;</span></span>
<span id="cb142-14"><a href="dm-base-r.html#cb142-14"></a><span class="co">#&gt;   ..$ y: chr &quot;Body weight&quot;</span></span>
<span id="cb142-15"><a href="dm-base-r.html#cb142-15"></a><span class="co">#&gt;  - attr(*, &quot;units&quot;)=List of 2</span></span>
<span id="cb142-16"><a href="dm-base-r.html#cb142-16"></a><span class="co">#&gt;   ..$ x: chr &quot;(days)&quot;</span></span>
<span id="cb142-17"><a href="dm-base-r.html#cb142-17"></a><span class="co">#&gt;   ..$ y: chr &quot;(gm)&quot;</span></span></code></pre></div>
<p>查看数据集ChickWeight的前几行</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="dm-base-r.html#cb143-1"></a><span class="kw">head</span>(ChickWeight)</span>
<span id="cb143-2"><a href="dm-base-r.html#cb143-2"></a><span class="co">#&gt;   weight Time Chick Diet</span></span>
<span id="cb143-3"><a href="dm-base-r.html#cb143-3"></a><span class="co">#&gt; 1     42    0     1    1</span></span>
<span id="cb143-4"><a href="dm-base-r.html#cb143-4"></a><span class="co">#&gt; 2     51    2     1    1</span></span>
<span id="cb143-5"><a href="dm-base-r.html#cb143-5"></a><span class="co">#&gt; 3     59    4     1    1</span></span>
<span id="cb143-6"><a href="dm-base-r.html#cb143-6"></a><span class="co">#&gt; 4     64    6     1    1</span></span>
<span id="cb143-7"><a href="dm-base-r.html#cb143-7"></a><span class="co">#&gt; 5     76    8     1    1</span></span>
<span id="cb143-8"><a href="dm-base-r.html#cb143-8"></a>....</span>
<span id="cb143-9"><a href="dm-base-r.html#cb143-9"></a><span class="kw">str</span>(ChickWeight)</span>
<span id="cb143-10"><a href="dm-base-r.html#cb143-10"></a><span class="co">#&gt; Classes &#39;nfnGroupedData&#39;, &#39;nfGroupedData&#39;, &#39;groupedData&#39; and &#39;data.frame&#39;:   578 obs. of  4 variables:</span></span>
<span id="cb143-11"><a href="dm-base-r.html#cb143-11"></a><span class="co">#&gt;  $ weight: num  42 51 59 64 76 93 106 125 149 171 ...</span></span>
<span id="cb143-12"><a href="dm-base-r.html#cb143-12"></a><span class="co">#&gt;  $ Time  : num  0 2 4 6 8 10 12 14 16 18 ...</span></span>
<span id="cb143-13"><a href="dm-base-r.html#cb143-13"></a><span class="co">#&gt;  $ Chick : Ord.factor w/ 50 levels &quot;18&quot;&lt;&quot;16&quot;&lt;&quot;15&quot;&lt;..: 15 15 15 15 15 15 1..</span></span>
<span id="cb143-14"><a href="dm-base-r.html#cb143-14"></a><span class="co">#&gt;  $ Diet  : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb143-15"><a href="dm-base-r.html#cb143-15"></a><span class="co">#&gt;  - attr(*, &quot;formula&quot;)=Class &#39;formula&#39;  language weight ~ Time | Chick</span></span>
<span id="cb143-16"><a href="dm-base-r.html#cb143-16"></a>....</span></code></pre></div>
<p>对于数据集ChickWeight中的有序变量Chick，aggregate 会按照既定顺序返回分组计算的结果</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="dm-base-r.html#cb144-1"></a><span class="kw">aggregate</span>(weight <span class="op">~</span><span class="st"> </span>Chick, <span class="dt">data =</span> ChickWeight, mean)</span>
<span id="cb144-2"><a href="dm-base-r.html#cb144-2"></a><span class="co">#&gt;    Chick    weight</span></span>
<span id="cb144-3"><a href="dm-base-r.html#cb144-3"></a><span class="co">#&gt; 1     18  37.00000</span></span>
<span id="cb144-4"><a href="dm-base-r.html#cb144-4"></a><span class="co">#&gt; 2     16  49.71429</span></span>
<span id="cb144-5"><a href="dm-base-r.html#cb144-5"></a><span class="co">#&gt; 3     15  60.12500</span></span>
<span id="cb144-6"><a href="dm-base-r.html#cb144-6"></a><span class="co">#&gt; 4     13  67.83333</span></span>
<span id="cb144-7"><a href="dm-base-r.html#cb144-7"></a><span class="co">#&gt; 5      9  81.16667</span></span>
<span id="cb144-8"><a href="dm-base-r.html#cb144-8"></a>....</span>
<span id="cb144-9"><a href="dm-base-r.html#cb144-9"></a><span class="kw">aggregate</span>(weight <span class="op">~</span><span class="st"> </span>Diet, <span class="dt">data =</span> ChickWeight, mean)</span>
<span id="cb144-10"><a href="dm-base-r.html#cb144-10"></a><span class="co">#&gt;   Diet   weight</span></span>
<span id="cb144-11"><a href="dm-base-r.html#cb144-11"></a><span class="co">#&gt; 1    1 102.6455</span></span>
<span id="cb144-12"><a href="dm-base-r.html#cb144-12"></a><span class="co">#&gt; 2    2 122.6167</span></span>
<span id="cb144-13"><a href="dm-base-r.html#cb144-13"></a><span class="co">#&gt; 3    3 142.9500</span></span>
<span id="cb144-14"><a href="dm-base-r.html#cb144-14"></a><span class="co">#&gt; 4    4 135.2627</span></span></code></pre></div>
<p>分类变量没有用数字编码，以 CO2 数据集为例，该数据集描述草植对二氧化碳的吸收情况，Plant 是具有12个水平的有序的因子变量，Type表示植物的源头分别是魁北克(Quebec)和密西西比(Mississippi)，Treatment表示冷却(chilled)和不冷却(nonchilled)两种处理方式，conc表示周围环境中二氧化碳的浓度，uptake表示植物吸收二氧化碳的速率。</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="dm-base-r.html#cb145-1"></a><span class="co"># 查看数据集</span></span>
<span id="cb145-2"><a href="dm-base-r.html#cb145-2"></a><span class="kw">head</span>(CO2)</span>
<span id="cb145-3"><a href="dm-base-r.html#cb145-3"></a><span class="co">#&gt;   Plant   Type  Treatment conc uptake</span></span>
<span id="cb145-4"><a href="dm-base-r.html#cb145-4"></a><span class="co">#&gt; 1   Qn1 Quebec nonchilled   95   16.0</span></span>
<span id="cb145-5"><a href="dm-base-r.html#cb145-5"></a><span class="co">#&gt; 2   Qn1 Quebec nonchilled  175   30.4</span></span>
<span id="cb145-6"><a href="dm-base-r.html#cb145-6"></a><span class="co">#&gt; 3   Qn1 Quebec nonchilled  250   34.8</span></span>
<span id="cb145-7"><a href="dm-base-r.html#cb145-7"></a><span class="co">#&gt; 4   Qn1 Quebec nonchilled  350   37.2</span></span>
<span id="cb145-8"><a href="dm-base-r.html#cb145-8"></a><span class="co">#&gt; 5   Qn1 Quebec nonchilled  500   35.3</span></span>
<span id="cb145-9"><a href="dm-base-r.html#cb145-9"></a><span class="co">#&gt; 6   Qn1 Quebec nonchilled  675   39.2</span></span>
<span id="cb145-10"><a href="dm-base-r.html#cb145-10"></a><span class="kw">str</span>(CO2)</span>
<span id="cb145-11"><a href="dm-base-r.html#cb145-11"></a><span class="co">#&gt; Classes &#39;nfnGroupedData&#39;, &#39;nfGroupedData&#39;, &#39;groupedData&#39; and &#39;data.frame&#39;:   84 obs. of  5 variables:</span></span>
<span id="cb145-12"><a href="dm-base-r.html#cb145-12"></a><span class="co">#&gt;  $ Plant    : Ord.factor w/ 12 levels &quot;Qn1&quot;&lt;&quot;Qn2&quot;&lt;&quot;Qn3&quot;&lt;..: 1 1 1 1 1 1 1..</span></span>
<span id="cb145-13"><a href="dm-base-r.html#cb145-13"></a><span class="co">#&gt;  $ Type     : Factor w/ 2 levels &quot;Quebec&quot;,&quot;Mississippi&quot;: 1 1 1 1 1 1 1 1 ..</span></span>
<span id="cb145-14"><a href="dm-base-r.html#cb145-14"></a><span class="co">#&gt;  $ Treatment: Factor w/ 2 levels &quot;nonchilled&quot;,&quot;chilled&quot;: 1 1 1 1 1 1 1 1 ..</span></span>
<span id="cb145-15"><a href="dm-base-r.html#cb145-15"></a><span class="co">#&gt;  $ conc     : num  95 175 250 350 500 675 1000 95 175 250 ...</span></span>
<span id="cb145-16"><a href="dm-base-r.html#cb145-16"></a><span class="co">#&gt;  $ uptake   : num  16 30.4 34.8 37.2 35.3 39.2 39.7 13.6 27.3 37.1 ...</span></span>
<span id="cb145-17"><a href="dm-base-r.html#cb145-17"></a><span class="co">#&gt;  - attr(*, &quot;formula&quot;)=Class &#39;formula&#39;  language uptake ~ conc | Plant</span></span>
<span id="cb145-18"><a href="dm-base-r.html#cb145-18"></a><span class="co">#&gt;   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_EmptyEnv&gt; </span></span>
<span id="cb145-19"><a href="dm-base-r.html#cb145-19"></a><span class="co">#&gt;  - attr(*, &quot;outer&quot;)=Class &#39;formula&#39;  language ~Treatment * Type</span></span>
<span id="cb145-20"><a href="dm-base-r.html#cb145-20"></a><span class="co">#&gt;   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_EmptyEnv&gt; </span></span>
<span id="cb145-21"><a href="dm-base-r.html#cb145-21"></a><span class="co">#&gt;  - attr(*, &quot;labels&quot;)=List of 2</span></span>
<span id="cb145-22"><a href="dm-base-r.html#cb145-22"></a><span class="co">#&gt;   ..$ x: chr &quot;Ambient carbon dioxide concentration&quot;</span></span>
<span id="cb145-23"><a href="dm-base-r.html#cb145-23"></a><span class="co">#&gt;   ..$ y: chr &quot;CO2 uptake rate&quot;</span></span>
<span id="cb145-24"><a href="dm-base-r.html#cb145-24"></a><span class="co">#&gt;  - attr(*, &quot;units&quot;)=List of 2</span></span>
<span id="cb145-25"><a href="dm-base-r.html#cb145-25"></a><span class="co">#&gt;   ..$ x: chr &quot;(uL/L)&quot;</span></span>
<span id="cb145-26"><a href="dm-base-r.html#cb145-26"></a><span class="co">#&gt;   ..$ y: chr &quot;(umol/m^2 s)&quot;</span></span></code></pre></div>
<p>对单个变量分组统计</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="dm-base-r.html#cb146-1"></a><span class="kw">aggregate</span>(uptake <span class="op">~</span><span class="st"> </span>Plant, <span class="dt">data =</span> CO2, mean)</span>
<span id="cb146-2"><a href="dm-base-r.html#cb146-2"></a><span class="co">#&gt;    Plant   uptake</span></span>
<span id="cb146-3"><a href="dm-base-r.html#cb146-3"></a><span class="co">#&gt; 1    Qn1 33.22857</span></span>
<span id="cb146-4"><a href="dm-base-r.html#cb146-4"></a><span class="co">#&gt; 2    Qn2 35.15714</span></span>
<span id="cb146-5"><a href="dm-base-r.html#cb146-5"></a><span class="co">#&gt; 3    Qn3 37.61429</span></span>
<span id="cb146-6"><a href="dm-base-r.html#cb146-6"></a><span class="co">#&gt; 4    Qc1 29.97143</span></span>
<span id="cb146-7"><a href="dm-base-r.html#cb146-7"></a><span class="co">#&gt; 5    Qc3 32.58571</span></span>
<span id="cb146-8"><a href="dm-base-r.html#cb146-8"></a><span class="co">#&gt; 6    Qc2 32.70000</span></span>
<span id="cb146-9"><a href="dm-base-r.html#cb146-9"></a><span class="co">#&gt; 7    Mn3 24.11429</span></span>
<span id="cb146-10"><a href="dm-base-r.html#cb146-10"></a><span class="co">#&gt; 8    Mn2 27.34286</span></span>
<span id="cb146-11"><a href="dm-base-r.html#cb146-11"></a><span class="co">#&gt; 9    Mn1 26.40000</span></span>
<span id="cb146-12"><a href="dm-base-r.html#cb146-12"></a><span class="co">#&gt; 10   Mc2 12.14286</span></span>
<span id="cb146-13"><a href="dm-base-r.html#cb146-13"></a><span class="co">#&gt; 11   Mc3 17.30000</span></span>
<span id="cb146-14"><a href="dm-base-r.html#cb146-14"></a><span class="co">#&gt; 12   Mc1 18.00000</span></span>
<span id="cb146-15"><a href="dm-base-r.html#cb146-15"></a><span class="kw">aggregate</span>(uptake <span class="op">~</span><span class="st"> </span>Type, <span class="dt">data =</span> CO2, mean)</span>
<span id="cb146-16"><a href="dm-base-r.html#cb146-16"></a><span class="co">#&gt;          Type   uptake</span></span>
<span id="cb146-17"><a href="dm-base-r.html#cb146-17"></a><span class="co">#&gt; 1      Quebec 33.54286</span></span>
<span id="cb146-18"><a href="dm-base-r.html#cb146-18"></a><span class="co">#&gt; 2 Mississippi 20.88333</span></span>
<span id="cb146-19"><a href="dm-base-r.html#cb146-19"></a><span class="kw">aggregate</span>(uptake <span class="op">~</span><span class="st"> </span>Treatment, <span class="dt">data =</span> CO2, mean)</span>
<span id="cb146-20"><a href="dm-base-r.html#cb146-20"></a><span class="co">#&gt;    Treatment   uptake</span></span>
<span id="cb146-21"><a href="dm-base-r.html#cb146-21"></a><span class="co">#&gt; 1 nonchilled 30.64286</span></span>
<span id="cb146-22"><a href="dm-base-r.html#cb146-22"></a><span class="co">#&gt; 2    chilled 23.78333</span></span></code></pre></div>
<p>对多个变量分组统计，查看二氧化碳吸收速率uptake随类型Type和处理方式Treatment</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="dm-base-r.html#cb147-1"></a><span class="kw">aggregate</span>(uptake <span class="op">~</span><span class="st"> </span>Type <span class="op">+</span><span class="st"> </span>Treatment, <span class="dt">data =</span> CO2, mean)</span>
<span id="cb147-2"><a href="dm-base-r.html#cb147-2"></a><span class="co">#&gt;          Type  Treatment   uptake</span></span>
<span id="cb147-3"><a href="dm-base-r.html#cb147-3"></a><span class="co">#&gt; 1      Quebec nonchilled 35.33333</span></span>
<span id="cb147-4"><a href="dm-base-r.html#cb147-4"></a><span class="co">#&gt; 2 Mississippi nonchilled 25.95238</span></span>
<span id="cb147-5"><a href="dm-base-r.html#cb147-5"></a><span class="co">#&gt; 3      Quebec    chilled 31.75238</span></span>
<span id="cb147-6"><a href="dm-base-r.html#cb147-6"></a><span class="co">#&gt; 4 Mississippi    chilled 15.81429</span></span>
<span id="cb147-7"><a href="dm-base-r.html#cb147-7"></a><span class="kw">tapply</span>(CO2<span class="op">$</span>uptake, <span class="kw">list</span>(CO2<span class="op">$</span>Type, CO2<span class="op">$</span>Treatment), mean)</span>
<span id="cb147-8"><a href="dm-base-r.html#cb147-8"></a><span class="co">#&gt;             nonchilled  chilled</span></span>
<span id="cb147-9"><a href="dm-base-r.html#cb147-9"></a><span class="co">#&gt; Quebec        35.33333 31.75238</span></span>
<span id="cb147-10"><a href="dm-base-r.html#cb147-10"></a><span class="co">#&gt; Mississippi   25.95238 15.81429</span></span>
<span id="cb147-11"><a href="dm-base-r.html#cb147-11"></a><span class="kw">by</span>(CO2<span class="op">$</span>uptake, <span class="kw">list</span>(CO2<span class="op">$</span>Type, CO2<span class="op">$</span>Treatment), mean)</span>
<span id="cb147-12"><a href="dm-base-r.html#cb147-12"></a><span class="co">#&gt; : Quebec</span></span>
<span id="cb147-13"><a href="dm-base-r.html#cb147-13"></a><span class="co">#&gt; : nonchilled</span></span>
<span id="cb147-14"><a href="dm-base-r.html#cb147-14"></a><span class="co">#&gt; [1] 35.33333</span></span>
<span id="cb147-15"><a href="dm-base-r.html#cb147-15"></a><span class="co">#&gt; -------------------------------------------------------- </span></span>
<span id="cb147-16"><a href="dm-base-r.html#cb147-16"></a><span class="co">#&gt; : Mississippi</span></span>
<span id="cb147-17"><a href="dm-base-r.html#cb147-17"></a><span class="co">#&gt; : nonchilled</span></span>
<span id="cb147-18"><a href="dm-base-r.html#cb147-18"></a><span class="co">#&gt; [1] 25.95238</span></span>
<span id="cb147-19"><a href="dm-base-r.html#cb147-19"></a><span class="co">#&gt; -------------------------------------------------------- </span></span>
<span id="cb147-20"><a href="dm-base-r.html#cb147-20"></a><span class="co">#&gt; : Quebec</span></span>
<span id="cb147-21"><a href="dm-base-r.html#cb147-21"></a><span class="co">#&gt; : chilled</span></span>
<span id="cb147-22"><a href="dm-base-r.html#cb147-22"></a><span class="co">#&gt; [1] 31.75238</span></span>
<span id="cb147-23"><a href="dm-base-r.html#cb147-23"></a><span class="co">#&gt; -------------------------------------------------------- </span></span>
<span id="cb147-24"><a href="dm-base-r.html#cb147-24"></a><span class="co">#&gt; : Mississippi</span></span>
<span id="cb147-25"><a href="dm-base-r.html#cb147-25"></a><span class="co">#&gt; : chilled</span></span>
<span id="cb147-26"><a href="dm-base-r.html#cb147-26"></a><span class="co">#&gt; [1] 15.81429</span></span></code></pre></div>
<p>在这个例子中 tapply 和 by 的输出结果的表示形式不一样，aggregate 返回一个 data.frame 数据框，tapply 返回一个表格 table，by 返回特殊的数据类型 by。</p>
<p>Function <code>by</code> is an object-oriented wrapper for <code>tapply</code> applied to data frames.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="dm-base-r.html#cb148-1"></a><span class="co"># 分组求和</span></span>
<span id="cb148-2"><a href="dm-base-r.html#cb148-2"></a><span class="co"># by(iris[, 1], INDICES = list(iris$Species), FUN = sum)</span></span>
<span id="cb148-3"><a href="dm-base-r.html#cb148-3"></a><span class="co"># by(iris[, 2], INDICES = list(iris$Species), FUN = sum)</span></span>
<span id="cb148-4"><a href="dm-base-r.html#cb148-4"></a><span class="kw">by</span>(iris[, <span class="dv">3</span>], <span class="dt">INDICES =</span> <span class="kw">list</span>(iris<span class="op">$</span>Species), <span class="dt">FUN =</span> sum)</span>
<span id="cb148-5"><a href="dm-base-r.html#cb148-5"></a><span class="co">#&gt; : setosa</span></span>
<span id="cb148-6"><a href="dm-base-r.html#cb148-6"></a><span class="co">#&gt; [1] 73.1</span></span>
<span id="cb148-7"><a href="dm-base-r.html#cb148-7"></a><span class="co">#&gt; -------------------------------------------------------- </span></span>
<span id="cb148-8"><a href="dm-base-r.html#cb148-8"></a><span class="co">#&gt; : versicolor</span></span>
<span id="cb148-9"><a href="dm-base-r.html#cb148-9"></a><span class="co">#&gt; [1] 213</span></span>
<span id="cb148-10"><a href="dm-base-r.html#cb148-10"></a><span class="co">#&gt; -------------------------------------------------------- </span></span>
<span id="cb148-11"><a href="dm-base-r.html#cb148-11"></a><span class="co">#&gt; : virginica</span></span>
<span id="cb148-12"><a href="dm-base-r.html#cb148-12"></a><span class="co">#&gt; [1] 277.6</span></span>
<span id="cb148-13"><a href="dm-base-r.html#cb148-13"></a><span class="kw">by</span>(iris[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">INDICES =</span> <span class="kw">list</span>(iris<span class="op">$</span>Species), <span class="dt">FUN =</span> sum)</span>
<span id="cb148-14"><a href="dm-base-r.html#cb148-14"></a><span class="co">#&gt; : setosa</span></span>
<span id="cb148-15"><a href="dm-base-r.html#cb148-15"></a><span class="co">#&gt; [1] 494.8</span></span>
<span id="cb148-16"><a href="dm-base-r.html#cb148-16"></a><span class="co">#&gt; -------------------------------------------------------- </span></span>
<span id="cb148-17"><a href="dm-base-r.html#cb148-17"></a><span class="co">#&gt; : versicolor</span></span>
<span id="cb148-18"><a href="dm-base-r.html#cb148-18"></a><span class="co">#&gt; [1] 648.3</span></span>
<span id="cb148-19"><a href="dm-base-r.html#cb148-19"></a><span class="co">#&gt; -------------------------------------------------------- </span></span>
<span id="cb148-20"><a href="dm-base-r.html#cb148-20"></a><span class="co">#&gt; : virginica</span></span>
<span id="cb148-21"><a href="dm-base-r.html#cb148-21"></a><span class="co">#&gt; [1] 755.7</span></span>
<span id="cb148-22"><a href="dm-base-r.html#cb148-22"></a><span class="kw">by</span>(iris[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">INDICES =</span> <span class="kw">list</span>(iris<span class="op">$</span>Species), <span class="dt">FUN =</span> summary)</span>
<span id="cb148-23"><a href="dm-base-r.html#cb148-23"></a><span class="co">#&gt; : setosa</span></span>
<span id="cb148-24"><a href="dm-base-r.html#cb148-24"></a><span class="co">#&gt;   Sepal.Length    Sepal.Width     Petal.Length  </span></span>
<span id="cb148-25"><a href="dm-base-r.html#cb148-25"></a><span class="co">#&gt;  Min.   :4.300   Min.   :2.300   Min.   :1.000  </span></span>
<span id="cb148-26"><a href="dm-base-r.html#cb148-26"></a><span class="co">#&gt;  1st Qu.:4.800   1st Qu.:3.200   1st Qu.:1.400  </span></span>
<span id="cb148-27"><a href="dm-base-r.html#cb148-27"></a><span class="co">#&gt;  Median :5.000   Median :3.400   Median :1.500  </span></span>
<span id="cb148-28"><a href="dm-base-r.html#cb148-28"></a><span class="co">#&gt;  Mean   :5.006   Mean   :3.428   Mean   :1.462  </span></span>
<span id="cb148-29"><a href="dm-base-r.html#cb148-29"></a><span class="co">#&gt;  3rd Qu.:5.200   3rd Qu.:3.675   3rd Qu.:1.575  </span></span>
<span id="cb148-30"><a href="dm-base-r.html#cb148-30"></a><span class="co">#&gt;  Max.   :5.800   Max.   :4.400   Max.   :1.900  </span></span>
<span id="cb148-31"><a href="dm-base-r.html#cb148-31"></a><span class="co">#&gt; -------------------------------------------------------- </span></span>
<span id="cb148-32"><a href="dm-base-r.html#cb148-32"></a><span class="co">#&gt; : versicolor</span></span>
<span id="cb148-33"><a href="dm-base-r.html#cb148-33"></a><span class="co">#&gt;   Sepal.Length    Sepal.Width     Petal.Length </span></span>
<span id="cb148-34"><a href="dm-base-r.html#cb148-34"></a><span class="co">#&gt;  Min.   :4.900   Min.   :2.000   Min.   :3.00  </span></span>
<span id="cb148-35"><a href="dm-base-r.html#cb148-35"></a><span class="co">#&gt;  1st Qu.:5.600   1st Qu.:2.525   1st Qu.:4.00  </span></span>
<span id="cb148-36"><a href="dm-base-r.html#cb148-36"></a><span class="co">#&gt;  Median :5.900   Median :2.800   Median :4.35  </span></span>
<span id="cb148-37"><a href="dm-base-r.html#cb148-37"></a><span class="co">#&gt;  Mean   :5.936   Mean   :2.770   Mean   :4.26  </span></span>
<span id="cb148-38"><a href="dm-base-r.html#cb148-38"></a><span class="co">#&gt;  3rd Qu.:6.300   3rd Qu.:3.000   3rd Qu.:4.60  </span></span>
<span id="cb148-39"><a href="dm-base-r.html#cb148-39"></a><span class="co">#&gt;  Max.   :7.000   Max.   :3.400   Max.   :5.10  </span></span>
<span id="cb148-40"><a href="dm-base-r.html#cb148-40"></a><span class="co">#&gt; -------------------------------------------------------- </span></span>
<span id="cb148-41"><a href="dm-base-r.html#cb148-41"></a><span class="co">#&gt; : virginica</span></span>
<span id="cb148-42"><a href="dm-base-r.html#cb148-42"></a><span class="co">#&gt;   Sepal.Length    Sepal.Width     Petal.Length  </span></span>
<span id="cb148-43"><a href="dm-base-r.html#cb148-43"></a><span class="co">#&gt;  Min.   :4.900   Min.   :2.200   Min.   :4.500  </span></span>
<span id="cb148-44"><a href="dm-base-r.html#cb148-44"></a><span class="co">#&gt;  1st Qu.:6.225   1st Qu.:2.800   1st Qu.:5.100  </span></span>
<span id="cb148-45"><a href="dm-base-r.html#cb148-45"></a><span class="co">#&gt;  Median :6.500   Median :3.000   Median :5.550  </span></span>
<span id="cb148-46"><a href="dm-base-r.html#cb148-46"></a><span class="co">#&gt;  Mean   :6.588   Mean   :2.974   Mean   :5.552  </span></span>
<span id="cb148-47"><a href="dm-base-r.html#cb148-47"></a><span class="co">#&gt;  3rd Qu.:6.900   3rd Qu.:3.175   3rd Qu.:5.875  </span></span>
<span id="cb148-48"><a href="dm-base-r.html#cb148-48"></a><span class="co">#&gt;  Max.   :7.900   Max.   :3.800   Max.   :6.900</span></span>
<span id="cb148-49"><a href="dm-base-r.html#cb148-49"></a><span class="kw">by</span>(iris, <span class="dt">INDICES =</span> <span class="kw">list</span>(iris<span class="op">$</span>Species), <span class="dt">FUN =</span> summary)</span>
<span id="cb148-50"><a href="dm-base-r.html#cb148-50"></a><span class="co">#&gt; : setosa</span></span>
<span id="cb148-51"><a href="dm-base-r.html#cb148-51"></a><span class="co">#&gt;   Sepal.Length    Sepal.Width     Petal.Length    Petal.Width   </span></span>
<span id="cb148-52"><a href="dm-base-r.html#cb148-52"></a><span class="co">#&gt;  Min.   :4.300   Min.   :2.300   Min.   :1.000   Min.   :0.100  </span></span>
<span id="cb148-53"><a href="dm-base-r.html#cb148-53"></a><span class="co">#&gt;  1st Qu.:4.800   1st Qu.:3.200   1st Qu.:1.400   1st Qu.:0.200  </span></span>
<span id="cb148-54"><a href="dm-base-r.html#cb148-54"></a><span class="co">#&gt;  Median :5.000   Median :3.400   Median :1.500   Median :0.200  </span></span>
<span id="cb148-55"><a href="dm-base-r.html#cb148-55"></a><span class="co">#&gt;  Mean   :5.006   Mean   :3.428   Mean   :1.462   Mean   :0.246  </span></span>
<span id="cb148-56"><a href="dm-base-r.html#cb148-56"></a><span class="co">#&gt;  3rd Qu.:5.200   3rd Qu.:3.675   3rd Qu.:1.575   3rd Qu.:0.300  </span></span>
<span id="cb148-57"><a href="dm-base-r.html#cb148-57"></a><span class="co">#&gt;  Max.   :5.800   Max.   :4.400   Max.   :1.900   Max.   :0.600  </span></span>
<span id="cb148-58"><a href="dm-base-r.html#cb148-58"></a><span class="co">#&gt;        Species  </span></span>
<span id="cb148-59"><a href="dm-base-r.html#cb148-59"></a><span class="co">#&gt;  setosa    :50  </span></span>
<span id="cb148-60"><a href="dm-base-r.html#cb148-60"></a><span class="co">#&gt;  versicolor: 0  </span></span>
<span id="cb148-61"><a href="dm-base-r.html#cb148-61"></a><span class="co">#&gt;  virginica : 0  </span></span>
<span id="cb148-62"><a href="dm-base-r.html#cb148-62"></a><span class="co">#&gt;                 </span></span>
<span id="cb148-63"><a href="dm-base-r.html#cb148-63"></a><span class="co">#&gt;                 </span></span>
<span id="cb148-64"><a href="dm-base-r.html#cb148-64"></a><span class="co">#&gt;                 </span></span>
<span id="cb148-65"><a href="dm-base-r.html#cb148-65"></a><span class="co">#&gt; -------------------------------------------------------- </span></span>
<span id="cb148-66"><a href="dm-base-r.html#cb148-66"></a><span class="co">#&gt; : versicolor</span></span>
<span id="cb148-67"><a href="dm-base-r.html#cb148-67"></a><span class="co">#&gt;   Sepal.Length    Sepal.Width     Petal.Length   Petal.Width   </span></span>
<span id="cb148-68"><a href="dm-base-r.html#cb148-68"></a><span class="co">#&gt;  Min.   :4.900   Min.   :2.000   Min.   :3.00   Min.   :1.000  </span></span>
<span id="cb148-69"><a href="dm-base-r.html#cb148-69"></a><span class="co">#&gt;  1st Qu.:5.600   1st Qu.:2.525   1st Qu.:4.00   1st Qu.:1.200  </span></span>
<span id="cb148-70"><a href="dm-base-r.html#cb148-70"></a><span class="co">#&gt;  Median :5.900   Median :2.800   Median :4.35   Median :1.300  </span></span>
<span id="cb148-71"><a href="dm-base-r.html#cb148-71"></a><span class="co">#&gt;  Mean   :5.936   Mean   :2.770   Mean   :4.26   Mean   :1.326  </span></span>
<span id="cb148-72"><a href="dm-base-r.html#cb148-72"></a><span class="co">#&gt;  3rd Qu.:6.300   3rd Qu.:3.000   3rd Qu.:4.60   3rd Qu.:1.500  </span></span>
<span id="cb148-73"><a href="dm-base-r.html#cb148-73"></a><span class="co">#&gt;  Max.   :7.000   Max.   :3.400   Max.   :5.10   Max.   :1.800  </span></span>
<span id="cb148-74"><a href="dm-base-r.html#cb148-74"></a><span class="co">#&gt;        Species  </span></span>
<span id="cb148-75"><a href="dm-base-r.html#cb148-75"></a><span class="co">#&gt;  setosa    : 0  </span></span>
<span id="cb148-76"><a href="dm-base-r.html#cb148-76"></a><span class="co">#&gt;  versicolor:50  </span></span>
<span id="cb148-77"><a href="dm-base-r.html#cb148-77"></a><span class="co">#&gt;  virginica : 0  </span></span>
<span id="cb148-78"><a href="dm-base-r.html#cb148-78"></a><span class="co">#&gt;                 </span></span>
<span id="cb148-79"><a href="dm-base-r.html#cb148-79"></a><span class="co">#&gt;                 </span></span>
<span id="cb148-80"><a href="dm-base-r.html#cb148-80"></a><span class="co">#&gt;                 </span></span>
<span id="cb148-81"><a href="dm-base-r.html#cb148-81"></a><span class="co">#&gt; -------------------------------------------------------- </span></span>
<span id="cb148-82"><a href="dm-base-r.html#cb148-82"></a><span class="co">#&gt; : virginica</span></span>
<span id="cb148-83"><a href="dm-base-r.html#cb148-83"></a><span class="co">#&gt;   Sepal.Length    Sepal.Width     Petal.Length    Petal.Width   </span></span>
<span id="cb148-84"><a href="dm-base-r.html#cb148-84"></a><span class="co">#&gt;  Min.   :4.900   Min.   :2.200   Min.   :4.500   Min.   :1.400  </span></span>
<span id="cb148-85"><a href="dm-base-r.html#cb148-85"></a><span class="co">#&gt;  1st Qu.:6.225   1st Qu.:2.800   1st Qu.:5.100   1st Qu.:1.800  </span></span>
<span id="cb148-86"><a href="dm-base-r.html#cb148-86"></a><span class="co">#&gt;  Median :6.500   Median :3.000   Median :5.550   Median :2.000  </span></span>
<span id="cb148-87"><a href="dm-base-r.html#cb148-87"></a><span class="co">#&gt;  Mean   :6.588   Mean   :2.974   Mean   :5.552   Mean   :2.026  </span></span>
<span id="cb148-88"><a href="dm-base-r.html#cb148-88"></a><span class="co">#&gt;  3rd Qu.:6.900   3rd Qu.:3.175   3rd Qu.:5.875   3rd Qu.:2.300  </span></span>
<span id="cb148-89"><a href="dm-base-r.html#cb148-89"></a><span class="co">#&gt;  Max.   :7.900   Max.   :3.800   Max.   :6.900   Max.   :2.500  </span></span>
<span id="cb148-90"><a href="dm-base-r.html#cb148-90"></a><span class="co">#&gt;        Species  </span></span>
<span id="cb148-91"><a href="dm-base-r.html#cb148-91"></a><span class="co">#&gt;  setosa    : 0  </span></span>
<span id="cb148-92"><a href="dm-base-r.html#cb148-92"></a><span class="co">#&gt;  versicolor: 0  </span></span>
<span id="cb148-93"><a href="dm-base-r.html#cb148-93"></a><span class="co">#&gt;  virginica :50  </span></span>
<span id="cb148-94"><a href="dm-base-r.html#cb148-94"></a><span class="co">#&gt;                 </span></span>
<span id="cb148-95"><a href="dm-base-r.html#cb148-95"></a><span class="co">#&gt;                 </span></span>
<span id="cb148-96"><a href="dm-base-r.html#cb148-96"></a><span class="co">#&gt; </span></span></code></pre></div>
<p>Group Averages Over Level Combinations of Factors 分组平均</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="dm-base-r.html#cb149-1"></a><span class="kw">str</span>(warpbreaks)</span>
<span id="cb149-2"><a href="dm-base-r.html#cb149-2"></a><span class="co">#&gt; &#39;data.frame&#39;:    54 obs. of  3 variables:</span></span>
<span id="cb149-3"><a href="dm-base-r.html#cb149-3"></a><span class="co">#&gt;  $ breaks : num  26 30 54 25 70 52 51 26 67 18 ...</span></span>
<span id="cb149-4"><a href="dm-base-r.html#cb149-4"></a><span class="co">#&gt;  $ wool   : Factor w/ 2 levels &quot;A&quot;,&quot;B&quot;: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb149-5"><a href="dm-base-r.html#cb149-5"></a><span class="co">#&gt;  $ tension: Factor w/ 3 levels &quot;L&quot;,&quot;M&quot;,&quot;H&quot;: 1 1 1 1 1 1 1 1 1 2 ...</span></span>
<span id="cb149-6"><a href="dm-base-r.html#cb149-6"></a><span class="kw">head</span>(warpbreaks)</span>
<span id="cb149-7"><a href="dm-base-r.html#cb149-7"></a><span class="co">#&gt;   breaks wool tension</span></span>
<span id="cb149-8"><a href="dm-base-r.html#cb149-8"></a><span class="co">#&gt; 1     26    A       L</span></span>
<span id="cb149-9"><a href="dm-base-r.html#cb149-9"></a><span class="co">#&gt; 2     30    A       L</span></span>
<span id="cb149-10"><a href="dm-base-r.html#cb149-10"></a><span class="co">#&gt; 3     54    A       L</span></span>
<span id="cb149-11"><a href="dm-base-r.html#cb149-11"></a><span class="co">#&gt; 4     25    A       L</span></span>
<span id="cb149-12"><a href="dm-base-r.html#cb149-12"></a><span class="co">#&gt; 5     70    A       L</span></span>
<span id="cb149-13"><a href="dm-base-r.html#cb149-13"></a><span class="co">#&gt; 6     52    A       L</span></span>
<span id="cb149-14"><a href="dm-base-r.html#cb149-14"></a></span>
<span id="cb149-15"><a href="dm-base-r.html#cb149-15"></a><span class="kw">ave</span>(warpbreaks<span class="op">$</span>breaks, warpbreaks<span class="op">$</span>wool)</span>
<span id="cb149-16"><a href="dm-base-r.html#cb149-16"></a><span class="co">#&gt;  [1] 31.03704 31.03704 31.03704 31.03704 31.03704 31.03704 31.03704</span></span>
<span id="cb149-17"><a href="dm-base-r.html#cb149-17"></a><span class="co">#&gt;  [8] 31.03704 31.03704 31.03704 31.03704 31.03704 31.03704 31.03704</span></span>
<span id="cb149-18"><a href="dm-base-r.html#cb149-18"></a><span class="co">#&gt; [15] 31.03704 31.03704 31.03704 31.03704 31.03704 31.03704 31.03704</span></span>
<span id="cb149-19"><a href="dm-base-r.html#cb149-19"></a><span class="co">#&gt; [22] 31.03704 31.03704 31.03704 31.03704 31.03704 31.03704 25.25926</span></span>
<span id="cb149-20"><a href="dm-base-r.html#cb149-20"></a><span class="co">#&gt; [29] 25.25926 25.25926 25.25926 25.25926 25.25926 25.25926 25.25926</span></span>
<span id="cb149-21"><a href="dm-base-r.html#cb149-21"></a><span class="co">#&gt; [36] 25.25926 25.25926 25.25926 25.25926 25.25926 25.25926 25.25926</span></span>
<span id="cb149-22"><a href="dm-base-r.html#cb149-22"></a><span class="co">#&gt; [43] 25.25926 25.25926 25.25926 25.25926 25.25926 25.25926 25.25926</span></span>
<span id="cb149-23"><a href="dm-base-r.html#cb149-23"></a><span class="co">#&gt; [50] 25.25926 25.25926 25.25926 25.25926 25.25926</span></span>
<span id="cb149-24"><a href="dm-base-r.html#cb149-24"></a><span class="kw">with</span>(warpbreaks, <span class="kw">ave</span>(breaks, tension, <span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="kw">mean</span>(x, <span class="dt">trim =</span> <span class="fl">0.1</span>)))</span>
<span id="cb149-25"><a href="dm-base-r.html#cb149-25"></a><span class="co">#&gt;  [1] 35.6875 35.6875 35.6875 35.6875 35.6875 35.6875 35.6875 35.6875</span></span>
<span id="cb149-26"><a href="dm-base-r.html#cb149-26"></a><span class="co">#&gt;  [9] 35.6875 26.3125 26.3125 26.3125 26.3125 26.3125 26.3125 26.3125</span></span>
<span id="cb149-27"><a href="dm-base-r.html#cb149-27"></a><span class="co">#&gt; [17] 26.3125 26.3125 21.0625 21.0625 21.0625 21.0625 21.0625 21.0625</span></span>
<span id="cb149-28"><a href="dm-base-r.html#cb149-28"></a><span class="co">#&gt; [25] 21.0625 21.0625 21.0625 35.6875 35.6875 35.6875 35.6875 35.6875</span></span>
<span id="cb149-29"><a href="dm-base-r.html#cb149-29"></a><span class="co">#&gt; [33] 35.6875 35.6875 35.6875 35.6875 26.3125 26.3125 26.3125 26.3125</span></span>
<span id="cb149-30"><a href="dm-base-r.html#cb149-30"></a><span class="co">#&gt; [41] 26.3125 26.3125 26.3125 26.3125 26.3125 21.0625 21.0625 21.0625</span></span>
<span id="cb149-31"><a href="dm-base-r.html#cb149-31"></a><span class="co">#&gt; [49] 21.0625 21.0625 21.0625 21.0625 21.0625 21.0625</span></span>
<span id="cb149-32"><a href="dm-base-r.html#cb149-32"></a><span class="co"># 分组求和</span></span>
<span id="cb149-33"><a href="dm-base-r.html#cb149-33"></a><span class="kw">with</span>(warpbreaks, <span class="kw">ave</span>(breaks, tension, <span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="kw">sum</span>(x)))</span>
<span id="cb149-34"><a href="dm-base-r.html#cb149-34"></a><span class="co">#&gt;  [1] 655 655 655 655 655 655 655 655 655 475 475 475 475 475 475 475 475</span></span>
<span id="cb149-35"><a href="dm-base-r.html#cb149-35"></a><span class="co">#&gt; [18] 475 390 390 390 390 390 390 390 390 390 655 655 655 655 655 655 655</span></span>
<span id="cb149-36"><a href="dm-base-r.html#cb149-36"></a><span class="co">#&gt; [35] 655 655 475 475 475 475 475 475 475 475 475 390 390 390 390 390 390</span></span>
<span id="cb149-37"><a href="dm-base-r.html#cb149-37"></a><span class="co">#&gt; [52] 390 390 390</span></span>
<span id="cb149-38"><a href="dm-base-r.html#cb149-38"></a><span class="co"># 分组求和</span></span>
<span id="cb149-39"><a href="dm-base-r.html#cb149-39"></a><span class="kw">with</span>(iris, <span class="kw">ave</span>(Sepal.Length, Species, <span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="kw">sum</span>(x)))</span>
<span id="cb149-40"><a href="dm-base-r.html#cb149-40"></a><span class="co">#&gt;   [1] 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3</span></span>
<span id="cb149-41"><a href="dm-base-r.html#cb149-41"></a><span class="co">#&gt;  [12] 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3</span></span>
<span id="cb149-42"><a href="dm-base-r.html#cb149-42"></a><span class="co">#&gt;  [23] 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3</span></span>
<span id="cb149-43"><a href="dm-base-r.html#cb149-43"></a><span class="co">#&gt;  [34] 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3 250.3</span></span>
<span id="cb149-44"><a href="dm-base-r.html#cb149-44"></a><span class="co">#&gt;  [45] 250.3 250.3 250.3 250.3 250.3 250.3 296.8 296.8 296.8 296.8 296.8</span></span>
<span id="cb149-45"><a href="dm-base-r.html#cb149-45"></a><span class="co">#&gt;  [56] 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8</span></span>
<span id="cb149-46"><a href="dm-base-r.html#cb149-46"></a><span class="co">#&gt;  [67] 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8</span></span>
<span id="cb149-47"><a href="dm-base-r.html#cb149-47"></a><span class="co">#&gt;  [78] 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8</span></span>
<span id="cb149-48"><a href="dm-base-r.html#cb149-48"></a><span class="co">#&gt;  [89] 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8 296.8</span></span>
<span id="cb149-49"><a href="dm-base-r.html#cb149-49"></a><span class="co">#&gt; [100] 296.8 329.4 329.4 329.4 329.4 329.4 329.4 329.4 329.4 329.4 329.4</span></span>
<span id="cb149-50"><a href="dm-base-r.html#cb149-50"></a><span class="co">#&gt; [111] 329.4 329.4 329.4 329.4 329.4 329.4 329.4 329.4 329.4 329.4 329.4</span></span>
<span id="cb149-51"><a href="dm-base-r.html#cb149-51"></a><span class="co">#&gt; [122] 329.4 329.4 329.4 329.4 329.4 329.4 329.4 329.4 329.4 329.4 329.4</span></span>
<span id="cb149-52"><a href="dm-base-r.html#cb149-52"></a><span class="co">#&gt; [133] 329.4 329.4 329.4 329.4 329.4 329.4 329.4 329.4 329.4 329.4 329.4</span></span>
<span id="cb149-53"><a href="dm-base-r.html#cb149-53"></a><span class="co">#&gt; [144] 329.4 329.4 329.4 329.4 329.4 329.4 329.4</span></span></code></pre></div>
</div>
<div id="base-table" class="section level2">
<h2><span class="header-section-number">3.10</span> 表格统计</h2>
<blockquote>
<p>介绍操作表格的 table, addmargins, prop.table, xtabs, margin.table, ftabe 等函数</p>
</blockquote>
<p>table 多个分类变量分组计数统计</p>
<ul>
<li>介绍 warpbreaks 和 airquality 纽约空气质量监测数据集 二维的数据框</li>
<li>UCBAdmissions 1973 年加州大学伯克利分校的院系录取数据集 3维的列联表</li>
<li>Titanic 4维的列联表数据 泰坦尼克号幸存者数据集</li>
</ul>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="dm-base-r.html#cb150-1"></a><span class="kw">with</span>(warpbreaks, <span class="kw">table</span>(wool, tension))</span>
<span id="cb150-2"><a href="dm-base-r.html#cb150-2"></a><span class="co">#&gt;     tension</span></span>
<span id="cb150-3"><a href="dm-base-r.html#cb150-3"></a><span class="co">#&gt; wool L M H</span></span>
<span id="cb150-4"><a href="dm-base-r.html#cb150-4"></a><span class="co">#&gt;    A 9 9 9</span></span>
<span id="cb150-5"><a href="dm-base-r.html#cb150-5"></a><span class="co">#&gt;    B 9 9 9</span></span></code></pre></div>
<p>以 iris 数据集为例，table 的第一个参数是自己制造的第二个分类变量，原始分类变量是 Species</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="dm-base-r.html#cb151-1"></a><span class="kw">with</span>(iris, <span class="kw">table</span>(<span class="dt">Sepal.check =</span> Sepal.Length <span class="op">&gt;</span><span class="st"> </span><span class="dv">7</span>, Species))</span>
<span id="cb151-2"><a href="dm-base-r.html#cb151-2"></a><span class="co">#&gt;            Species</span></span>
<span id="cb151-3"><a href="dm-base-r.html#cb151-3"></a><span class="co">#&gt; Sepal.check setosa versicolor virginica</span></span>
<span id="cb151-4"><a href="dm-base-r.html#cb151-4"></a><span class="co">#&gt;       FALSE     50         50        38</span></span>
<span id="cb151-5"><a href="dm-base-r.html#cb151-5"></a><span class="co">#&gt;       TRUE       0          0        12</span></span>
<span id="cb151-6"><a href="dm-base-r.html#cb151-6"></a><span class="kw">with</span>(iris, <span class="kw">table</span>(<span class="dt">Sepal.check =</span> Sepal.Length <span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(Sepal.Length), Species))</span>
<span id="cb151-7"><a href="dm-base-r.html#cb151-7"></a><span class="co">#&gt;            Species</span></span>
<span id="cb151-8"><a href="dm-base-r.html#cb151-8"></a><span class="co">#&gt; Sepal.check setosa versicolor virginica</span></span>
<span id="cb151-9"><a href="dm-base-r.html#cb151-9"></a><span class="co">#&gt;       FALSE     50         24         6</span></span>
<span id="cb151-10"><a href="dm-base-r.html#cb151-10"></a><span class="co">#&gt;       TRUE       0         26        44</span></span></code></pre></div>
<p>以 airquality 数据集为例，看看月份中臭氧含量比较高的几天</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="dm-base-r.html#cb152-1"></a>aiq.tab &lt;-<span class="st"> </span><span class="kw">with</span>(airquality, <span class="kw">table</span>(<span class="dt">Oz.high =</span> Ozone <span class="op">&gt;</span><span class="st"> </span><span class="dv">80</span>, Month))</span>
<span id="cb152-2"><a href="dm-base-r.html#cb152-2"></a>aiq.tab</span>
<span id="cb152-3"><a href="dm-base-r.html#cb152-3"></a><span class="co">#&gt;        Month</span></span>
<span id="cb152-4"><a href="dm-base-r.html#cb152-4"></a><span class="co">#&gt; Oz.high  5  6  7  8  9</span></span>
<span id="cb152-5"><a href="dm-base-r.html#cb152-5"></a><span class="co">#&gt;   FALSE 25  9 20 19 27</span></span>
<span id="cb152-6"><a href="dm-base-r.html#cb152-6"></a><span class="co">#&gt;   TRUE   1  0  6  7  2</span></span></code></pre></div>
<p>对表格按行和列求和，即求表格的边际，查看总体情况</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="dm-base-r.html#cb153-1"></a><span class="kw">addmargins</span>(aiq.tab, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</span>
<span id="cb153-2"><a href="dm-base-r.html#cb153-2"></a><span class="co">#&gt;        Month</span></span>
<span id="cb153-3"><a href="dm-base-r.html#cb153-3"></a><span class="co">#&gt; Oz.high   5   6   7   8   9 Sum</span></span>
<span id="cb153-4"><a href="dm-base-r.html#cb153-4"></a><span class="co">#&gt;   FALSE  25   9  20  19  27 100</span></span>
<span id="cb153-5"><a href="dm-base-r.html#cb153-5"></a><span class="co">#&gt;   TRUE    1   0   6   7   2  16</span></span>
<span id="cb153-6"><a href="dm-base-r.html#cb153-6"></a><span class="co">#&gt;   Sum    26   9  26  26  29 116</span></span></code></pre></div>
<p>臭氧含量超 80 的天数在每个月的占比，<code>addmargins</code> 的第二个参数 1 表示对列求和</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="dm-base-r.html#cb154-1"></a>aiq.prop &lt;-<span class="st"> </span><span class="kw">prop.table</span>(aiq.tab, <span class="dv">2</span>)</span>
<span id="cb154-2"><a href="dm-base-r.html#cb154-2"></a>aiq.prop</span>
<span id="cb154-3"><a href="dm-base-r.html#cb154-3"></a><span class="co">#&gt;        Month</span></span>
<span id="cb154-4"><a href="dm-base-r.html#cb154-4"></a><span class="co">#&gt; Oz.high          5          6          7          8          9</span></span>
<span id="cb154-5"><a href="dm-base-r.html#cb154-5"></a><span class="co">#&gt;   FALSE 0.96153846 1.00000000 0.76923077 0.73076923 0.93103448</span></span>
<span id="cb154-6"><a href="dm-base-r.html#cb154-6"></a><span class="co">#&gt;   TRUE  0.03846154 0.00000000 0.23076923 0.26923077 0.06896552</span></span>
<span id="cb154-7"><a href="dm-base-r.html#cb154-7"></a>aiq.marprop &lt;-<span class="st"> </span><span class="kw">addmargins</span>(aiq.prop, <span class="dv">1</span>)</span>
<span id="cb154-8"><a href="dm-base-r.html#cb154-8"></a>aiq.marprop</span>
<span id="cb154-9"><a href="dm-base-r.html#cb154-9"></a><span class="co">#&gt;        Month</span></span>
<span id="cb154-10"><a href="dm-base-r.html#cb154-10"></a><span class="co">#&gt; Oz.high          5          6          7          8          9</span></span>
<span id="cb154-11"><a href="dm-base-r.html#cb154-11"></a><span class="co">#&gt;   FALSE 0.96153846 1.00000000 0.76923077 0.73076923 0.93103448</span></span>
<span id="cb154-12"><a href="dm-base-r.html#cb154-12"></a><span class="co">#&gt;   TRUE  0.03846154 0.00000000 0.23076923 0.26923077 0.06896552</span></span>
<span id="cb154-13"><a href="dm-base-r.html#cb154-13"></a><span class="co">#&gt;   Sum   1.00000000 1.00000000 1.00000000 1.00000000 1.00000000</span></span></code></pre></div>
<p>转换成百分比，将小数四舍五入转化为百分数，保留两位小数点</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="dm-base-r.html#cb155-1"></a><span class="kw">round</span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>aiq.marprop, <span class="dv">2</span>)</span>
<span id="cb155-2"><a href="dm-base-r.html#cb155-2"></a><span class="co">#&gt;        Month</span></span>
<span id="cb155-3"><a href="dm-base-r.html#cb155-3"></a><span class="co">#&gt; Oz.high      5      6      7      8      9</span></span>
<span id="cb155-4"><a href="dm-base-r.html#cb155-4"></a><span class="co">#&gt;   FALSE  96.15 100.00  76.92  73.08  93.10</span></span>
<span id="cb155-5"><a href="dm-base-r.html#cb155-5"></a><span class="co">#&gt;   TRUE    3.85   0.00  23.08  26.92   6.90</span></span>
<span id="cb155-6"><a href="dm-base-r.html#cb155-6"></a><span class="co">#&gt;   Sum   100.00 100.00 100.00 100.00 100.00</span></span></code></pre></div>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="dm-base-r.html#cb156-1"></a><span class="kw">pairs</span>(airquality, <span class="dt">panel =</span> panel.smooth, <span class="dt">main =</span> <span class="st">&quot;airquality data&quot;</span>)</span></code></pre></div>
<p>以 UCBAdmissions 数据集为例，使用 <code>xtabs</code> 函数把数据组织成列联表，先查看数据的内容</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="dm-base-r.html#cb157-1"></a>UCBAdmissions</span>
<span id="cb157-2"><a href="dm-base-r.html#cb157-2"></a><span class="co">#&gt; , , Dept = A</span></span>
<span id="cb157-3"><a href="dm-base-r.html#cb157-3"></a><span class="co">#&gt; </span></span>
<span id="cb157-4"><a href="dm-base-r.html#cb157-4"></a><span class="co">#&gt;           Gender</span></span>
<span id="cb157-5"><a href="dm-base-r.html#cb157-5"></a><span class="co">#&gt; Admit      Male Female</span></span>
<span id="cb157-6"><a href="dm-base-r.html#cb157-6"></a><span class="co">#&gt;   Admitted  512     89</span></span>
<span id="cb157-7"><a href="dm-base-r.html#cb157-7"></a><span class="co">#&gt;   Rejected  313     19</span></span>
<span id="cb157-8"><a href="dm-base-r.html#cb157-8"></a>....</span>
<span id="cb157-9"><a href="dm-base-r.html#cb157-9"></a>UCBA2DF &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(UCBAdmissions)</span>
<span id="cb157-10"><a href="dm-base-r.html#cb157-10"></a>UCBA2DF</span>
<span id="cb157-11"><a href="dm-base-r.html#cb157-11"></a><span class="co">#&gt;       Admit Gender Dept Freq</span></span>
<span id="cb157-12"><a href="dm-base-r.html#cb157-12"></a><span class="co">#&gt; 1  Admitted   Male    A  512</span></span>
<span id="cb157-13"><a href="dm-base-r.html#cb157-13"></a><span class="co">#&gt; 2  Rejected   Male    A  313</span></span>
<span id="cb157-14"><a href="dm-base-r.html#cb157-14"></a><span class="co">#&gt; 3  Admitted Female    A   89</span></span>
<span id="cb157-15"><a href="dm-base-r.html#cb157-15"></a><span class="co">#&gt; 4  Rejected Female    A   19</span></span>
<span id="cb157-16"><a href="dm-base-r.html#cb157-16"></a><span class="co">#&gt; 5  Admitted   Male    B  353</span></span>
<span id="cb157-17"><a href="dm-base-r.html#cb157-17"></a>....</span></code></pre></div>
<p>接着将 <code>UCBA2DF</code> 数据集转化为表格的形式</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="dm-base-r.html#cb158-1"></a>UCBA2DF.tab &lt;-<span class="st"> </span><span class="kw">xtabs</span>(Freq <span class="op">~</span><span class="st"> </span>Gender <span class="op">+</span><span class="st"> </span>Admit <span class="op">+</span><span class="st"> </span>Dept, <span class="dt">data =</span> UCBA2DF)</span>
<span id="cb158-2"><a href="dm-base-r.html#cb158-2"></a><span class="kw">ftable</span>(UCBA2DF.tab)</span>
<span id="cb158-3"><a href="dm-base-r.html#cb158-3"></a><span class="co">#&gt;                 Dept   A   B   C   D   E   F</span></span>
<span id="cb158-4"><a href="dm-base-r.html#cb158-4"></a><span class="co">#&gt; Gender Admit                                </span></span>
<span id="cb158-5"><a href="dm-base-r.html#cb158-5"></a><span class="co">#&gt; Male   Admitted      512 353 120 138  53  22</span></span>
<span id="cb158-6"><a href="dm-base-r.html#cb158-6"></a><span class="co">#&gt;        Rejected      313 207 205 279 138 351</span></span>
<span id="cb158-7"><a href="dm-base-r.html#cb158-7"></a><span class="co">#&gt; Female Admitted       89  17 202 131  94  24</span></span>
<span id="cb158-8"><a href="dm-base-r.html#cb158-8"></a><span class="co">#&gt;        Rejected       19   8 391 244 299 317</span></span></code></pre></div>
<p>将录取性别和院系进行对比</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="dm-base-r.html#cb159-1"></a><span class="kw">prop.table</span>(<span class="kw">margin.table</span>(UCBA2DF.tab, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)), <span class="dv">1</span>)</span>
<span id="cb159-2"><a href="dm-base-r.html#cb159-2"></a><span class="co">#&gt;         Dept</span></span>
<span id="cb159-3"><a href="dm-base-r.html#cb159-3"></a><span class="co">#&gt; Gender            A          B          C          D          E          F</span></span>
<span id="cb159-4"><a href="dm-base-r.html#cb159-4"></a><span class="co">#&gt;   Male   0.30657748 0.20810108 0.12077295 0.15496098 0.07097733 0.13861018</span></span>
<span id="cb159-5"><a href="dm-base-r.html#cb159-5"></a><span class="co">#&gt;   Female 0.05885559 0.01362398 0.32316076 0.20435967 0.21416894 0.18583106</span></span></code></pre></div>
<p>男生倾向于申请院系 A 和 B，女生倾向于申请院系 C 到 F，院系 A 和 B 是最容易录取的。</p>
</div>
<div id="base-index" class="section level2">
<h2><span class="header-section-number">3.11</span> 索引访问</h2>
<p>which 与引用 <code>[</code> 性能比较，在区间 <span class="math inline">\([0,1]\)</span> 上生成 10 万个服从均匀分布的随机数，随机抽取其中<span class="math inline">\(\frac{1}{4}\)</span>。</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="dm-base-r.html#cb160-1"></a>n &lt;-<span class="st"> </span><span class="dv">100000</span></span>
<span id="cb160-2"><a href="dm-base-r.html#cb160-2"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(n)</span>
<span id="cb160-3"><a href="dm-base-r.html#cb160-3"></a>i &lt;-<span class="st"> </span><span class="kw">logical</span>(n)</span>
<span id="cb160-4"><a href="dm-base-r.html#cb160-4"></a>i[<span class="kw">sample</span>(n, n <span class="op">/</span><span class="st"> </span><span class="dv">4</span>)] &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb160-5"><a href="dm-base-r.html#cb160-5"></a>microbenchmark<span class="op">::</span><span class="kw">microbenchmark</span>(x[i], x[<span class="kw">which</span>(i)], <span class="dt">times =</span> <span class="dv">1000</span>)</span></code></pre></div>
<p><span class="todo">使用 <code>subset</code> 函数与 <code>[</code> 比较</span></p>
</div>
<div id="base-array" class="section level2">
<h2><span class="header-section-number">3.12</span> 多维数组</h2>
<p>多维数组的行列是怎么定义的 <code>?array</code> 轴的概念，画个图表示数组</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="dm-base-r.html#cb161-1"></a><span class="kw">array</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">27</span>, <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb161-2"><a href="dm-base-r.html#cb161-2"></a><span class="co">#&gt; , , 1</span></span>
<span id="cb161-3"><a href="dm-base-r.html#cb161-3"></a><span class="co">#&gt; </span></span>
<span id="cb161-4"><a href="dm-base-r.html#cb161-4"></a><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span id="cb161-5"><a href="dm-base-r.html#cb161-5"></a><span class="co">#&gt; [1,]    1    4    7</span></span>
<span id="cb161-6"><a href="dm-base-r.html#cb161-6"></a><span class="co">#&gt; [2,]    2    5    8</span></span>
<span id="cb161-7"><a href="dm-base-r.html#cb161-7"></a><span class="co">#&gt; [3,]    3    6    9</span></span>
<span id="cb161-8"><a href="dm-base-r.html#cb161-8"></a><span class="co">#&gt; </span></span>
<span id="cb161-9"><a href="dm-base-r.html#cb161-9"></a><span class="co">#&gt; , , 2</span></span>
<span id="cb161-10"><a href="dm-base-r.html#cb161-10"></a><span class="co">#&gt; </span></span>
<span id="cb161-11"><a href="dm-base-r.html#cb161-11"></a><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span id="cb161-12"><a href="dm-base-r.html#cb161-12"></a><span class="co">#&gt; [1,]   10   13   16</span></span>
<span id="cb161-13"><a href="dm-base-r.html#cb161-13"></a><span class="co">#&gt; [2,]   11   14   17</span></span>
<span id="cb161-14"><a href="dm-base-r.html#cb161-14"></a><span class="co">#&gt; [3,]   12   15   18</span></span>
<span id="cb161-15"><a href="dm-base-r.html#cb161-15"></a><span class="co">#&gt; </span></span>
<span id="cb161-16"><a href="dm-base-r.html#cb161-16"></a><span class="co">#&gt; , , 3</span></span>
<span id="cb161-17"><a href="dm-base-r.html#cb161-17"></a><span class="co">#&gt; </span></span>
<span id="cb161-18"><a href="dm-base-r.html#cb161-18"></a><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span id="cb161-19"><a href="dm-base-r.html#cb161-19"></a><span class="co">#&gt; [1,]   19   22   25</span></span>
<span id="cb161-20"><a href="dm-base-r.html#cb161-20"></a><span class="co">#&gt; [2,]   20   23   26</span></span>
<span id="cb161-21"><a href="dm-base-r.html#cb161-21"></a><span class="co">#&gt; [3,]   21   24   27</span></span></code></pre></div>
<p>垂直于Z轴的平面去截三维立方体，3 代表 z 轴，得到三个截面（二维矩阵）</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="dm-base-r.html#cb162-1"></a><span class="kw">asplit</span>(<span class="kw">array</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">27</span>, <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>)), <span class="dv">3</span>)</span>
<span id="cb162-2"><a href="dm-base-r.html#cb162-2"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb162-3"><a href="dm-base-r.html#cb162-3"></a><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span id="cb162-4"><a href="dm-base-r.html#cb162-4"></a><span class="co">#&gt; [1,]    1    4    7</span></span>
<span id="cb162-5"><a href="dm-base-r.html#cb162-5"></a><span class="co">#&gt; [2,]    2    5    8</span></span>
<span id="cb162-6"><a href="dm-base-r.html#cb162-6"></a><span class="co">#&gt; [3,]    3    6    9</span></span>
<span id="cb162-7"><a href="dm-base-r.html#cb162-7"></a><span class="co">#&gt; </span></span>
<span id="cb162-8"><a href="dm-base-r.html#cb162-8"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb162-9"><a href="dm-base-r.html#cb162-9"></a><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span id="cb162-10"><a href="dm-base-r.html#cb162-10"></a><span class="co">#&gt; [1,]   10   13   16</span></span>
<span id="cb162-11"><a href="dm-base-r.html#cb162-11"></a><span class="co">#&gt; [2,]   11   14   17</span></span>
<span id="cb162-12"><a href="dm-base-r.html#cb162-12"></a><span class="co">#&gt; [3,]   12   15   18</span></span>
<span id="cb162-13"><a href="dm-base-r.html#cb162-13"></a><span class="co">#&gt; </span></span>
<span id="cb162-14"><a href="dm-base-r.html#cb162-14"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb162-15"><a href="dm-base-r.html#cb162-15"></a><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span id="cb162-16"><a href="dm-base-r.html#cb162-16"></a><span class="co">#&gt; [1,]   19   22   25</span></span>
<span id="cb162-17"><a href="dm-base-r.html#cb162-17"></a><span class="co">#&gt; [2,]   20   23   26</span></span>
<span id="cb162-18"><a href="dm-base-r.html#cb162-18"></a><span class="co">#&gt; [3,]   21   24   27</span></span></code></pre></div>
<p>对每个二维矩阵按列求和</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="dm-base-r.html#cb163-1"></a><span class="kw">lapply</span>(<span class="kw">asplit</span>(<span class="kw">array</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">27</span>, <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>)), <span class="dv">3</span>), apply, <span class="dv">2</span>, sum)</span>
<span id="cb163-2"><a href="dm-base-r.html#cb163-2"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb163-3"><a href="dm-base-r.html#cb163-3"></a><span class="co">#&gt; [1]  6 15 24</span></span>
<span id="cb163-4"><a href="dm-base-r.html#cb163-4"></a><span class="co">#&gt; </span></span>
<span id="cb163-5"><a href="dm-base-r.html#cb163-5"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb163-6"><a href="dm-base-r.html#cb163-6"></a><span class="co">#&gt; [1] 33 42 51</span></span>
<span id="cb163-7"><a href="dm-base-r.html#cb163-7"></a><span class="co">#&gt; </span></span>
<span id="cb163-8"><a href="dm-base-r.html#cb163-8"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb163-9"><a href="dm-base-r.html#cb163-9"></a><span class="co">#&gt; [1] 60 69 78</span></span></code></pre></div>
<p><code>asplit</code> 和 <code>lapply</code> 组合处理多维数组的计算问题，多维数组<a href="99-references.html#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a></p>
<p><a href="https://d.cosx.org/d/107493">三维数组的矩阵运算</a> <a href="https://CRAN.R-project.org/package=abind">abind</a> 包提供更多的数组操作，如合并，替换</p>
</div>
<div id="base-others" class="section level2">
<h2><span class="header-section-number">3.13</span> 其它操作</h2>
<p>成对的数据操作有 <code>list</code> 与 <code>unlist</code>、<code>stack</code> 与 <code>unstack</code>、<code>class</code> 与 <code>unclass</code>、<code>attach</code> 与 <code>detach</code> 以及 <code>with</code> 和 <code>within</code>，它们在数据操作过程中有时会起到一定的补充作用。</p>
<div id="relist-or-unlist" class="section level3">
<h3><span class="header-section-number">3.13.1</span> 列表属性</h3>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="dm-base-r.html#cb164-1"></a><span class="co"># 创建列表</span></span>
<span id="cb164-2"><a href="dm-base-r.html#cb164-2"></a><span class="kw">list</span>(...)</span>
<span id="cb164-3"><a href="dm-base-r.html#cb164-3"></a><span class="kw">pairlist</span>(...)</span>
<span id="cb164-4"><a href="dm-base-r.html#cb164-4"></a><span class="co"># 转化列表</span></span>
<span id="cb164-5"><a href="dm-base-r.html#cb164-5"></a><span class="kw">as.list</span>(x, ...)</span>
<span id="cb164-6"><a href="dm-base-r.html#cb164-6"></a><span class="co">## S3 method for class &#39;environment&#39;</span></span>
<span id="cb164-7"><a href="dm-base-r.html#cb164-7"></a><span class="kw">as.list</span>(x, <span class="dt">all.names =</span> <span class="ot">FALSE</span>, <span class="dt">sorted =</span> <span class="ot">FALSE</span>, ...)</span>
<span id="cb164-8"><a href="dm-base-r.html#cb164-8"></a><span class="kw">as.pairlist</span>(x)</span>
<span id="cb164-9"><a href="dm-base-r.html#cb164-9"></a><span class="co"># 检查列表</span></span>
<span id="cb164-10"><a href="dm-base-r.html#cb164-10"></a><span class="kw">is.list</span>(x)</span>
<span id="cb164-11"><a href="dm-base-r.html#cb164-11"></a><span class="kw">is.pairlist</span>(x)</span>
<span id="cb164-12"><a href="dm-base-r.html#cb164-12"></a></span>
<span id="cb164-13"><a href="dm-base-r.html#cb164-13"></a><span class="kw">alist</span>(...)</span></code></pre></div>
<p><code>list</code> 函数用来构造、转化和检查 R 列表对象。下面创建一个临时列表对象 tmp ，它包含两个元素 A 和 B，两个元素都是向量，前者是数值型，后者是字符型</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="dm-base-r.html#cb165-1"></a>(tmp &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">A =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="dt">B =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>)))</span>
<span id="cb165-2"><a href="dm-base-r.html#cb165-2"></a><span class="co">#&gt; $A</span></span>
<span id="cb165-3"><a href="dm-base-r.html#cb165-3"></a><span class="co">#&gt; [1] 1 2 3</span></span>
<span id="cb165-4"><a href="dm-base-r.html#cb165-4"></a><span class="co">#&gt; </span></span>
<span id="cb165-5"><a href="dm-base-r.html#cb165-5"></a><span class="co">#&gt; $B</span></span>
<span id="cb165-6"><a href="dm-base-r.html#cb165-6"></a><span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="dm-base-r.html#cb166-1"></a><span class="kw">unlist</span>(x, <span class="dt">recursive =</span> <span class="ot">TRUE</span>, <span class="dt">use.names =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><code>unlist</code> 函数将给定的列表对象 <code>x</code> 简化为原子向量 (atomic vector)，我们发现简化之后变成一个字符型向量</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="dm-base-r.html#cb167-1"></a><span class="kw">unlist</span>(tmp)</span>
<span id="cb167-2"><a href="dm-base-r.html#cb167-2"></a><span class="co">#&gt;  A1  A2  A3  B1  B2 </span></span>
<span id="cb167-3"><a href="dm-base-r.html#cb167-3"></a><span class="co">#&gt; &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;a&quot; &quot;b&quot;</span></span>
<span id="cb167-4"><a href="dm-base-r.html#cb167-4"></a><span class="kw">unlist</span>(tmp, <span class="dt">use.names =</span> <span class="ot">FALSE</span>)</span>
<span id="cb167-5"><a href="dm-base-r.html#cb167-5"></a><span class="co">#&gt; [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;a&quot; &quot;b&quot;</span></span></code></pre></div>
<p>unlist 的逆操作是 relist</p>
</div>
<div id="stack-or-unstack" class="section level3">
<h3><span class="header-section-number">3.13.2</span> 堆叠向量</h3>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="dm-base-r.html#cb168-1"></a><span class="kw">stack</span>(x, ...)</span>
<span id="cb168-2"><a href="dm-base-r.html#cb168-2"></a><span class="co">## Default S3 method:</span></span>
<span id="cb168-3"><a href="dm-base-r.html#cb168-3"></a><span class="kw">stack</span>(x, <span class="dt">drop =</span> <span class="ot">FALSE</span>, ...)</span>
<span id="cb168-4"><a href="dm-base-r.html#cb168-4"></a><span class="co">## S3 method for class &#39;data.frame&#39;</span></span>
<span id="cb168-5"><a href="dm-base-r.html#cb168-5"></a><span class="kw">stack</span>(x, select, <span class="dt">drop =</span> <span class="ot">FALSE</span>, ...)</span>
<span id="cb168-6"><a href="dm-base-r.html#cb168-6"></a></span>
<span id="cb168-7"><a href="dm-base-r.html#cb168-7"></a><span class="kw">unstack</span>(x, ...)</span>
<span id="cb168-8"><a href="dm-base-r.html#cb168-8"></a><span class="co">## Default S3 method:</span></span>
<span id="cb168-9"><a href="dm-base-r.html#cb168-9"></a><span class="kw">unstack</span>(x, form, ...)</span>
<span id="cb168-10"><a href="dm-base-r.html#cb168-10"></a><span class="co">## S3 method for class &#39;data.frame&#39;</span></span>
<span id="cb168-11"><a href="dm-base-r.html#cb168-11"></a><span class="kw">unstack</span>(x, form, ...)</span></code></pre></div>
<p><code>stack</code> 与 <code>unstack</code> 将多个向量堆在一起组成一个向量</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="dm-base-r.html#cb169-1"></a><span class="co"># 查看数据集 PlantGrowth</span></span>
<span id="cb169-2"><a href="dm-base-r.html#cb169-2"></a><span class="kw">class</span>(PlantGrowth)</span>
<span id="cb169-3"><a href="dm-base-r.html#cb169-3"></a><span class="co">#&gt; [1] &quot;data.frame&quot;</span></span>
<span id="cb169-4"><a href="dm-base-r.html#cb169-4"></a><span class="kw">head</span>(PlantGrowth)</span>
<span id="cb169-5"><a href="dm-base-r.html#cb169-5"></a><span class="co">#&gt;   weight group</span></span>
<span id="cb169-6"><a href="dm-base-r.html#cb169-6"></a><span class="co">#&gt; 1   4.17  ctrl</span></span>
<span id="cb169-7"><a href="dm-base-r.html#cb169-7"></a><span class="co">#&gt; 2   5.58  ctrl</span></span>
<span id="cb169-8"><a href="dm-base-r.html#cb169-8"></a><span class="co">#&gt; 3   5.18  ctrl</span></span>
<span id="cb169-9"><a href="dm-base-r.html#cb169-9"></a><span class="co">#&gt; 4   6.11  ctrl</span></span>
<span id="cb169-10"><a href="dm-base-r.html#cb169-10"></a><span class="co">#&gt; 5   4.50  ctrl</span></span>
<span id="cb169-11"><a href="dm-base-r.html#cb169-11"></a><span class="co">#&gt; 6   4.61  ctrl</span></span>
<span id="cb169-12"><a href="dm-base-r.html#cb169-12"></a><span class="co"># 检查默认的公式</span></span>
<span id="cb169-13"><a href="dm-base-r.html#cb169-13"></a><span class="kw">formula</span>(PlantGrowth) </span>
<span id="cb169-14"><a href="dm-base-r.html#cb169-14"></a><span class="co">#&gt; weight ~ group</span></span>
<span id="cb169-15"><a href="dm-base-r.html#cb169-15"></a><span class="co"># 根据公式解除堆叠</span></span>
<span id="cb169-16"><a href="dm-base-r.html#cb169-16"></a><span class="co"># 下面等价于 unstack(PlantGrowth, form = weight ~ group)</span></span>
<span id="cb169-17"><a href="dm-base-r.html#cb169-17"></a>(pg &lt;-<span class="st"> </span><span class="kw">unstack</span>(PlantGrowth)) </span>
<span id="cb169-18"><a href="dm-base-r.html#cb169-18"></a><span class="co">#&gt;    ctrl trt1 trt2</span></span>
<span id="cb169-19"><a href="dm-base-r.html#cb169-19"></a><span class="co">#&gt; 1  4.17 4.81 6.31</span></span>
<span id="cb169-20"><a href="dm-base-r.html#cb169-20"></a><span class="co">#&gt; 2  5.58 4.17 5.12</span></span>
<span id="cb169-21"><a href="dm-base-r.html#cb169-21"></a><span class="co">#&gt; 3  5.18 4.41 5.54</span></span>
<span id="cb169-22"><a href="dm-base-r.html#cb169-22"></a><span class="co">#&gt; 4  6.11 3.59 5.50</span></span>
<span id="cb169-23"><a href="dm-base-r.html#cb169-23"></a><span class="co">#&gt; 5  4.50 5.87 5.37</span></span>
<span id="cb169-24"><a href="dm-base-r.html#cb169-24"></a><span class="co">#&gt; 6  4.61 3.83 5.29</span></span>
<span id="cb169-25"><a href="dm-base-r.html#cb169-25"></a><span class="co">#&gt; 7  5.17 6.03 4.92</span></span>
<span id="cb169-26"><a href="dm-base-r.html#cb169-26"></a><span class="co">#&gt; 8  4.53 4.89 6.15</span></span>
<span id="cb169-27"><a href="dm-base-r.html#cb169-27"></a><span class="co">#&gt; 9  5.33 4.32 5.80</span></span>
<span id="cb169-28"><a href="dm-base-r.html#cb169-28"></a><span class="co">#&gt; 10 5.14 4.69 5.26</span></span></code></pre></div>
<p>现在再将变量 pg 堆叠起来，还可以指定要堆叠的列</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="dm-base-r.html#cb170-1"></a><span class="kw">stack</span>(pg)</span>
<span id="cb170-2"><a href="dm-base-r.html#cb170-2"></a><span class="co">#&gt;    values  ind</span></span>
<span id="cb170-3"><a href="dm-base-r.html#cb170-3"></a><span class="co">#&gt; 1    4.17 ctrl</span></span>
<span id="cb170-4"><a href="dm-base-r.html#cb170-4"></a><span class="co">#&gt; 2    5.58 ctrl</span></span>
<span id="cb170-5"><a href="dm-base-r.html#cb170-5"></a><span class="co">#&gt; 3    5.18 ctrl</span></span>
<span id="cb170-6"><a href="dm-base-r.html#cb170-6"></a><span class="co">#&gt; 4    6.11 ctrl</span></span>
<span id="cb170-7"><a href="dm-base-r.html#cb170-7"></a><span class="co">#&gt; 5    4.50 ctrl</span></span>
<span id="cb170-8"><a href="dm-base-r.html#cb170-8"></a>....</span>
<span id="cb170-9"><a href="dm-base-r.html#cb170-9"></a><span class="kw">stack</span>(pg, <span class="dt">select =</span> <span class="op">-</span>ctrl)</span>
<span id="cb170-10"><a href="dm-base-r.html#cb170-10"></a><span class="co">#&gt;    values  ind</span></span>
<span id="cb170-11"><a href="dm-base-r.html#cb170-11"></a><span class="co">#&gt; 1    4.81 trt1</span></span>
<span id="cb170-12"><a href="dm-base-r.html#cb170-12"></a><span class="co">#&gt; 2    4.17 trt1</span></span>
<span id="cb170-13"><a href="dm-base-r.html#cb170-13"></a><span class="co">#&gt; 3    4.41 trt1</span></span>
<span id="cb170-14"><a href="dm-base-r.html#cb170-14"></a><span class="co">#&gt; 4    3.59 trt1</span></span>
<span id="cb170-15"><a href="dm-base-r.html#cb170-15"></a><span class="co">#&gt; 5    5.87 trt1</span></span>
<span id="cb170-16"><a href="dm-base-r.html#cb170-16"></a>....</span></code></pre></div>
<div class="sidebar">
<p>形式上和 reshape 有一些相似之处，数据框可以由长变宽或由宽变长</p>
</div>
</div>
<div id="class-or-unclass" class="section level3">
<h3><span class="header-section-number">3.13.3</span> 属性转化</h3>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="dm-base-r.html#cb171-1"></a><span class="kw">class</span>(x)</span>
<span id="cb171-2"><a href="dm-base-r.html#cb171-2"></a><span class="kw">class</span>(x) &lt;-<span class="st"> </span>value</span>
<span id="cb171-3"><a href="dm-base-r.html#cb171-3"></a><span class="kw">unclass</span>(x)</span>
<span id="cb171-4"><a href="dm-base-r.html#cb171-4"></a><span class="kw">inherits</span>(x, what, <span class="dt">which =</span> <span class="ot">FALSE</span>)</span>
<span id="cb171-5"><a href="dm-base-r.html#cb171-5"></a></span>
<span id="cb171-6"><a href="dm-base-r.html#cb171-6"></a><span class="kw">oldClass</span>(x)</span>
<span id="cb171-7"><a href="dm-base-r.html#cb171-7"></a><span class="kw">oldClass</span>(x) &lt;-<span class="st"> </span>value</span></code></pre></div>
<p><code>class</code> 和 <code>unclass</code> 函数用来查看、设置类属性和取消类属性，常用于面向对象的编程设计中</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="dm-base-r.html#cb172-1"></a><span class="kw">class</span>(iris)</span>
<span id="cb172-2"><a href="dm-base-r.html#cb172-2"></a><span class="co">#&gt; [1] &quot;data.frame&quot;</span></span>
<span id="cb172-3"><a href="dm-base-r.html#cb172-3"></a><span class="kw">class</span>(iris<span class="op">$</span>Species)</span>
<span id="cb172-4"><a href="dm-base-r.html#cb172-4"></a><span class="co">#&gt; [1] &quot;factor&quot;</span></span>
<span id="cb172-5"><a href="dm-base-r.html#cb172-5"></a><span class="kw">unclass</span>(iris<span class="op">$</span>Species)</span>
<span id="cb172-6"><a href="dm-base-r.html#cb172-6"></a><span class="co">#&gt;   [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span></span>
<span id="cb172-7"><a href="dm-base-r.html#cb172-7"></a><span class="co">#&gt;  [36] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span></span>
<span id="cb172-8"><a href="dm-base-r.html#cb172-8"></a><span class="co">#&gt;  [71] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3</span></span>
<span id="cb172-9"><a href="dm-base-r.html#cb172-9"></a><span class="co">#&gt; [106] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3</span></span>
<span id="cb172-10"><a href="dm-base-r.html#cb172-10"></a><span class="co">#&gt; [141] 3 3 3 3 3 3 3 3 3 3</span></span>
<span id="cb172-11"><a href="dm-base-r.html#cb172-11"></a><span class="co">#&gt; attr(,&quot;levels&quot;)</span></span>
<span id="cb172-12"><a href="dm-base-r.html#cb172-12"></a>....</span></code></pre></div>
</div>
<div id="attach-or-detach" class="section level3">
<h3><span class="header-section-number">3.13.4</span> 绑定环境</h3>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="dm-base-r.html#cb173-1"></a><span class="kw">attach</span>(what,</span>
<span id="cb173-2"><a href="dm-base-r.html#cb173-2"></a>  <span class="dt">pos =</span> 2L, <span class="dt">name =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(what), <span class="dt">backtick =</span> <span class="ot">FALSE</span>),</span>
<span id="cb173-3"><a href="dm-base-r.html#cb173-3"></a>  <span class="dt">warn.conflicts =</span> <span class="ot">TRUE</span></span>
<span id="cb173-4"><a href="dm-base-r.html#cb173-4"></a>)</span>
<span id="cb173-5"><a href="dm-base-r.html#cb173-5"></a><span class="kw">detach</span>(name,</span>
<span id="cb173-6"><a href="dm-base-r.html#cb173-6"></a>  <span class="dt">pos =</span> 2L, <span class="dt">unload =</span> <span class="ot">FALSE</span>, <span class="dt">character.only =</span> <span class="ot">FALSE</span>,</span>
<span id="cb173-7"><a href="dm-base-r.html#cb173-7"></a>  <span class="dt">force =</span> <span class="ot">FALSE</span></span>
<span id="cb173-8"><a href="dm-base-r.html#cb173-8"></a>)</span></code></pre></div>
<p><code>attach</code> 和 <code>detach</code> 是否绑定数据框的列名，不推荐操作，推荐使用 <code>with</code></p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="dm-base-r.html#cb174-1"></a><span class="kw">attach</span>(iris)</span>
<span id="cb174-2"><a href="dm-base-r.html#cb174-2"></a><span class="kw">head</span>(Species)</span>
<span id="cb174-3"><a href="dm-base-r.html#cb174-3"></a><span class="co">#&gt; [1] setosa setosa setosa setosa setosa setosa</span></span>
<span id="cb174-4"><a href="dm-base-r.html#cb174-4"></a><span class="co">#&gt; Levels: setosa versicolor virginica</span></span>
<span id="cb174-5"><a href="dm-base-r.html#cb174-5"></a><span class="kw">detach</span>(iris)</span></code></pre></div>
</div>
<div id="with-or-within" class="section level3">
<h3><span class="header-section-number">3.13.5</span> 数据环境</h3>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="dm-base-r.html#cb175-1"></a><span class="kw">with</span>(data, expr, ...)</span>
<span id="cb175-2"><a href="dm-base-r.html#cb175-2"></a><span class="kw">within</span>(data, expr, ...)</span>
<span id="cb175-3"><a href="dm-base-r.html#cb175-3"></a><span class="co">## S3 method for class &#39;list&#39;</span></span>
<span id="cb175-4"><a href="dm-base-r.html#cb175-4"></a><span class="kw">within</span>(data, expr, <span class="dt">keepAttrs =</span> <span class="ot">TRUE</span>, ...)</span></code></pre></div>
<dl>
<dt><code>data</code></dt>
<dd>参数 <code>data</code> 用来构造表达式计算的环境。其默认值可以是一个环境，列表，数据框。在 <code>within</code> 函数中 <code>data</code> 参数只能是列表或数据框。
</dd>
<dt><code>expr</code></dt>
<dd><p>参数 <code>expr</code> 包含要计算的表达式。在 <code>within</code> 中通常包含一个复合表达式，比如</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="dm-base-r.html#cb176-1"></a>{</span>
<span id="cb176-2"><a href="dm-base-r.html#cb176-2"></a>  a &lt;-<span class="st"> </span><span class="kw">somefun</span>()</span>
<span id="cb176-3"><a href="dm-base-r.html#cb176-3"></a>  b &lt;-<span class="st"> </span><span class="kw">otherfun</span>()</span>
<span id="cb176-4"><a href="dm-base-r.html#cb176-4"></a>  ...</span>
<span id="cb176-5"><a href="dm-base-r.html#cb176-5"></a>  <span class="kw">rm</span>(unused1, temp)</span>
<span id="cb176-6"><a href="dm-base-r.html#cb176-6"></a>}</span></code></pre></div>
</dd>
</dl>
<p><code>with</code> 和 <code>within</code> 计算一组表达式，计算的环境是由数据构造的，后者可以修改原始的数据</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="dm-base-r.html#cb177-1"></a><span class="kw">with</span>(mtcars, mpg[cyl <span class="op">==</span><span class="st"> </span><span class="dv">8</span> <span class="op">&amp;</span><span class="st"> </span>disp <span class="op">&gt;</span><span class="st"> </span><span class="dv">350</span>])</span>
<span id="cb177-2"><a href="dm-base-r.html#cb177-2"></a><span class="co">#&gt; [1] 18.7 14.3 10.4 10.4 14.7 19.2 15.8</span></span></code></pre></div>
<p>和下面计算的结果一样，但是更加简洁漂亮</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="dm-base-r.html#cb178-1"></a>mtcars<span class="op">$</span>mpg[mtcars<span class="op">$</span>cyl <span class="op">==</span><span class="st"> </span><span class="dv">8</span> <span class="op">&amp;</span><span class="st"> </span>mtcars<span class="op">$</span>disp <span class="op">&gt;</span><span class="st"> </span><span class="dv">350</span>]</span>
<span id="cb178-2"><a href="dm-base-r.html#cb178-2"></a><span class="co">#&gt; [1] 18.7 14.3 10.4 10.4 14.7 19.2 15.8</span></span></code></pre></div>
<p><code>within</code> 函数可以修改原数据环境中的多个变量，比如删除、修改和添加等</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="dm-base-r.html#cb179-1"></a><span class="co"># 原数据集 airquality</span></span>
<span id="cb179-2"><a href="dm-base-r.html#cb179-2"></a><span class="kw">head</span>(airquality)</span>
<span id="cb179-3"><a href="dm-base-r.html#cb179-3"></a><span class="co">#&gt;   Ozone Solar.R Wind Temp Month Day</span></span>
<span id="cb179-4"><a href="dm-base-r.html#cb179-4"></a><span class="co">#&gt; 1    41     190  7.4   67     5   1</span></span>
<span id="cb179-5"><a href="dm-base-r.html#cb179-5"></a><span class="co">#&gt; 2    36     118  8.0   72     5   2</span></span>
<span id="cb179-6"><a href="dm-base-r.html#cb179-6"></a><span class="co">#&gt; 3    12     149 12.6   74     5   3</span></span>
<span id="cb179-7"><a href="dm-base-r.html#cb179-7"></a><span class="co">#&gt; 4    18     313 11.5   62     5   4</span></span>
<span id="cb179-8"><a href="dm-base-r.html#cb179-8"></a><span class="co">#&gt; 5    NA      NA 14.3   56     5   5</span></span>
<span id="cb179-9"><a href="dm-base-r.html#cb179-9"></a><span class="co">#&gt; 6    28      NA 14.9   66     5   6</span></span>
<span id="cb179-10"><a href="dm-base-r.html#cb179-10"></a>aq &lt;-<span class="st"> </span><span class="kw">within</span>(airquality, {</span>
<span id="cb179-11"><a href="dm-base-r.html#cb179-11"></a>  lOzone &lt;-<span class="st"> </span><span class="kw">log</span>(Ozone) <span class="co"># 取对数</span></span>
<span id="cb179-12"><a href="dm-base-r.html#cb179-12"></a>  Month &lt;-<span class="st"> </span><span class="kw">factor</span>(month.abb[Month]) <span class="co"># 字符串型转因子型</span></span>
<span id="cb179-13"><a href="dm-base-r.html#cb179-13"></a>  cTemp &lt;-<span class="st"> </span><span class="kw">round</span>((Temp <span class="op">-</span><span class="st"> </span><span class="dv">32</span>) <span class="op">*</span><span class="st"> </span><span class="dv">5</span> <span class="op">/</span><span class="st"> </span><span class="dv">9</span>, <span class="dv">1</span>) <span class="co"># 从华氏温度到摄氏温度转化</span></span>
<span id="cb179-14"><a href="dm-base-r.html#cb179-14"></a>  S.cT &lt;-<span class="st"> </span>Solar.R <span class="op">/</span><span class="st"> </span>cTemp <span class="co"># 使用新创建的变量</span></span>
<span id="cb179-15"><a href="dm-base-r.html#cb179-15"></a>  <span class="kw">rm</span>(Day, Temp)</span>
<span id="cb179-16"><a href="dm-base-r.html#cb179-16"></a>})</span>
<span id="cb179-17"><a href="dm-base-r.html#cb179-17"></a><span class="co"># 修改后的数据集</span></span>
<span id="cb179-18"><a href="dm-base-r.html#cb179-18"></a><span class="kw">head</span>(aq)</span>
<span id="cb179-19"><a href="dm-base-r.html#cb179-19"></a><span class="co">#&gt;   Ozone Solar.R Wind Month      S.cT cTemp   lOzone</span></span>
<span id="cb179-20"><a href="dm-base-r.html#cb179-20"></a><span class="co">#&gt; 1    41     190  7.4   May  9.793814  19.4 3.713572</span></span>
<span id="cb179-21"><a href="dm-base-r.html#cb179-21"></a><span class="co">#&gt; 2    36     118  8.0   May  5.315315  22.2 3.583519</span></span>
<span id="cb179-22"><a href="dm-base-r.html#cb179-22"></a><span class="co">#&gt; 3    12     149 12.6   May  6.394850  23.3 2.484907</span></span>
<span id="cb179-23"><a href="dm-base-r.html#cb179-23"></a><span class="co">#&gt; 4    18     313 11.5   May 18.742515  16.7 2.890372</span></span>
<span id="cb179-24"><a href="dm-base-r.html#cb179-24"></a><span class="co">#&gt; 5    NA      NA 14.3   May        NA  13.3       NA</span></span>
<span id="cb179-25"><a href="dm-base-r.html#cb179-25"></a><span class="co">#&gt; 6    28      NA 14.9   May        NA  18.9 3.332205</span></span></code></pre></div>
<p>下面再举一个复杂的绘图例子，这个例子来自 <code>boxplot</code> 函数</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="dm-base-r.html#cb180-1"></a><span class="kw">with</span>(ToothGrowth, {</span>
<span id="cb180-2"><a href="dm-base-r.html#cb180-2"></a>  <span class="kw">boxplot</span>(len <span class="op">~</span><span class="st"> </span>dose,</span>
<span id="cb180-3"><a href="dm-base-r.html#cb180-3"></a>    <span class="dt">boxwex =</span> <span class="fl">0.25</span>, <span class="dt">at =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.2</span>,</span>
<span id="cb180-4"><a href="dm-base-r.html#cb180-4"></a>    <span class="dt">subset =</span> (supp <span class="op">==</span><span class="st"> &quot;VC&quot;</span>), <span class="dt">col =</span> <span class="st">&quot;#4285f4&quot;</span>,</span>
<span id="cb180-5"><a href="dm-base-r.html#cb180-5"></a>    <span class="dt">main =</span> <span class="st">&quot;Guinea Pigs&#39; Tooth Growth&quot;</span>,</span>
<span id="cb180-6"><a href="dm-base-r.html#cb180-6"></a>    <span class="dt">xlab =</span> <span class="st">&quot;Vitamin C dose mg&quot;</span>,</span>
<span id="cb180-7"><a href="dm-base-r.html#cb180-7"></a>    <span class="dt">ylab =</span> <span class="st">&quot;tooth length&quot;</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">35</span>)</span>
<span id="cb180-8"><a href="dm-base-r.html#cb180-8"></a>  )</span>
<span id="cb180-9"><a href="dm-base-r.html#cb180-9"></a>  <span class="kw">boxplot</span>(len <span class="op">~</span><span class="st"> </span>dose,</span>
<span id="cb180-10"><a href="dm-base-r.html#cb180-10"></a>    <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">boxwex =</span> <span class="fl">0.25</span>, <span class="dt">at =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.2</span>,</span>
<span id="cb180-11"><a href="dm-base-r.html#cb180-11"></a>    <span class="dt">subset =</span> supp <span class="op">==</span><span class="st"> &quot;OJ&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;#EA4335&quot;</span></span>
<span id="cb180-12"><a href="dm-base-r.html#cb180-12"></a>  )</span>
<span id="cb180-13"><a href="dm-base-r.html#cb180-13"></a>  <span class="kw">legend</span>(<span class="dv">2</span>, <span class="dv">9</span>, <span class="kw">c</span>(<span class="st">&quot;Ascorbic acid&quot;</span>, <span class="st">&quot;Orange juice&quot;</span>),</span>
<span id="cb180-14"><a href="dm-base-r.html#cb180-14"></a>    <span class="dt">fill =</span> <span class="kw">c</span>(<span class="st">&quot;#4285f4&quot;</span>, <span class="st">&quot;#EA4335&quot;</span>)</span>
<span id="cb180-15"><a href="dm-base-r.html#cb180-15"></a>  )</span>
<span id="cb180-16"><a href="dm-base-r.html#cb180-16"></a>})</span></code></pre></div>
<p><img src="dm-base-r_files/figure-html/subset-in-boxplot-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>将 <code>boxplot</code> 函数的 <code>subset</code> 参数单独提出来，调用数据子集选择函数 <code>subset</code> ，这里 <code>with</code> 中只包含一个表达式，所以也可以不用大括号</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="dm-base-r.html#cb181-1"></a><span class="kw">with</span>(</span>
<span id="cb181-2"><a href="dm-base-r.html#cb181-2"></a>  <span class="kw">subset</span>(ToothGrowth, supp <span class="op">==</span><span class="st"> &quot;VC&quot;</span>),</span>
<span id="cb181-3"><a href="dm-base-r.html#cb181-3"></a>  <span class="kw">boxplot</span>(len <span class="op">~</span><span class="st"> </span>dose,</span>
<span id="cb181-4"><a href="dm-base-r.html#cb181-4"></a>    <span class="dt">boxwex =</span> <span class="fl">0.25</span>, <span class="dt">at =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.2</span>,</span>
<span id="cb181-5"><a href="dm-base-r.html#cb181-5"></a>    <span class="dt">col =</span> <span class="st">&quot;#4285f4&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;Guinea Pigs&#39; Tooth Growth&quot;</span>,</span>
<span id="cb181-6"><a href="dm-base-r.html#cb181-6"></a>    <span class="dt">xlab =</span> <span class="st">&quot;Vitamin C dose mg&quot;</span>,</span>
<span id="cb181-7"><a href="dm-base-r.html#cb181-7"></a>    <span class="dt">ylab =</span> <span class="st">&quot;tooth length&quot;</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">35</span>)</span>
<span id="cb181-8"><a href="dm-base-r.html#cb181-8"></a>  )</span>
<span id="cb181-9"><a href="dm-base-r.html#cb181-9"></a>)</span>
<span id="cb181-10"><a href="dm-base-r.html#cb181-10"></a><span class="kw">with</span>(</span>
<span id="cb181-11"><a href="dm-base-r.html#cb181-11"></a>  <span class="kw">subset</span>(ToothGrowth, supp <span class="op">==</span><span class="st"> &quot;OJ&quot;</span>),</span>
<span id="cb181-12"><a href="dm-base-r.html#cb181-12"></a>  <span class="kw">boxplot</span>(len <span class="op">~</span><span class="st"> </span>dose,</span>
<span id="cb181-13"><a href="dm-base-r.html#cb181-13"></a>    <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">boxwex =</span> <span class="fl">0.25</span>, <span class="dt">at =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.2</span>,</span>
<span id="cb181-14"><a href="dm-base-r.html#cb181-14"></a>    <span class="dt">col =</span> <span class="st">&quot;#EA4335&quot;</span></span>
<span id="cb181-15"><a href="dm-base-r.html#cb181-15"></a>  )</span>
<span id="cb181-16"><a href="dm-base-r.html#cb181-16"></a>)</span>
<span id="cb181-17"><a href="dm-base-r.html#cb181-17"></a><span class="kw">legend</span>(<span class="dv">2</span>, <span class="dv">9</span>, <span class="kw">c</span>(<span class="st">&quot;Ascorbic acid&quot;</span>, <span class="st">&quot;Orange juice&quot;</span>),</span>
<span id="cb181-18"><a href="dm-base-r.html#cb181-18"></a>  <span class="dt">fill =</span> <span class="kw">c</span>(<span class="st">&quot;#4285f4&quot;</span>, <span class="st">&quot;#EA4335&quot;</span>)</span>
<span id="cb181-19"><a href="dm-base-r.html#cb181-19"></a>)</span></code></pre></div>
<p><img src="dm-base-r_files/figure-html/subset-out-boxplot-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="dm-base-session-info" class="section level2">
<h2><span class="header-section-number">3.14</span> 运行环境</h2>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="dm-base-r.html#cb182-1"></a>xfun<span class="op">::</span><span class="kw">session_info</span>()</span>
<span id="cb182-2"><a href="dm-base-r.html#cb182-2"></a><span class="co">#&gt; R version 3.6.1 (2019-07-05)</span></span>
<span id="cb182-3"><a href="dm-base-r.html#cb182-3"></a><span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span id="cb182-4"><a href="dm-base-r.html#cb182-4"></a><span class="co">#&gt; Running under: Debian GNU/Linux 10 (buster)</span></span>
<span id="cb182-5"><a href="dm-base-r.html#cb182-5"></a><span class="co">#&gt; </span></span>
<span id="cb182-6"><a href="dm-base-r.html#cb182-6"></a><span class="co">#&gt; Locale:</span></span>
<span id="cb182-7"><a href="dm-base-r.html#cb182-7"></a><span class="co">#&gt;   LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span id="cb182-8"><a href="dm-base-r.html#cb182-8"></a><span class="co">#&gt;   LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span id="cb182-9"><a href="dm-base-r.html#cb182-9"></a><span class="co">#&gt;   LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span id="cb182-10"><a href="dm-base-r.html#cb182-10"></a><span class="co">#&gt;   LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span id="cb182-11"><a href="dm-base-r.html#cb182-11"></a><span class="co">#&gt;   LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span id="cb182-12"><a href="dm-base-r.html#cb182-12"></a><span class="co">#&gt;   LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span id="cb182-13"><a href="dm-base-r.html#cb182-13"></a><span class="co">#&gt; </span></span>
<span id="cb182-14"><a href="dm-base-r.html#cb182-14"></a><span class="co">#&gt; Package version:</span></span>
<span id="cb182-15"><a href="dm-base-r.html#cb182-15"></a><span class="co">#&gt;   base64enc_0.1.3  bookdown_0.12    codetools_0.2-16 compiler_3.6.1  </span></span>
<span id="cb182-16"><a href="dm-base-r.html#cb182-16"></a><span class="co">#&gt;   curl_4.0         digest_0.6.20    evaluate_0.14    glue_1.3.1      </span></span>
<span id="cb182-17"><a href="dm-base-r.html#cb182-17"></a><span class="co">#&gt;   graphics_3.6.1   grDevices_3.6.1  highr_0.8        htmltools_0.3.6 </span></span>
<span id="cb182-18"><a href="dm-base-r.html#cb182-18"></a><span class="co">#&gt;   jsonlite_1.6     knitr_1.23       magrittr_1.5     markdown_1.0    </span></span>
<span id="cb182-19"><a href="dm-base-r.html#cb182-19"></a><span class="co">#&gt;   methods_3.6.1    mime_0.7         Rcpp_1.0.2       rmarkdown_1.14  </span></span>
<span id="cb182-20"><a href="dm-base-r.html#cb182-20"></a><span class="co">#&gt;   stats_3.6.1      stringi_1.4.3    stringr_1.4.0    tinytex_0.14    </span></span>
<span id="cb182-21"><a href="dm-base-r.html#cb182-21"></a><span class="co">#&gt;   tools_3.6.1      utils_3.6.1      xfun_0.8         yaml_2.2.0</span></span></code></pre></div>

</div>
</div>
<h3>参考文献</h3>
<div id="refs" class="references">
<div id="ref-Spector_2008_Manipulation">
<p>Spector, Phil. 2008. <em>Data Manipulation with R</em>. New York, NY: Springer. <a href="https://doi.org/10.1663/978-0-387-%204731-6">https://doi.org/10.1663/978-0-387- 4731-6</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dm-import-export.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dm-dplyr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/XiangyunHuang/RGraphics/edit/master/dm-base-r.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
