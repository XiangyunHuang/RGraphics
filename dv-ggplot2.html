<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 9 章 数据可视化 | 数据可视化与R语言</title>
  <meta name="description" content="数据操作、数据分析、数据建模和数据可视化" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="第 9 章 数据可视化 | 数据可视化与R语言" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://bookdown.org/xiangyun/RGraphics/" />
  
  <meta property="og:description" content="数据操作、数据分析、数据建模和数据可视化" />
  <meta name="github-repo" content="XiangyunHuang/RGraphics" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 9 章 数据可视化 | 数据可视化与R语言" />
  
  <meta name="twitter:description" content="数据操作、数据分析、数据建模和数据可视化" />
  

<meta name="author" content="黄湘云" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dv-plot.html">
<link rel="next" href="dv-plotly.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">数据可视化与R语言</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>欢迎</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-r"><i class="fa fa-check"></i>Why R</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-read-this-book"><i class="fa fa-check"></i>目标读者</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#Getting-Help-with-R"><i class="fa fa-check"></i>获取帮助</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#history-of-r"><i class="fa fa-check"></i>发展历史</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions"><i class="fa fa-check"></i>记号约定</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#session-info"><i class="fa fa-check"></i>运行环境</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>前言</a><ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#what-talk-about"><i class="fa fa-check"></i>关于本书</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#structure-of-book"><i class="fa fa-check"></i>本书结构</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#about-author"><i class="fa fa-check"></i>关于作者</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="setup-startup.html"><a href="setup-startup.html"><i class="fa fa-check"></i><b>1</b> 安装与配置</a><ul>
<li class="chapter" data-level="1.1" data-path="setup-startup.html"><a href="setup-startup.html#repo-install"><i class="fa fa-check"></i><b>1.1</b> 仓库安装</a><ul>
<li class="chapter" data-level="1.1.1" data-path="setup-startup.html"><a href="setup-startup.html#ubuntu"><i class="fa fa-check"></i><b>1.1.1</b> Ubuntu</a></li>
<li class="chapter" data-level="1.1.2" data-path="setup-startup.html"><a href="setup-startup.html#centos"><i class="fa fa-check"></i><b>1.1.2</b> CentOS</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="setup-startup.html"><a href="setup-startup.html#source-install"><i class="fa fa-check"></i><b>1.2</b> 源码安装</a><ul>
<li class="chapter" data-level="1.2.1" data-path="setup-startup.html"><a href="setup-startup.html#ubuntu-1"><i class="fa fa-check"></i><b>1.2.1</b> Ubuntu</a></li>
<li class="chapter" data-level="1.2.2" data-path="setup-startup.html"><a href="setup-startup.html#centos-1"><i class="fa fa-check"></i><b>1.2.2</b> CentOS</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="setup-startup.html"><a href="setup-startup.html#ninja-install"><i class="fa fa-check"></i><b>1.3</b> 忍者安装</a></li>
<li class="chapter" data-level="1.4" data-path="setup-startup.html"><a href="setup-startup.html#settings"><i class="fa fa-check"></i><b>1.4</b> 配置</a><ul>
<li class="chapter" data-level="1.4.1" data-path="setup-startup.html"><a href="setup-startup.html#init-session"><i class="fa fa-check"></i><b>1.4.1</b> 初始会话 <code>.Rprofile</code></a></li>
<li class="chapter" data-level="1.4.2" data-path="setup-startup.html"><a href="setup-startup.html#environ-vars"><i class="fa fa-check"></i><b>1.4.2</b> 环境变量 <code>.Renviron</code></a></li>
<li class="chapter" data-level="1.4.3" data-path="setup-startup.html"><a href="setup-startup.html#make-vars"><i class="fa fa-check"></i><b>1.4.3</b> 编译选项 <code>Makevars</code></a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="setup-startup.html"><a href="setup-startup.html#command-line-arguments"><i class="fa fa-check"></i><b>1.5</b> 命令行参数</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="file-manipulation.html"><a href="file-manipulation.html"><i class="fa fa-check"></i><b>2</b> 文件管理员</a><ul>
<li class="chapter" data-level="2.1" data-path="file-manipulation.html"><a href="file-manipulation.html#list"><i class="fa fa-check"></i><b>2.1</b> 查看文件</a></li>
<li class="chapter" data-level="2.2" data-path="file-manipulation.html"><a href="file-manipulation.html#manipulation"><i class="fa fa-check"></i><b>2.2</b> 操作文件</a></li>
<li class="chapter" data-level="2.3" data-path="file-manipulation.html"><a href="file-manipulation.html#compression"><i class="fa fa-check"></i><b>2.3</b> 压缩文件</a></li>
<li class="chapter" data-level="2.4" data-path="file-manipulation.html"><a href="file-manipulation.html#paths"><i class="fa fa-check"></i><b>2.4</b> 路径操作</a></li>
<li class="chapter" data-level="2.5" data-path="file-manipulation.html"><a href="file-manipulation.html#find"><i class="fa fa-check"></i><b>2.5</b> 查找文件</a></li>
<li class="chapter" data-level="2.6" data-path="file-manipulation.html"><a href="file-manipulation.html#permissions"><i class="fa fa-check"></i><b>2.6</b> 文件权限</a></li>
<li class="chapter" data-level="2.7" data-path="file-manipulation.html"><a href="file-manipulation.html#locale"><i class="fa fa-check"></i><b>2.7</b> 区域设置</a></li>
<li class="chapter" data-level="2.8" data-path="file-manipulation.html"><a href="file-manipulation.html#process"><i class="fa fa-check"></i><b>2.8</b> 进程管理</a></li>
<li class="chapter" data-level="2.9" data-path="file-manipulation.html"><a href="file-manipulation.html#system-commands"><i class="fa fa-check"></i><b>2.9</b> 系统命令</a></li>
<li class="chapter" data-level="2.10" data-path="file-manipulation.html"><a href="file-manipulation.html#time"><i class="fa fa-check"></i><b>2.10</b> 时间管理</a></li>
<li class="chapter" data-level="2.11" data-path="file-manipulation.html"><a href="file-manipulation.html#package"><i class="fa fa-check"></i><b>2.11</b> R 包管理</a></li>
<li class="chapter" data-level="2.12" data-path="file-manipulation.html"><a href="file-manipulation.html#lookup-function"><i class="fa fa-check"></i><b>2.12</b> 查找函数</a></li>
<li class="chapter" data-level="2.13" data-path="file-manipulation.html"><a href="file-manipulation.html#files-session-info"><i class="fa fa-check"></i><b>2.13</b> 运行环境</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dm-import-export.html"><a href="dm-import-export.html"><i class="fa fa-check"></i><b>3</b> 数据搬运工</a><ul>
<li class="chapter" data-level="3.1" data-path="dm-import-export.html"><a href="dm-import-export.html#import-data"><i class="fa fa-check"></i><b>3.1</b> 导入数据</a><ul>
<li class="chapter" data-level="3.1.1" data-path="dm-import-export.html"><a href="dm-import-export.html#scan-file"><i class="fa fa-check"></i><b>3.1.1</b> <code>scan</code></a></li>
<li class="chapter" data-level="3.1.2" data-path="dm-import-export.html"><a href="dm-import-export.html#read-write-table"><i class="fa fa-check"></i><b>3.1.2</b> <code>read.table</code></a></li>
<li class="chapter" data-level="3.1.3" data-path="dm-import-export.html"><a href="dm-import-export.html#read-write-lines"><i class="fa fa-check"></i><b>3.1.3</b> <code>readLines</code></a></li>
<li class="chapter" data-level="3.1.4" data-path="dm-import-export.html"><a href="dm-import-export.html#read-save-rds"><i class="fa fa-check"></i><b>3.1.4</b> <code>readRDS</code></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="dm-import-export.html"><a href="dm-import-export.html#other-data-source"><i class="fa fa-check"></i><b>3.2</b> 其它数据格式</a></li>
<li class="chapter" data-level="3.3" data-path="dm-import-export.html"><a href="dm-import-export.html#import-large-dataset"><i class="fa fa-check"></i><b>3.3</b> 导入大数据集</a></li>
<li class="chapter" data-level="3.4" data-path="dm-import-export.html"><a href="dm-import-export.html#import-data-from-database"><i class="fa fa-check"></i><b>3.4</b> 从数据库导入</a><ul>
<li class="chapter" data-level="3.4.1" data-path="dm-import-export.html"><a href="dm-import-export.html#postgresql"><i class="fa fa-check"></i><b>3.4.1</b> PostgreSQL</a></li>
<li class="chapter" data-level="3.4.2" data-path="dm-import-export.html"><a href="dm-import-export.html#mysql"><i class="fa fa-check"></i><b>3.4.2</b> MySQL</a></li>
<li class="chapter" data-level="3.4.3" data-path="dm-import-export.html"><a href="dm-import-export.html#spark"><i class="fa fa-check"></i><b>3.4.3</b> Spark</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="dm-import-export.html"><a href="dm-import-export.html#batch-import-data"><i class="fa fa-check"></i><b>3.5</b> 批量导入数据</a></li>
<li class="chapter" data-level="3.6" data-path="dm-import-export.html"><a href="dm-import-export.html#batch-export-data"><i class="fa fa-check"></i><b>3.6</b> 批量导出数据</a></li>
<li class="chapter" data-level="3.7" data-path="dm-import-export.html"><a href="dm-import-export.html#export-data"><i class="fa fa-check"></i><b>3.7</b> 导出数据</a><ul>
<li class="chapter" data-level="3.7.1" data-path="dm-import-export.html"><a href="dm-import-export.html#export-output"><i class="fa fa-check"></i><b>3.7.1</b> 导出运行结果</a></li>
<li class="chapter" data-level="3.7.2" data-path="dm-import-export.html"><a href="dm-import-export.html#export-data-object"><i class="fa fa-check"></i><b>3.7.2</b> 导出数据对象</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="dm-import-export.html"><a href="dm-import-export.html#dm-session-info"><i class="fa fa-check"></i><b>3.8</b> 运行环境</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dm-base-r.html"><a href="dm-base-r.html"><i class="fa fa-check"></i><b>4</b> 数据操作手</a><ul>
<li class="chapter" data-level="4.1" data-path="dm-base-r.html"><a href="dm-base-r.html#show"><i class="fa fa-check"></i><b>4.1</b> 查看数据</a></li>
<li class="chapter" data-level="4.2" data-path="dm-base-r.html"><a href="dm-base-r.html#base-reshape"><i class="fa fa-check"></i><b>4.2</b> 数据变形</a></li>
<li class="chapter" data-level="4.3" data-path="dm-base-r.html"><a href="dm-base-r.html#base-transform"><i class="fa fa-check"></i><b>4.3</b> 数据转换</a></li>
<li class="chapter" data-level="4.4" data-path="dm-base-r.html"><a href="dm-base-r.html#base-subset"><i class="fa fa-check"></i><b>4.4</b> 提取子集</a></li>
<li class="chapter" data-level="4.5" data-path="dm-base-r.html"><a href="dm-base-r.html#base-order"><i class="fa fa-check"></i><b>4.5</b> 按列排序</a></li>
<li class="chapter" data-level="4.6" data-path="dm-base-r.html"><a href="dm-base-r.html#base-split"><i class="fa fa-check"></i><b>4.6</b> 数据拆分</a></li>
<li class="chapter" data-level="4.7" data-path="dm-base-r.html"><a href="dm-base-r.html#base-merge"><i class="fa fa-check"></i><b>4.7</b> 数据合并</a></li>
<li class="chapter" data-level="4.8" data-path="dm-base-r.html"><a href="dm-base-r.html#base-duplicated"><i class="fa fa-check"></i><b>4.8</b> 数据去重</a></li>
<li class="chapter" data-level="4.9" data-path="dm-base-r.html"><a href="dm-base-r.html#base-aggregate"><i class="fa fa-check"></i><b>4.9</b> 数据聚合</a></li>
<li class="chapter" data-level="4.10" data-path="dm-base-r.html"><a href="dm-base-r.html#base-table"><i class="fa fa-check"></i><b>4.10</b> 表格统计</a></li>
<li class="chapter" data-level="4.11" data-path="dm-base-r.html"><a href="dm-base-r.html#base-index"><i class="fa fa-check"></i><b>4.11</b> 索引访问</a></li>
<li class="chapter" data-level="4.12" data-path="dm-base-r.html"><a href="dm-base-r.html#base-array"><i class="fa fa-check"></i><b>4.12</b> 多维数组</a></li>
<li class="chapter" data-level="4.13" data-path="dm-base-r.html"><a href="dm-base-r.html#base-others"><i class="fa fa-check"></i><b>4.13</b> 其它操作</a><ul>
<li class="chapter" data-level="4.13.1" data-path="dm-base-r.html"><a href="dm-base-r.html#relist-or-unlist"><i class="fa fa-check"></i><b>4.13.1</b> 列表属性</a></li>
<li class="chapter" data-level="4.13.2" data-path="dm-base-r.html"><a href="dm-base-r.html#stack-or-unstack"><i class="fa fa-check"></i><b>4.13.2</b> 堆叠向量</a></li>
<li class="chapter" data-level="4.13.3" data-path="dm-base-r.html"><a href="dm-base-r.html#class-or-unclass"><i class="fa fa-check"></i><b>4.13.3</b> 属性转化</a></li>
<li class="chapter" data-level="4.13.4" data-path="dm-base-r.html"><a href="dm-base-r.html#attach-or-detach"><i class="fa fa-check"></i><b>4.13.4</b> 绑定环境</a></li>
<li class="chapter" data-level="4.13.5" data-path="dm-base-r.html"><a href="dm-base-r.html#with-or-within"><i class="fa fa-check"></i><b>4.13.5</b> 数据环境</a></li>
</ul></li>
<li class="chapter" data-level="4.14" data-path="dm-base-r.html"><a href="dm-base-r.html#dm-base-session-info"><i class="fa fa-check"></i><b>4.14</b> 运行环境</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dm-dplyr.html"><a href="dm-dplyr.html"><i class="fa fa-check"></i><b>5</b> 净土化操作</a><ul>
<li class="chapter" data-level="5.1" data-path="dm-dplyr.html"><a href="dm-dplyr.html#common-operations"><i class="fa fa-check"></i><b>5.1</b> 常用操作</a><ul>
<li class="chapter" data-level="5.1.1" data-path="dm-dplyr.html"><a href="dm-dplyr.html#tibble-show"><i class="fa fa-check"></i><b>5.1.1</b> 查看</a></li>
<li class="chapter" data-level="5.1.2" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dplyr-subset"><i class="fa fa-check"></i><b>5.1.2</b> 筛选</a></li>
<li class="chapter" data-level="5.1.3" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dplyr-order"><i class="fa fa-check"></i><b>5.1.3</b> 排序</a></li>
<li class="chapter" data-level="5.1.4" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dplyr-aggregate"><i class="fa fa-check"></i><b>5.1.4</b> 聚合</a></li>
<li class="chapter" data-level="5.1.5" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dplyr-merge"><i class="fa fa-check"></i><b>5.1.5</b> 合并</a></li>
<li class="chapter" data-level="5.1.6" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dplyr-reshape"><i class="fa fa-check"></i><b>5.1.6</b> 重塑</a></li>
<li class="chapter" data-level="5.1.7" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dplyr-transform"><i class="fa fa-check"></i><b>5.1.7</b> 变换</a></li>
<li class="chapter" data-level="5.1.8" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dplyr-duplicated"><i class="fa fa-check"></i><b>5.1.8</b> 去重</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="dm-dplyr.html"><a href="dm-dplyr.html#common-dataframe-operations"><i class="fa fa-check"></i><b>5.2</b> 高频问题</a><ul>
<li class="chapter" data-level="5.2.1" data-path="dm-dplyr.html"><a href="dm-dplyr.html#create-empty-dataframe"><i class="fa fa-check"></i><b>5.2.1</b> 初始化数据框</a></li>
<li class="chapter" data-level="5.2.2" data-path="dm-dplyr.html"><a href="dm-dplyr.html#remove-missing-values"><i class="fa fa-check"></i><b>5.2.2</b> 移除缺失记录</a></li>
<li class="chapter" data-level="5.2.3" data-path="dm-dplyr.html"><a href="dm-dplyr.html#coerce-data-type"><i class="fa fa-check"></i><b>5.2.3</b> 数据类型转化</a></li>
<li class="chapter" data-level="5.2.4" data-path="dm-dplyr.html"><a href="dm-dplyr.html#cross-group-by"><i class="fa fa-check"></i><b>5.2.4</b> 跨列分组求和</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="dm-dplyr.html"><a href="dm-dplyr.html#pipe-manipulation"><i class="fa fa-check"></i><b>5.3</b> 管道操作</a></li>
<li class="chapter" data-level="5.4" data-path="dm-dplyr.html"><a href="dm-dplyr.html#dm-dplyr-session-info"><i class="fa fa-check"></i><b>5.4</b> 运行环境</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html"><i class="fa fa-check"></i><b>6</b> 字符串操作</a><ul>
<li class="chapter" data-level="6.1" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-count"><i class="fa fa-check"></i><b>6.1</b> 字符数统计</a></li>
<li class="chapter" data-level="6.2" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-translations"><i class="fa fa-check"></i><b>6.2</b> 字符串翻译</a></li>
<li class="chapter" data-level="6.3" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-concatenate"><i class="fa fa-check"></i><b>6.3</b> 字符串连接</a></li>
<li class="chapter" data-level="6.4" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-strsplit"><i class="fa fa-check"></i><b>6.4</b> 字符串拆分</a></li>
<li class="chapter" data-level="6.5" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-match"><i class="fa fa-check"></i><b>6.5</b> 字符串匹配</a></li>
<li class="chapter" data-level="6.6" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-search"><i class="fa fa-check"></i><b>6.6</b> 字符串查询</a></li>
<li class="chapter" data-level="6.7" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-replacement"><i class="fa fa-check"></i><b>6.7</b> 字符串替换</a></li>
<li class="chapter" data-level="6.8" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#base-extract"><i class="fa fa-check"></i><b>6.8</b> 字符串提取</a></li>
<li class="chapter" data-level="6.9" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#other-string-op"><i class="fa fa-check"></i><b>6.9</b> 其它操作</a><ul>
<li class="chapter" data-level="6.9.1" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#strwrap"><i class="fa fa-check"></i><b>6.9.1</b> strwrap</a></li>
<li class="chapter" data-level="6.9.2" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#strtrim"><i class="fa fa-check"></i><b>6.9.2</b> strtrim</a></li>
<li class="chapter" data-level="6.9.3" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#strrep"><i class="fa fa-check"></i><b>6.9.3</b> strrep</a></li>
<li class="chapter" data-level="6.9.4" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#trimws"><i class="fa fa-check"></i><b>6.9.4</b> trimws</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="dc-string-manipulation.html"><a href="dc-string-manipulation.html#string-session-info"><i class="fa fa-check"></i><b>6.10</b> 运行环境</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html"><i class="fa fa-check"></i><b>7</b> 正则表达式</a><ul>
<li class="chapter" data-level="7.1" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#character-constants"><i class="fa fa-check"></i><b>7.1</b> 字符常量</a></li>
<li class="chapter" data-level="7.2" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#environments"><i class="fa fa-check"></i><b>7.2</b> 软件环境</a></li>
<li class="chapter" data-level="7.3" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#foundations"><i class="fa fa-check"></i><b>7.3</b> 基本概念</a></li>
<li class="chapter" data-level="7.4" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#match"><i class="fa fa-check"></i><b>7.4</b> 字符串匹配</a></li>
<li class="chapter" data-level="7.5" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#concatenation"><i class="fa fa-check"></i><b>7.5</b> 级联表达式</a></li>
<li class="chapter" data-level="7.6" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#backreference"><i class="fa fa-check"></i><b>7.6</b> 反向引用</a></li>
<li class="chapter" data-level="7.7" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#named-capture"><i class="fa fa-check"></i><b>7.7</b> 命名捕捉</a></li>
<li class="chapter" data-level="7.8" data-path="dc-regular-expressions.html"><a href="dc-regular-expressions.html#comment"><i class="fa fa-check"></i><b>7.8</b> 表达式注释</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="dv-plot.html"><a href="dv-plot.html"><i class="fa fa-check"></i><b>8</b> 绘图素材库</a><ul>
<li class="chapter" data-level="8.1" data-path="dv-plot.html"><a href="dv-plot.html#elements"><i class="fa fa-check"></i><b>8.1</b> 基本要素</a><ul>
<li class="chapter" data-level="8.1.1" data-path="dv-plot.html"><a href="dv-plot.html#base-points"><i class="fa fa-check"></i><b>8.1.1</b> 点线</a></li>
<li class="chapter" data-level="8.1.2" data-path="dv-plot.html"><a href="dv-plot.html#base-rect"><i class="fa fa-check"></i><b>8.1.2</b> 区域</a></li>
<li class="chapter" data-level="8.1.3" data-path="dv-plot.html"><a href="dv-plot.html#base-lines"><i class="fa fa-check"></i><b>8.1.3</b> 参考线</a></li>
<li class="chapter" data-level="8.1.4" data-path="dv-plot.html"><a href="dv-plot.html#base-axis"><i class="fa fa-check"></i><b>8.1.4</b> 坐标轴</a></li>
<li class="chapter" data-level="8.1.5" data-path="dv-plot.html"><a href="dv-plot.html#base-tick"><i class="fa fa-check"></i><b>8.1.5</b> 刻度线</a></li>
<li class="chapter" data-level="8.1.6" data-path="dv-plot.html"><a href="dv-plot.html#base-title"><i class="fa fa-check"></i><b>8.1.6</b> 标题</a></li>
<li class="chapter" data-level="8.1.7" data-path="dv-plot.html"><a href="dv-plot.html#base-annotation"><i class="fa fa-check"></i><b>8.1.7</b> 注释</a></li>
<li class="chapter" data-level="8.1.8" data-path="dv-plot.html"><a href="dv-plot.html#base-legend"><i class="fa fa-check"></i><b>8.1.8</b> 图例</a></li>
<li class="chapter" data-level="8.1.9" data-path="dv-plot.html"><a href="dv-plot.html#base-par"><i class="fa fa-check"></i><b>8.1.9</b> 边空</a></li>
<li class="chapter" data-level="8.1.10" data-path="dv-plot.html"><a href="dv-plot.html#base-layer"><i class="fa fa-check"></i><b>8.1.10</b> 图层</a></li>
<li class="chapter" data-level="8.1.11" data-path="dv-plot.html"><a href="dv-plot.html#base-layout"><i class="fa fa-check"></i><b>8.1.11</b> 布局</a></li>
<li class="chapter" data-level="8.1.12" data-path="dv-plot.html"><a href="dv-plot.html#base-combine"><i class="fa fa-check"></i><b>8.1.12</b> 组合</a></li>
<li class="chapter" data-level="8.1.13" data-path="dv-plot.html"><a href="dv-plot.html#base-screen"><i class="fa fa-check"></i><b>8.1.13</b> 分屏</a></li>
<li class="chapter" data-level="8.1.14" data-path="dv-plot.html"><a href="dv-plot.html#identify-locator"><i class="fa fa-check"></i><b>8.1.14</b> 交互</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="dv-plot.html"><a href="dv-plot.html#plot-gallary"><i class="fa fa-check"></i><b>8.2</b> 统计图形</a><ul>
<li class="chapter" data-level="8.2.1" data-path="dv-plot.html"><a href="dv-plot.html#plot-bar"><i class="fa fa-check"></i><b>8.2.1</b> 条形图</a></li>
<li class="chapter" data-level="8.2.2" data-path="dv-plot.html"><a href="dv-plot.html#plot-hist"><i class="fa fa-check"></i><b>8.2.2</b> 直方图</a></li>
<li class="chapter" data-level="8.2.3" data-path="dv-plot.html"><a href="dv-plot.html#plot-density"><i class="fa fa-check"></i><b>8.2.3</b> 密度图</a></li>
<li class="chapter" data-level="8.2.4" data-path="dv-plot.html"><a href="dv-plot.html#plot-ecdf"><i class="fa fa-check"></i><b>8.2.4</b> 经验图</a></li>
<li class="chapter" data-level="8.2.5" data-path="dv-plot.html"><a href="dv-plot.html#plot-qqnorm"><i class="fa fa-check"></i><b>8.2.5</b> QQ 图</a></li>
<li class="chapter" data-level="8.2.6" data-path="dv-plot.html"><a href="dv-plot.html#plot-ts"><i class="fa fa-check"></i><b>8.2.6</b> 时序图</a></li>
<li class="chapter" data-level="8.2.7" data-path="dv-plot.html"><a href="dv-plot.html#plot-pie"><i class="fa fa-check"></i><b>8.2.7</b> 饼图</a></li>
<li class="chapter" data-level="8.2.8" data-path="dv-plot.html"><a href="dv-plot.html#plot-stem-leaf"><i class="fa fa-check"></i><b>8.2.8</b> 茎叶图</a></li>
<li class="chapter" data-level="8.2.9" data-path="dv-plot.html"><a href="dv-plot.html#plot-scatter"><i class="fa fa-check"></i><b>8.2.9</b> 散点图</a></li>
<li class="chapter" data-level="8.2.10" data-path="dv-plot.html"><a href="dv-plot.html#base-jitter"><i class="fa fa-check"></i><b>8.2.10</b> 抖动图</a></li>
<li class="chapter" data-level="8.2.11" data-path="dv-plot.html"><a href="dv-plot.html#plot-box"><i class="fa fa-check"></i><b>8.2.11</b> 箱线图</a></li>
<li class="chapter" data-level="8.2.12" data-path="dv-plot.html"><a href="dv-plot.html#error-bars"><i class="fa fa-check"></i><b>8.2.12</b> 残差图</a></li>
<li class="chapter" data-level="8.2.13" data-path="dv-plot.html"><a href="dv-plot.html#plot-violin"><i class="fa fa-check"></i><b>8.2.13</b> 提琴图</a></li>
<li class="chapter" data-level="8.2.14" data-path="dv-plot.html"><a href="dv-plot.html#plot-contour"><i class="fa fa-check"></i><b>8.2.14</b> 轮廓图</a></li>
<li class="chapter" data-level="8.2.15" data-path="dv-plot.html"><a href="dv-plot.html#plot-line"><i class="fa fa-check"></i><b>8.2.15</b> 折线图</a></li>
<li class="chapter" data-level="8.2.16" data-path="dv-plot.html"><a href="dv-plot.html#function"><i class="fa fa-check"></i><b>8.2.16</b> 函数图</a></li>
<li class="chapter" data-level="8.2.17" data-path="dv-plot.html"><a href="dv-plot.html#plot-mosaic"><i class="fa fa-check"></i><b>8.2.17</b> 马赛克图</a></li>
<li class="chapter" data-level="8.2.18" data-path="dv-plot.html"><a href="dv-plot.html#plot-dotchart"><i class="fa fa-check"></i><b>8.2.18</b> 克利夫兰点图</a></li>
<li class="chapter" data-level="8.2.19" data-path="dv-plot.html"><a href="dv-plot.html#plot-matrix"><i class="fa fa-check"></i><b>8.2.19</b> 矩阵图</a></li>
<li class="chapter" data-level="8.2.20" data-path="dv-plot.html"><a href="dv-plot.html#plot-radar"><i class="fa fa-check"></i><b>8.2.20</b> 雷达图</a></li>
<li class="chapter" data-level="8.2.21" data-path="dv-plot.html"><a href="dv-plot.html#plot-rose"><i class="fa fa-check"></i><b>8.2.21</b> 玫瑰图</a></li>
<li class="chapter" data-level="8.2.22" data-path="dv-plot.html"><a href="dv-plot.html#plot-map"><i class="fa fa-check"></i><b>8.2.22</b> 地形图</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="dv-plot.html"><a href="dv-plot.html#plot-session-info"><i class="fa fa-check"></i><b>8.3</b> 运行环境</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html"><i class="fa fa-check"></i><b>9</b> 数据可视化</a><ul>
<li class="chapter" data-level="9.1" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#intro-ggplot2"><i class="fa fa-check"></i><b>9.1</b> 基础语法</a><ul>
<li class="chapter" data-level="9.1.1" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-layer"><i class="fa fa-check"></i><b>9.1.1</b> 图层</a></li>
<li class="chapter" data-level="9.1.2" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-theme"><i class="fa fa-check"></i><b>9.1.2</b> 主题</a></li>
<li class="chapter" data-level="9.1.3" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-color"><i class="fa fa-check"></i><b>9.1.3</b> 配色</a></li>
<li class="chapter" data-level="9.1.4" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-scale"><i class="fa fa-check"></i><b>9.1.4</b> 刻度</a></li>
<li class="chapter" data-level="9.1.5" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-annotate"><i class="fa fa-check"></i><b>9.1.5</b> 注释</a></li>
<li class="chapter" data-level="9.1.6" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-legend"><i class="fa fa-check"></i><b>9.1.6</b> 图例</a></li>
<li class="chapter" data-level="9.1.7" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-grid"><i class="fa fa-check"></i><b>9.1.7</b> 组合</a></li>
<li class="chapter" data-level="9.1.8" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-coord"><i class="fa fa-check"></i><b>9.1.8</b> 坐标系</a></li>
<li class="chapter" data-level="9.1.9" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-axes"><i class="fa fa-check"></i><b>9.1.9</b> 坐标轴</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-gallary"><i class="fa fa-check"></i><b>9.2</b> 统计图形</a><ul>
<li class="chapter" data-level="9.2.1" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-scatter"><i class="fa fa-check"></i><b>9.2.1</b> 散点图</a></li>
<li class="chapter" data-level="9.2.2" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-boxplot"><i class="fa fa-check"></i><b>9.2.2</b> 箱线图</a></li>
<li class="chapter" data-level="9.2.3" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-barplot"><i class="fa fa-check"></i><b>9.2.3</b> 条形图</a></li>
<li class="chapter" data-level="9.2.4" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-line"><i class="fa fa-check"></i><b>9.2.4</b> 折线图</a></li>
<li class="chapter" data-level="9.2.5" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-histogram"><i class="fa fa-check"></i><b>9.2.5</b> 直方图</a></li>
<li class="chapter" data-level="9.2.6" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-violin"><i class="fa fa-check"></i><b>9.2.6</b> 提琴图</a></li>
<li class="chapter" data-level="9.2.7" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-jitter"><i class="fa fa-check"></i><b>9.2.7</b> 抖动图</a></li>
<li class="chapter" data-level="9.2.8" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-ridge"><i class="fa fa-check"></i><b>9.2.8</b> 密度图</a></li>
<li class="chapter" data-level="9.2.9" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-rose"><i class="fa fa-check"></i><b>9.2.9</b> 玫瑰图</a></li>
<li class="chapter" data-level="9.2.10" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-wordcloud"><i class="fa fa-check"></i><b>9.2.10</b> 词云图</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="dv-ggplot2.html"><a href="dv-ggplot2.html#ggplot2-session-info"><i class="fa fa-check"></i><b>9.3</b> 运行环境</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="dv-plotly.html"><a href="dv-plotly.html"><i class="fa fa-check"></i><b>10</b> 交互式图形</a><ul>
<li class="chapter" data-level="10.1" data-path="dv-plotly.html"><a href="dv-plotly.html#plotly"><i class="fa fa-check"></i><b>10.1</b> plotly</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html"><i class="fa fa-check"></i><b>11</b> 时空可视化</a><ul>
<li class="chapter" data-level="11.1" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#map"><i class="fa fa-check"></i><b>11.1</b> 地图</a><ul>
<li class="chapter" data-level="11.1.1" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#project-orientation"><i class="fa fa-check"></i><b>11.1.1</b> 投影和观察方位</a></li>
<li class="chapter" data-level="11.1.2" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#USA-crime-rates"><i class="fa fa-check"></i><b>11.1.2</b> 美国各州犯罪率</a></li>
<li class="chapter" data-level="11.1.3" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#fiji-earthquake-map"><i class="fa fa-check"></i><b>11.1.3</b> 斐济地震带</a></li>
<li class="chapter" data-level="11.1.4" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#USA-unemployment-ratio"><i class="fa fa-check"></i><b>11.1.4</b> 美国各城镇失业率</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#spatial-op"><i class="fa fa-check"></i><b>11.2</b> 空间数据对象</a><ul>
<li class="chapter" data-level="11.2.1" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#ggplot2-sp"><i class="fa fa-check"></i><b>11.2.1</b> sp</a></li>
<li class="chapter" data-level="11.2.2" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#ggplot2-raster"><i class="fa fa-check"></i><b>11.2.2</b> raster</a></li>
<li class="chapter" data-level="11.2.3" data-path="dv-spatio-temporal.html"><a href="dv-spatio-temporal.html#ggplot2-sf"><i class="fa fa-check"></i><b>11.2.3</b> sf</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="cs-cran-network.html"><a href="cs-cran-network.html"><i class="fa fa-check"></i><b>12</b> 案例：分析 CRAN</a><ul>
<li class="chapter" data-level="12.1" data-path="cs-cran-network.html"><a href="cs-cran-network.html#R-Core-Team"><i class="fa fa-check"></i><b>12.1</b> R 核心团队</a></li>
<li class="chapter" data-level="12.2" data-path="cs-cran-network.html"><a href="cs-cran-network.html#Top-Creators"><i class="fa fa-check"></i><b>12.2</b> 高产的开发者</a></li>
<li class="chapter" data-level="12.3" data-path="cs-cran-network.html"><a href="cs-cran-network.html#R-Package-Developers"><i class="fa fa-check"></i><b>12.3</b> 社区开发者</a></li>
<li class="chapter" data-level="12.4" data-path="cs-cran-network.html"><a href="cs-cran-network.html#first-commit"><i class="fa fa-check"></i><b>12.4</b> 首次贡献 R 包</a></li>
<li class="chapter" data-level="12.5" data-path="cs-cran-network.html"><a href="cs-cran-network.html#Contribution-Network"><i class="fa fa-check"></i><b>12.5</b> 贡献关系网络</a></li>
<li class="chapter" data-level="12.6" data-path="cs-cran-network.html"><a href="cs-cran-network.html#CRAN-Update-Packages"><i class="fa fa-check"></i><b>12.6</b> 更新知多少</a></li>
<li class="chapter" data-level="12.7" data-path="cs-cran-network.html"><a href="cs-cran-network.html#Package-Licenses"><i class="fa fa-check"></i><b>12.7</b> 使用许可证</a></li>
<li class="chapter" data-level="12.8" data-path="cs-cran-network.html"><a href="cs-cran-network.html#r-"><i class="fa fa-check"></i><b>12.8</b> R 包增长速度</a></li>
<li class="chapter" data-level="12.9" data-path="cs-cran-network.html"><a href="cs-cran-network.html#Choose-Package"><i class="fa fa-check"></i><b>12.9</b> 选择 R 包</a></li>
<li class="chapter" data-level="12.10" data-path="cs-cran-network.html"><a href="cs-cran-network.html#cs-network-session-info"><i class="fa fa-check"></i><b>12.10</b> 运行环境</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="99-references.html"><a href="99-references.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://r-graphics.netlify.com/" target="blank">Published with netlify</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">数据可视化与R语言</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ggplot2-visualization" class="section level1">
<h1><span class="header-section-number">第 9 章</span> 数据可视化</h1>
<p>David Robinson 给出为何使用 ggplot2<a href="99-references.html#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a> 当然也有 Jeff Leek 指出在某些重要场合不适合 ggplot2<a href="99-references.html#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a> 并且给出强有力的 <a href="http://motioninsocial.com/tufte/">证据</a>，其实不管怎么样，适合自己的才是好的。也不枉费 Garrick Aden-Buie 花费 160 页幻灯片逐步分解介绍 <a href="https://pkg.garrickadenbuie.com/gentle-ggplot2">优雅的ggplot2</a>，<a href="https://malco.io/">Malcolm Barrett</a> 也介绍了 <a href="https://malco.io/slides/hs_ggplot2">ggplot2 基础用法</a>，还有 Selva Prabhakaran 精心总结给出了 50 个 ggplot2 数据可视化的 <a href="https://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html">例子</a> 以及 Victor Perrier 为小白用 ggplot2 操碎了心地开发 RStudio 插件 <a href="https://github.com/dreamRs/esquisse">esquisse</a> 包，Claus O. Wilke 教你一步步创建出版级的图形 <a href="https://github.com/clauswilke/practical_ggplot2" class="uri">https://github.com/clauswilke/practical_ggplot2</a>。</p>
<p>GGplot2 是十分方便的统计作图工具，相比 Base R，为了一张出版级的图形，不需要去调整每个参数，实现快速出图。集成了很多其它统计计算的 R 包，支持丰富的统计分析和计算功能，如回归、平滑等，实现了作图和模型的无缝连接。比如图<a href="dv-ggplot2.html#fig:awesome-ggplot2">9.1</a>，使用 loess 局部多项式平滑得到数据的趋势，不仅仅是散点图，代码量也非常少。</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="dv-ggplot2.html#cb428-1"></a><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span></span>
<span id="cb428-2"><a href="dv-ggplot2.html#cb428-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> class)) <span class="op">+</span></span>
<span id="cb428-3"><a href="dv-ggplot2.html#cb428-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">TRUE</span>, <span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>) <span class="op">+</span></span>
<span id="cb428-4"><a href="dv-ggplot2.html#cb428-4"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb428-5"><a href="dv-ggplot2.html#cb428-5"></a>    <span class="dt">title =</span> <span class="st">&quot;Fuel efficiency generally decreases with engine size&quot;</span>,</span>
<span id="cb428-6"><a href="dv-ggplot2.html#cb428-6"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;Two seaters (sports cars) are an exception because of their light weight&quot;</span>,</span>
<span id="cb428-7"><a href="dv-ggplot2.html#cb428-7"></a>    <span class="dt">caption =</span> <span class="st">&quot;Data from fueleconomy.gov&quot;</span></span>
<span id="cb428-8"><a href="dv-ggplot2.html#cb428-8"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:awesome-ggplot2"></span>
<img src="dv-ggplot2_files/figure-html/awesome-ggplot2-1.png" alt="简洁美观" width="70%" />
<p class="caption">
图 9.1: 简洁美观
</p>
</div>
<p>故事源于一幅图片，我不记得第一次见到这幅图是什么时候了，只因多次在多个场合中见过，所以留下了深刻的印象，后来才知道它出自于一篇博文 — <a href="https://medium.com/airbnb-engineering/using-r-packages-and-education-to-scale-data-science-at-airbnb">Using R packages and education to scale Data Science at Airbnb</a>，作者 Ricardo Bion 还在其 Github 上传了相关代码<a href="99-references.html#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a>。除此之外还有几篇重要的参考资料：</p>
<ol style="list-style-type: decimal">
<li>Pablo Barberá 的 <a href="https://github.com/pablobarbera/Rdataviz">Data Visualization with R and ggplot2</a></li>
<li>Kieran Healy 的新书 <a href="https://kieranhealy.org/publications/dataviz/">Data Visualization: A Practical Introduction</a></li>
<li>Matt Leonawicz 的新作 <a href="https://github.com/leonawicz/mapmate">mapmate</a>, 可以去其主页欣赏系列作品<a href="99-references.html#fn30" class="footnote-ref" id="fnref30"><sup>30</sup></a></li>
<li><a href="https://github.com/rfordatascience/tidytuesday">tidytuesday 可视化挑战官方项目</a> 还有 <a href="https://github.com/abichat/tidytuesday">tidytuesday</a></li>
<li><a href="https://github.com/IndrajeetPatil/ggstatsplot">ggstatsplot</a> 可视化统计检验、模型的结果</li>
<li><a href="https://github.com/kassambara/ggpubr">ggpubr</a> 制作出版级统计图形</li>
</ol>
<div id="intro-ggplot2" class="section level2">
<h2><span class="header-section-number">9.1</span> 基础语法</h2>
<p>以数据集 airquality 为例介绍GGplot2 图层、主题、配色、坐标、尺度、注释和组合等</p>
<div id="ggplot2-layer" class="section level3">
<h3><span class="header-section-number">9.1.1</span> 图层</h3>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="dv-ggplot2.html#cb429-1"></a><span class="kw">ls</span>(<span class="st">&quot;package:ggplot2&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;^geom_&quot;</span>)</span>
<span id="cb429-2"><a href="dv-ggplot2.html#cb429-2"></a><span class="co">#&gt;  [1] &quot;geom_abline&quot;     &quot;geom_area&quot;       &quot;geom_bar&quot;       </span></span>
<span id="cb429-3"><a href="dv-ggplot2.html#cb429-3"></a><span class="co">#&gt;  [4] &quot;geom_bin2d&quot;      &quot;geom_blank&quot;      &quot;geom_boxplot&quot;   </span></span>
<span id="cb429-4"><a href="dv-ggplot2.html#cb429-4"></a><span class="co">#&gt;  [7] &quot;geom_col&quot;        &quot;geom_contour&quot;    &quot;geom_count&quot;     </span></span>
<span id="cb429-5"><a href="dv-ggplot2.html#cb429-5"></a><span class="co">#&gt; [10] &quot;geom_crossbar&quot;   &quot;geom_curve&quot;      &quot;geom_density&quot;   </span></span>
<span id="cb429-6"><a href="dv-ggplot2.html#cb429-6"></a><span class="co">#&gt; [13] &quot;geom_density_2d&quot; &quot;geom_density2d&quot;  &quot;geom_dotplot&quot;   </span></span>
<span id="cb429-7"><a href="dv-ggplot2.html#cb429-7"></a><span class="co">#&gt; [16] &quot;geom_errorbar&quot;   &quot;geom_errorbarh&quot;  &quot;geom_freqpoly&quot;  </span></span>
<span id="cb429-8"><a href="dv-ggplot2.html#cb429-8"></a><span class="co">#&gt; [19] &quot;geom_hex&quot;        &quot;geom_histogram&quot;  &quot;geom_hline&quot;     </span></span>
<span id="cb429-9"><a href="dv-ggplot2.html#cb429-9"></a><span class="co">#&gt; [22] &quot;geom_jitter&quot;     &quot;geom_label&quot;      &quot;geom_line&quot;      </span></span>
<span id="cb429-10"><a href="dv-ggplot2.html#cb429-10"></a><span class="co">#&gt; [25] &quot;geom_linerange&quot;  &quot;geom_map&quot;        &quot;geom_path&quot;      </span></span>
<span id="cb429-11"><a href="dv-ggplot2.html#cb429-11"></a><span class="co">#&gt; [28] &quot;geom_point&quot;      &quot;geom_pointrange&quot; &quot;geom_polygon&quot;   </span></span>
<span id="cb429-12"><a href="dv-ggplot2.html#cb429-12"></a><span class="co">#&gt; [31] &quot;geom_qq&quot;         &quot;geom_qq_line&quot;    &quot;geom_quantile&quot;  </span></span>
<span id="cb429-13"><a href="dv-ggplot2.html#cb429-13"></a><span class="co">#&gt; [34] &quot;geom_raster&quot;     &quot;geom_rect&quot;       &quot;geom_ribbon&quot;    </span></span>
<span id="cb429-14"><a href="dv-ggplot2.html#cb429-14"></a><span class="co">#&gt; [37] &quot;geom_rug&quot;        &quot;geom_segment&quot;    &quot;geom_sf&quot;        </span></span>
<span id="cb429-15"><a href="dv-ggplot2.html#cb429-15"></a><span class="co">#&gt; [40] &quot;geom_sf_label&quot;   &quot;geom_sf_text&quot;    &quot;geom_smooth&quot;    </span></span>
<span id="cb429-16"><a href="dv-ggplot2.html#cb429-16"></a><span class="co">#&gt; [43] &quot;geom_spoke&quot;      &quot;geom_step&quot;       &quot;geom_text&quot;      </span></span>
<span id="cb429-17"><a href="dv-ggplot2.html#cb429-17"></a><span class="co">#&gt; [46] &quot;geom_tile&quot;       &quot;geom_violin&quot;     &quot;geom_vline&quot;</span></span></code></pre></div>
<p>生成一个散点图</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="dv-ggplot2.html#cb430-1"></a><span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span>
<span id="cb430-2"><a href="dv-ggplot2.html#cb430-2"></a><span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span></span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-theme" class="section level3">
<h3><span class="header-section-number">9.1.2</span> 主题</h3>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="dv-ggplot2.html#cb431-1"></a><span class="kw">ls</span>(<span class="st">&quot;package:ggplot2&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;^theme_&quot;</span>)</span>
<span id="cb431-2"><a href="dv-ggplot2.html#cb431-2"></a><span class="co">#&gt;  [1] &quot;theme_bw&quot;       &quot;theme_classic&quot;  &quot;theme_dark&quot;     &quot;theme_get&quot;     </span></span>
<span id="cb431-3"><a href="dv-ggplot2.html#cb431-3"></a><span class="co">#&gt;  [5] &quot;theme_gray&quot;     &quot;theme_grey&quot;     &quot;theme_light&quot;    &quot;theme_linedraw&quot;</span></span>
<span id="cb431-4"><a href="dv-ggplot2.html#cb431-4"></a><span class="co">#&gt;  [9] &quot;theme_minimal&quot;  &quot;theme_replace&quot;  &quot;theme_set&quot;      &quot;theme_test&quot;    </span></span>
<span id="cb431-5"><a href="dv-ggplot2.html#cb431-5"></a><span class="co">#&gt; [13] &quot;theme_update&quot;   &quot;theme_void&quot;</span></span></code></pre></div>
<p>这里只展示 <code>theme_bw()</code> <code>theme_void()</code> <code>theme_minimal()</code> 和 <code>theme_void()</code> 等四个常见主题，更多主题参考 <a href="https://github.com/nanxstats/ggsci">ggsci</a>、<a href="https://github.com/jrnold/ggthemes">ggthemes</a> 、<a href="https://github.com/hrbrmstr/hrbrthemes">hrbrthemes</a> 和 <a href="https://github.com/cttobin/ggthemr">ggthemr</a> 包</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="dv-ggplot2.html#cb432-1"></a><span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span>
<span id="cb432-2"><a href="dv-ggplot2.html#cb432-2"></a><span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span></span>
<span id="cb432-3"><a href="dv-ggplot2.html#cb432-3"></a><span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_void</span>()</span>
<span id="cb432-4"><a href="dv-ggplot2.html#cb432-4"></a><span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span></span>
<span id="cb432-5"><a href="dv-ggplot2.html#cb432-5"></a><span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>()</span>
<span id="cb432-6"><a href="dv-ggplot2.html#cb432-6"></a><span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span></span>
<span id="cb432-7"><a href="dv-ggplot2.html#cb432-7"></a><span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_void</span>()</span>
<span id="cb432-8"><a href="dv-ggplot2.html#cb432-8"></a><span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span></span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;" /><img src="dv-ggplot2_files/figure-html/unnamed-chunk-6-2.png" width="70%" style="display: block; margin: auto;" /><img src="dv-ggplot2_files/figure-html/unnamed-chunk-6-3.png" width="70%" style="display: block; margin: auto;" /><img src="dv-ggplot2_files/figure-html/unnamed-chunk-6-4.png" width="70%" style="display: block; margin: auto;" /></p>
<p>除主题之外，还有一类提供一整套统一的风格样式来绘制各种统计图形，如 <a href="https://github.com/kassambara/ggpubr">ggpubr</a> 和 <a href="https://github.com/bbc/bbplot">bbplot</a></p>
</div>
<div id="ggplot2-color" class="section level3">
<h3><span class="header-section-number">9.1.3</span> 配色</h3>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="dv-ggplot2.html#cb433-1"></a><span class="kw">ls</span>(<span class="st">&quot;package:ggplot2&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;^scale_(color|fill)_&quot;</span>)</span>
<span id="cb433-2"><a href="dv-ggplot2.html#cb433-2"></a><span class="co">#&gt;  [1] &quot;scale_color_brewer&quot;     &quot;scale_color_continuous&quot;</span></span>
<span id="cb433-3"><a href="dv-ggplot2.html#cb433-3"></a><span class="co">#&gt;  [3] &quot;scale_color_discrete&quot;   &quot;scale_color_distiller&quot; </span></span>
<span id="cb433-4"><a href="dv-ggplot2.html#cb433-4"></a><span class="co">#&gt;  [5] &quot;scale_color_gradient&quot;   &quot;scale_color_gradient2&quot; </span></span>
<span id="cb433-5"><a href="dv-ggplot2.html#cb433-5"></a><span class="co">#&gt;  [7] &quot;scale_color_gradientn&quot;  &quot;scale_color_grey&quot;      </span></span>
<span id="cb433-6"><a href="dv-ggplot2.html#cb433-6"></a><span class="co">#&gt;  [9] &quot;scale_color_hue&quot;        &quot;scale_color_identity&quot;  </span></span>
<span id="cb433-7"><a href="dv-ggplot2.html#cb433-7"></a><span class="co">#&gt; [11] &quot;scale_color_manual&quot;     &quot;scale_color_viridis_c&quot; </span></span>
<span id="cb433-8"><a href="dv-ggplot2.html#cb433-8"></a><span class="co">#&gt; [13] &quot;scale_color_viridis_d&quot;  &quot;scale_fill_brewer&quot;     </span></span>
<span id="cb433-9"><a href="dv-ggplot2.html#cb433-9"></a><span class="co">#&gt; [15] &quot;scale_fill_continuous&quot;  &quot;scale_fill_date&quot;       </span></span>
<span id="cb433-10"><a href="dv-ggplot2.html#cb433-10"></a><span class="co">#&gt; [17] &quot;scale_fill_datetime&quot;    &quot;scale_fill_discrete&quot;   </span></span>
<span id="cb433-11"><a href="dv-ggplot2.html#cb433-11"></a><span class="co">#&gt; [19] &quot;scale_fill_distiller&quot;   &quot;scale_fill_gradient&quot;   </span></span>
<span id="cb433-12"><a href="dv-ggplot2.html#cb433-12"></a><span class="co">#&gt; [21] &quot;scale_fill_gradient2&quot;   &quot;scale_fill_gradientn&quot;  </span></span>
<span id="cb433-13"><a href="dv-ggplot2.html#cb433-13"></a><span class="co">#&gt; [23] &quot;scale_fill_grey&quot;        &quot;scale_fill_hue&quot;        </span></span>
<span id="cb433-14"><a href="dv-ggplot2.html#cb433-14"></a><span class="co">#&gt; [25] &quot;scale_fill_identity&quot;    &quot;scale_fill_manual&quot;     </span></span>
<span id="cb433-15"><a href="dv-ggplot2.html#cb433-15"></a><span class="co">#&gt; [27] &quot;scale_fill_ordinal&quot;     &quot;scale_fill_viridis_c&quot;  </span></span>
<span id="cb433-16"><a href="dv-ggplot2.html#cb433-16"></a><span class="co">#&gt; [29] &quot;scale_fill_viridis_d&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="dv-ggplot2.html#cb434-1"></a><span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone, <span class="dt">color =</span> <span class="kw">as.factor</span>(Month))) <span class="op">+</span></span>
<span id="cb434-2"><a href="dv-ggplot2.html#cb434-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb434-3"><a href="dv-ggplot2.html#cb434-3"></a><span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone, <span class="dt">color =</span> <span class="kw">as.ordered</span>(Month))) <span class="op">+</span></span>
<span id="cb434-4"><a href="dv-ggplot2.html#cb434-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;" /><img src="dv-ggplot2_files/figure-html/unnamed-chunk-8-2.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-scale" class="section level3">
<h3><span class="header-section-number">9.1.4</span> 刻度</h3>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="dv-ggplot2.html#cb435-1"></a><span class="kw">ls</span>(<span class="st">&quot;package:ggplot2&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;^scale_(x|y)_&quot;</span>)</span>
<span id="cb435-2"><a href="dv-ggplot2.html#cb435-2"></a><span class="co">#&gt;  [1] &quot;scale_x_continuous&quot; &quot;scale_x_date&quot;       &quot;scale_x_datetime&quot;  </span></span>
<span id="cb435-3"><a href="dv-ggplot2.html#cb435-3"></a><span class="co">#&gt;  [4] &quot;scale_x_discrete&quot;   &quot;scale_x_log10&quot;      &quot;scale_x_reverse&quot;   </span></span>
<span id="cb435-4"><a href="dv-ggplot2.html#cb435-4"></a><span class="co">#&gt;  [7] &quot;scale_x_sqrt&quot;       &quot;scale_x_time&quot;       &quot;scale_y_continuous&quot;</span></span>
<span id="cb435-5"><a href="dv-ggplot2.html#cb435-5"></a><span class="co">#&gt; [10] &quot;scale_y_date&quot;       &quot;scale_y_datetime&quot;   &quot;scale_y_discrete&quot;  </span></span>
<span id="cb435-6"><a href="dv-ggplot2.html#cb435-6"></a><span class="co">#&gt; [13] &quot;scale_y_log10&quot;      &quot;scale_y_reverse&quot;    &quot;scale_y_sqrt&quot;      </span></span>
<span id="cb435-7"><a href="dv-ggplot2.html#cb435-7"></a><span class="co">#&gt; [16] &quot;scale_y_time&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="dv-ggplot2.html#cb436-1"></a><span class="kw">range</span>(airquality<span class="op">$</span>Temp, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb436-2"><a href="dv-ggplot2.html#cb436-2"></a><span class="co">#&gt; [1] 56 97</span></span>
<span id="cb436-3"><a href="dv-ggplot2.html#cb436-3"></a><span class="kw">range</span>(airquality<span class="op">$</span>Ozone, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb436-4"><a href="dv-ggplot2.html#cb436-4"></a><span class="co">#&gt; [1]   1 168</span></span>
<span id="cb436-5"><a href="dv-ggplot2.html#cb436-5"></a><span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb436-6"><a href="dv-ggplot2.html#cb436-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span></span>
<span id="cb436-7"><a href="dv-ggplot2.html#cb436-7"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">5</span>)) <span class="op">+</span></span>
<span id="cb436-8"><a href="dv-ggplot2.html#cb436-8"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="dv">20</span>))</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-10-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-annotate" class="section level3">
<h3><span class="header-section-number">9.1.5</span> 注释</h3>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="dv-ggplot2.html#cb437-1"></a><span class="kw">ls</span>(<span class="st">&quot;package:ggplot2&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;^annotation_&quot;</span>)</span>
<span id="cb437-2"><a href="dv-ggplot2.html#cb437-2"></a><span class="co">#&gt; [1] &quot;annotation_custom&quot;   &quot;annotation_logticks&quot; &quot;annotation_map&quot;     </span></span>
<span id="cb437-3"><a href="dv-ggplot2.html#cb437-3"></a><span class="co">#&gt; [4] &quot;annotation_raster&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="dv-ggplot2.html#cb438-1"></a><span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb438-2"><a href="dv-ggplot2.html#cb438-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-12-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="dv-ggplot2.html#cb439-1"></a><span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb439-2"><a href="dv-ggplot2.html#cb439-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span></span>
<span id="cb439-3"><a href="dv-ggplot2.html#cb439-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw">substitute</span>(<span class="kw">paste</span>(d <span class="op">*</span></span>
<span id="cb439-4"><a href="dv-ggplot2.html#cb439-4"></a><span class="st">    </span><span class="kw">bolditalic</span>(x)[<span class="kw">italic</span>(t)] <span class="op">==</span><span class="st"> </span>alpha <span class="op">*</span><span class="st"> </span>(theta <span class="op">-</span><span class="st"> </span><span class="kw">bolditalic</span>(x)[<span class="kw">italic</span>(t)]) <span class="op">*</span></span>
<span id="cb439-5"><a href="dv-ggplot2.html#cb439-5"></a><span class="st">    </span>d <span class="op">*</span><span class="st"> </span><span class="kw">italic</span>(t) <span class="op">+</span><span class="st"> </span>lambda <span class="op">*</span><span class="st"> </span>d <span class="op">*</span><span class="st"> </span><span class="kw">italic</span>(B)[<span class="kw">italic</span>(t)]), <span class="kw">list</span>(<span class="dt">lambda =</span> <span class="dv">4</span>)))</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/math-expr-r-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-legend" class="section level3">
<h3><span class="header-section-number">9.1.6</span> 图例</h3>
<p>二维的图例 <a href="https://github.com/slu-openGIS/biscale">biscale</a> 和 <a href="https://github.com/clauswilke/multiscales">multiscales</a> 和 <a href="https://github.com/eliocamp/ggnewscale">ggnewscale</a></p>
</div>
<div id="ggplot2-grid" class="section level3">
<h3><span class="header-section-number">9.1.7</span> 组合</h3>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="dv-ggplot2.html#cb440-1"></a><span class="kw">ggplot</span>(airquality) <span class="op">+</span><span class="st"> </span></span>
<span id="cb440-2"><a href="dv-ggplot2.html#cb440-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb440-3"><a href="dv-ggplot2.html#cb440-3"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span><span class="kw">as.ordered</span>(Month))</span>
<span id="cb440-4"><a href="dv-ggplot2.html#cb440-4"></a><span class="kw">ggplot</span>(airquality) <span class="op">+</span><span class="st"> </span></span>
<span id="cb440-5"><a href="dv-ggplot2.html#cb440-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb440-6"><a href="dv-ggplot2.html#cb440-6"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span><span class="kw">as.ordered</span>(Month), <span class="dt">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-13-1.png" width="70%" style="display: block; margin: auto;" /><img src="dv-ggplot2_files/figure-html/unnamed-chunk-13-2.png" width="70%" style="display: block; margin: auto;" /></p>
<p><a href="https://github.com/wilkelab/cowplot">cowplot</a> 是以作者 <a href="https://wilkelab.org/">Claus O. Wilke</a> 命名的，用来组合 ggplot 对象画图，类似的组合图形的功能包还有 <a href="https://baptiste.github.io/">baptiste auguié</a> 开发的 <a href="https://CRAN.R-project.org/package=gridExtra">gridExtra</a> 和 <a href="https://github.com/baptiste/egg">egg</a>， <a href="https://www.data-imaginist.com/">Thomas Lin Pedersen</a> 开发的 <a href="https://github.com/thomasp85/patchwork">patchwork</a></p>
<p><a href="https://deanattali.com/">Dean Attali</a> 开发的 <a href="https://github.com/daattali/ggExtra">ggExtra</a> 可以在图的边界添加密度估计曲线，直方图等</p>
</div>
<div id="ggplot2-coord" class="section level3">
<h3><span class="header-section-number">9.1.8</span> 坐标系</h3>
<p>极坐标，直角坐标</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="dv-ggplot2.html#cb441-1"></a><span class="kw">ls</span>(<span class="st">&quot;package:ggplot2&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;^coord_&quot;</span>)</span>
<span id="cb441-2"><a href="dv-ggplot2.html#cb441-2"></a><span class="co">#&gt;  [1] &quot;coord_cartesian&quot; &quot;coord_equal&quot;     &quot;coord_fixed&quot;    </span></span>
<span id="cb441-3"><a href="dv-ggplot2.html#cb441-3"></a><span class="co">#&gt;  [4] &quot;coord_flip&quot;      &quot;coord_map&quot;       &quot;coord_munch&quot;    </span></span>
<span id="cb441-4"><a href="dv-ggplot2.html#cb441-4"></a><span class="co">#&gt;  [7] &quot;coord_polar&quot;     &quot;coord_quickmap&quot;  &quot;coord_sf&quot;       </span></span>
<span id="cb441-5"><a href="dv-ggplot2.html#cb441-5"></a><span class="co">#&gt; [10] &quot;coord_trans&quot;</span></span></code></pre></div>
</div>
<div id="ggplot2-axes" class="section level3">
<h3><span class="header-section-number">9.1.9</span> 坐标轴</h3>
<p>坐标轴标签位置、大小、字体</p>
</div>
</div>
<div id="ggplot2-gallary" class="section level2">
<h2><span class="header-section-number">9.2</span> 统计图形</h2>
<div id="ggplot2-scatter" class="section level3">
<h3><span class="header-section-number">9.2.1</span> 散点图</h3>
<p>下面以 diamonds 数据集为例展示 ggplot2 的绘图过程，首先加载 diamonds 数据集，查看数据集的内容</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="dv-ggplot2.html#cb442-1"></a><span class="kw">data</span>(diamonds)</span>
<span id="cb442-2"><a href="dv-ggplot2.html#cb442-2"></a><span class="kw">str</span>(diamonds)</span>
<span id="cb442-3"><a href="dv-ggplot2.html#cb442-3"></a><span class="co">#&gt; Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    53940 obs. of  10 variables:</span></span>
<span id="cb442-4"><a href="dv-ggplot2.html#cb442-4"></a><span class="co">#&gt;  $ carat  : num  0.23 0.21 0.23 0.29 0.31 0.24 0.24 0.26 0.22 0.23 ...</span></span>
<span id="cb442-5"><a href="dv-ggplot2.html#cb442-5"></a><span class="co">#&gt;  $ cut    : Ord.factor w/ 5 levels &quot;Fair&quot;&lt;&quot;Good&quot;&lt;..: 5 4 2 4 2 3 3 3 1 3 ..</span></span>
<span id="cb442-6"><a href="dv-ggplot2.html#cb442-6"></a><span class="co">#&gt;  $ color  : Ord.factor w/ 7 levels &quot;D&quot;&lt;&quot;E&quot;&lt;&quot;F&quot;&lt;&quot;G&quot;&lt;..: 2 2 2 6 7 7 6 5 2 ..</span></span>
<span id="cb442-7"><a href="dv-ggplot2.html#cb442-7"></a><span class="co">#&gt;  $ clarity: Ord.factor w/ 8 levels &quot;I1&quot;&lt;&quot;SI2&quot;&lt;&quot;SI1&quot;&lt;..: 2 3 5 4 2 6 7 3 4..</span></span>
<span id="cb442-8"><a href="dv-ggplot2.html#cb442-8"></a><span class="co">#&gt;  $ depth  : num  61.5 59.8 56.9 62.4 63.3 62.8 62.3 61.9 65.1 59.4 ...</span></span>
<span id="cb442-9"><a href="dv-ggplot2.html#cb442-9"></a><span class="co">#&gt;  $ table  : num  55 61 65 58 58 57 57 55 61 61 ...</span></span>
<span id="cb442-10"><a href="dv-ggplot2.html#cb442-10"></a><span class="co">#&gt;  $ price  : int  326 326 327 334 335 336 336 337 337 338 ...</span></span>
<span id="cb442-11"><a href="dv-ggplot2.html#cb442-11"></a><span class="co">#&gt;  $ x      : num  3.95 3.89 4.05 4.2 4.34 3.94 3.95 4.07 3.87 4 ...</span></span>
<span id="cb442-12"><a href="dv-ggplot2.html#cb442-12"></a><span class="co">#&gt;  $ y      : num  3.98 3.84 4.07 4.23 4.35 3.96 3.98 4.11 3.78 4.05 ...</span></span>
<span id="cb442-13"><a href="dv-ggplot2.html#cb442-13"></a><span class="co">#&gt;  $ z      : num  2.43 2.31 2.31 2.63 2.75 2.48 2.47 2.53 2.49 2.39 ...</span></span></code></pre></div>
<p>数值型变量 carat 作为 x 轴</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="dv-ggplot2.html#cb443-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat))</span>
<span id="cb443-2"><a href="dv-ggplot2.html#cb443-2"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price))</span>
<span id="cb443-3"><a href="dv-ggplot2.html#cb443-3"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">color =</span> cut))</span>
<span id="cb443-4"><a href="dv-ggplot2.html#cb443-4"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat), <span class="dt">color =</span> <span class="st">&quot;steelblue&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:diamonds-axis"></span>
<img src="dv-ggplot2_files/figure-html/diamonds-axis-1.png" alt="绘图过程" width="35%" /><img src="dv-ggplot2_files/figure-html/diamonds-axis-2.png" alt="绘图过程" width="35%" /><img src="dv-ggplot2_files/figure-html/diamonds-axis-3.png" alt="绘图过程" width="35%" /><img src="dv-ggplot2_files/figure-html/diamonds-axis-4.png" alt="绘图过程" width="35%" />
<p class="caption">
图 9.2: 绘图过程
</p>
</div>
<p>图 <a href="dv-ggplot2.html#fig:diamonds-axis">9.2</a> 的基础上添加数据图层</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="dv-ggplot2.html#cb444-1"></a>sub_diamonds &lt;-<span class="st"> </span>diamonds[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(diamonds), <span class="dv">1000</span>), ]</span>
<span id="cb444-2"><a href="dv-ggplot2.html#cb444-2"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span></span>
<span id="cb444-3"><a href="dv-ggplot2.html#cb444-3"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:scatter"></span>
<img src="dv-ggplot2_files/figure-html/scatter-1.png" alt="添加数据图层" width="70%" />
<p class="caption">
图 9.3: 添加数据图层
</p>
</div>
<p>给散点图<a href="dv-ggplot2.html#fig:scatter">9.3</a>上色</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="dv-ggplot2.html#cb445-1"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span></span>
<span id="cb445-2"><a href="dv-ggplot2.html#cb445-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;steelblue&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:scatter-color-1"></span>
<img src="dv-ggplot2_files/figure-html/scatter-color-1-1.png" alt="散点图配色" width="70%" />
<p class="caption">
图 9.4: 散点图配色
</p>
</div>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="dv-ggplot2.html#cb446-1"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span></span>
<span id="cb446-2"><a href="dv-ggplot2.html#cb446-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="op">+</span></span>
<span id="cb446-3"><a href="dv-ggplot2.html#cb446-3"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb446-4"><a href="dv-ggplot2.html#cb446-4"></a>    <span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">unit_format</span>(<span class="dt">unit =</span> <span class="st">&quot;k&quot;</span>, <span class="dt">scale =</span> <span class="fl">1e-3</span>),</span>
<span id="cb446-5"><a href="dv-ggplot2.html#cb446-5"></a>    <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">20000</span>, <span class="dv">4000</span>)</span>
<span id="cb446-6"><a href="dv-ggplot2.html#cb446-6"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:scatter-scale-1"></span>
<img src="dv-ggplot2_files/figure-html/scatter-scale-1-1.png" alt="格式化坐标轴刻度标签" width="70%" />
<p class="caption">
图 9.5: 格式化坐标轴刻度标签
</p>
</div>
<p>让另一变量 cut 作为颜色分类指标</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="dv-ggplot2.html#cb447-1"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">color =</span> cut)) <span class="op">+</span></span>
<span id="cb447-2"><a href="dv-ggplot2.html#cb447-2"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:scatter-color-2"></span>
<img src="dv-ggplot2_files/figure-html/scatter-color-2-1.png" alt="分类散点图" width="70%" />
<p class="caption">
图 9.6: 分类散点图
</p>
</div>
<p>当然还有一种类似的表示就是分组，默认情况下，ggplot2将所有观测点视为一组，以分类变量 cut 来分组</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="dv-ggplot2.html#cb448-1"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">group =</span> cut)) <span class="op">+</span></span>
<span id="cb448-2"><a href="dv-ggplot2.html#cb448-2"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:scatter-group"></span>
<img src="dv-ggplot2_files/figure-html/scatter-group-1.png" alt="分组" width="70%" />
<p class="caption">
图 9.7: 分组
</p>
</div>
<p>在图<a href="dv-ggplot2.html#fig:scatter-group">9.7</a> 上没有体现出来分组的意思，下面以 cut 分组线性回归为例</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="dv-ggplot2.html#cb449-1"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span></span>
<span id="cb449-2"><a href="dv-ggplot2.html#cb449-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb449-3"><a href="dv-ggplot2.html#cb449-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span>
<span id="cb449-4"><a href="dv-ggplot2.html#cb449-4"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">group =</span> cut)) <span class="op">+</span></span>
<span id="cb449-5"><a href="dv-ggplot2.html#cb449-5"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb449-6"><a href="dv-ggplot2.html#cb449-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:group-lm"></span>
<img src="dv-ggplot2_files/figure-html/group-lm-1.png" alt="分组线性回归" width="70%" /><img src="dv-ggplot2_files/figure-html/group-lm-2.png" alt="分组线性回归" width="70%" />
<p class="caption">
图 9.8: 分组线性回归
</p>
</div>
<p>我们当然可以选择更加合适的拟合方式，如局部多项式平滑 <code>loess</code> 但是该方法不太适用观测值比较多的情况，因为它会占用比较多的内存，建议使用广义可加模型作平滑拟合</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="dv-ggplot2.html#cb450-1"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">group =</span> cut)) <span class="op">+</span></span>
<span id="cb450-2"><a href="dv-ggplot2.html#cb450-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb450-3"><a href="dv-ggplot2.html#cb450-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-16"></span>
<img src="dv-ggplot2_files/figure-html/unnamed-chunk-16-1.png" alt="局部多项式平滑" width="70%" />
<p class="caption">
图 9.9: 局部多项式平滑
</p>
</div>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="dv-ggplot2.html#cb451-1"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">group =</span> cut)) <span class="op">+</span></span>
<span id="cb451-2"><a href="dv-ggplot2.html#cb451-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb451-3"><a href="dv-ggplot2.html#cb451-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;gam&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(x, <span class="dt">bs =</span> <span class="st">&quot;cs&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:group-gam"></span>
<img src="dv-ggplot2_files/figure-html/group-gam-1.png" alt="数据分组应用广义可加平滑" width="70%" />
<p class="caption">
图 9.10: 数据分组应用广义可加平滑
</p>
</div>
<div class="sidebar">
<p><a href="https://github.com/sinhrks/ggfortify">ggfortify</a> 包支持更多的统计分析结果的可视化</p>
</div>
<p>为了更好地区分开组别，我们在图<a href="dv-ggplot2.html#fig:group-gam">9.10</a>的基础上分面或者配色</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="dv-ggplot2.html#cb452-1"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">group =</span> cut)) <span class="op">+</span></span>
<span id="cb452-2"><a href="dv-ggplot2.html#cb452-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb452-3"><a href="dv-ggplot2.html#cb452-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;gam&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(x, <span class="dt">bs =</span> <span class="st">&quot;cs&quot;</span>)) <span class="op">+</span></span>
<span id="cb452-4"><a href="dv-ggplot2.html#cb452-4"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</span>
<span id="cb452-5"><a href="dv-ggplot2.html#cb452-5"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">group =</span> cut, <span class="dt">color =</span> cut)) <span class="op">+</span></span>
<span id="cb452-6"><a href="dv-ggplot2.html#cb452-6"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb452-7"><a href="dv-ggplot2.html#cb452-7"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;gam&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(x, <span class="dt">bs =</span> <span class="st">&quot;cs&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:group-facet"></span>
<img src="dv-ggplot2_files/figure-html/group-facet-1.png" alt="分组分面" width="70%" /><img src="dv-ggplot2_files/figure-html/group-facet-2.png" alt="分组配色" width="70%" />
<p class="caption">
图 9.11: 分组配色
</p>
</div>
<p>在分类散点图的另一种表示方法就是分面图，以 cut 变量作为分面的依据</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="dv-ggplot2.html#cb453-1"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span></span>
<span id="cb453-2"><a href="dv-ggplot2.html#cb453-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb453-3"><a href="dv-ggplot2.html#cb453-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:scatter-facet"></span>
<img src="dv-ggplot2_files/figure-html/scatter-facet-1.png" alt="分面散点图" width="70%" />
<p class="caption">
图 9.12: 分面散点图
</p>
</div>
<p>给图 <a href="dv-ggplot2.html#fig:scatter-facet">9.12</a> 上色</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="dv-ggplot2.html#cb454-1"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span></span>
<span id="cb454-2"><a href="dv-ggplot2.html#cb454-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="op">+</span></span>
<span id="cb454-3"><a href="dv-ggplot2.html#cb454-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:scatter-facet-color-1"></span>
<img src="dv-ggplot2_files/figure-html/scatter-facet-color-1-1.png" alt="给分面散点图上色" width="70%" />
<p class="caption">
图 9.13: 给分面散点图上色
</p>
</div>
<p>在图<a href="dv-ggplot2.html#fig:scatter-facet-color-1">9.13</a>的基础上，给不同的类上不同的颜色</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="dv-ggplot2.html#cb455-1"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">color =</span> cut)) <span class="op">+</span></span>
<span id="cb455-2"><a href="dv-ggplot2.html#cb455-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb455-3"><a href="dv-ggplot2.html#cb455-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:scatter-facet-color-2"></span>
<img src="dv-ggplot2_files/figure-html/scatter-facet-color-2-1.png" alt="给不同的类上不同的颜色" width="70%" />
<p class="caption">
图 9.14: 给不同的类上不同的颜色
</p>
</div>
<p>去掉图例，此时图例属于冗余信息了</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="dv-ggplot2.html#cb456-1"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">color =</span> cut)) <span class="op">+</span></span>
<span id="cb456-2"><a href="dv-ggplot2.html#cb456-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb456-3"><a href="dv-ggplot2.html#cb456-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:scatter-facet-color-3"></span>
<img src="dv-ggplot2_files/figure-html/scatter-facet-color-3-1.png" alt="去掉图例" width="70%" />
<p class="caption">
图 9.15: 去掉图例
</p>
</div>
<p>四块土地，所施肥料不同，肥力大小顺序 4 &lt; 2 &lt; 3 &lt; 1 小麦产量随肥力的变化</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="dv-ggplot2.html#cb457-1"></a><span class="kw">data</span>(Wheat2, <span class="dt">package =</span> <span class="st">&quot;nlme&quot;</span>) <span class="co"># Wheat Yield Trials</span></span>
<span id="cb457-2"><a href="dv-ggplot2.html#cb457-2"></a><span class="kw">library</span>(colorspace)</span>
<span id="cb457-3"><a href="dv-ggplot2.html#cb457-3"></a><span class="kw">ggplot</span>(Wheat2, <span class="kw">aes</span>(longitude, latitude)) <span class="op">+</span></span>
<span id="cb457-4"><a href="dv-ggplot2.html#cb457-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">size =</span> yield, <span class="dt">colour =</span> Block)) <span class="op">+</span></span>
<span id="cb457-5"><a href="dv-ggplot2.html#cb457-5"></a><span class="st">  </span><span class="kw">scale_color_discrete_sequential</span>(<span class="dt">palette =</span> <span class="st">&quot;Viridis&quot;</span>) <span class="op">+</span></span>
<span id="cb457-6"><a href="dv-ggplot2.html#cb457-6"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">5</span>)) <span class="op">+</span></span>
<span id="cb457-7"><a href="dv-ggplot2.html#cb457-7"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">10</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-17"></span>
<img src="dv-ggplot2_files/figure-html/unnamed-chunk-17-1.png" alt="多个图例" width="70%" />
<p class="caption">
图 9.16: 多个图例
</p>
</div>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="dv-ggplot2.html#cb458-1"></a><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x =</span> hp, <span class="dt">y =</span> mpg, <span class="dt">color =</span> <span class="kw">factor</span>(am))) <span class="op">+</span></span>
<span id="cb458-2"><a href="dv-ggplot2.html#cb458-2"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:category-ggplot"></span>
<img src="dv-ggplot2_files/figure-html/category-ggplot-1.png" alt="分类散点图" width="70%" />
<p class="caption">
图 9.17: 分类散点图
</p>
</div>
<p>图层、分组、分面和散点图介绍完了，接下来就是其它统计图形，如箱线图，小提琴图和条形图</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="dv-ggplot2.html#cb459-1"></a>dat &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(<span class="kw">rep</span>(<span class="dv">1948</span> <span class="op">+</span><span class="st"> </span><span class="kw">seq</span>(<span class="dv">12</span>), <span class="dt">each =</span> <span class="dv">12</span>), <span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dv">12</span>), <span class="dv">12</span>), AirPassengers))</span>
<span id="cb459-2"><a href="dv-ggplot2.html#cb459-2"></a><span class="kw">colnames</span>(dat) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;passengers&quot;</span>)</span>
<span id="cb459-3"><a href="dv-ggplot2.html#cb459-3"></a></span>
<span id="cb459-4"><a href="dv-ggplot2.html#cb459-4"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(year), <span class="dt">y =</span> <span class="kw">as.factor</span>(month))) <span class="op">+</span></span>
<span id="cb459-5"><a href="dv-ggplot2.html#cb459-5"></a><span class="st">  </span><span class="kw">stat_sum</span>(<span class="kw">aes</span>(<span class="dt">size =</span> passengers), <span class="dt">colour =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span></span>
<span id="cb459-6"><a href="dv-ggplot2.html#cb459-6"></a><span class="st">  </span><span class="kw">scale_size</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">100</span>, <span class="dv">650</span>, <span class="dv">50</span>)) <span class="op">+</span></span>
<span id="cb459-7"><a href="dv-ggplot2.html#cb459-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Month&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;Passengers&quot;</span>) <span class="op">+</span></span>
<span id="cb459-8"><a href="dv-ggplot2.html#cb459-8"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-18"></span>
<img src="dv-ggplot2_files/figure-html/unnamed-chunk-18-1.png" alt="1948年至1960年航班乘客人数变化" width="70%" />
<p class="caption">
图 8.14: 1948年至1960年航班乘客人数变化
</p>
</div>
</div>
<div id="ggplot2-boxplot" class="section level3">
<h3><span class="header-section-number">9.2.2</span> 箱线图</h3>
<p>以 PlantGrowth 数据集为例展示箱线图，在两组不同实验条件下，植物生长的情况，纵坐标是干燥植物的量，横坐标表示不同的实验条件。这是非常典型的适合用箱线图来表达数据的场合，Y 轴对应数值型变量，X 轴对应分类变量，在 R 语言中，分类变量的类型是 factor</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="dv-ggplot2.html#cb460-1"></a><span class="kw">data</span>(<span class="st">&quot;PlantGrowth&quot;</span>)</span>
<span id="cb460-2"><a href="dv-ggplot2.html#cb460-2"></a><span class="kw">str</span>(PlantGrowth)</span>
<span id="cb460-3"><a href="dv-ggplot2.html#cb460-3"></a><span class="co">#&gt; &#39;data.frame&#39;:    30 obs. of  2 variables:</span></span>
<span id="cb460-4"><a href="dv-ggplot2.html#cb460-4"></a><span class="co">#&gt;  $ weight: num  4.17 5.58 5.18 6.11 4.5 4.61 5.17 4.53 5.33 5.14 ...</span></span>
<span id="cb460-5"><a href="dv-ggplot2.html#cb460-5"></a><span class="co">#&gt;  $ group : Factor w/ 3 levels &quot;ctrl&quot;,&quot;trt1&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</span></span></code></pre></div>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="dv-ggplot2.html#cb461-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> PlantGrowth, <span class="kw">aes</span>(<span class="dt">x =</span> group, <span class="dt">y =</span> weight)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/PlantGrowth-boxplot-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>PlantGrowth 数据量比较小，此时比较适合采用抖动散点图，抖动是为了避免点之间相互重叠，为了增加不同类别之间的识别性，我们可以用不同的点的形状或者不同的颜色来表示类别</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="dv-ggplot2.html#cb462-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> PlantGrowth, <span class="kw">aes</span>(<span class="dt">x =</span> group, <span class="dt">y =</span> weight, <span class="dt">shape =</span> group)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</span>
<span id="cb462-2"><a href="dv-ggplot2.html#cb462-2"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> PlantGrowth, <span class="kw">aes</span>(<span class="dt">x =</span> group, <span class="dt">y =</span> weight, <span class="dt">color =</span> group)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/PlantGrowth-jitter-1.png" width="70%" style="display: block; margin: auto;" /><img src="dv-ggplot2_files/figure-html/PlantGrowth-jitter-2.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="base">
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="dv-ggplot2.html#cb463-1"></a><span class="kw">boxplot</span>(weight <span class="op">~</span><span class="st"> </span>group,</span>
<span id="cb463-2"><a href="dv-ggplot2.html#cb463-2"></a>  <span class="dt">data =</span> PlantGrowth,</span>
<span id="cb463-3"><a href="dv-ggplot2.html#cb463-3"></a>  <span class="dt">ylab =</span> <span class="st">&quot;Dried weight of plants&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;lightgray&quot;</span>,</span>
<span id="cb463-4"><a href="dv-ggplot2.html#cb463-4"></a>  <span class="dt">notch =</span> <span class="ot">FALSE</span>, <span class="dt">varwidth =</span> <span class="ot">TRUE</span></span>
<span id="cb463-5"><a href="dv-ggplot2.html#cb463-5"></a>)</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-20-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>以钻石切割质量 cut 为分面依据，以钻石颜色类别 color 为 x 轴，钻石价格为 y 轴，绘制箱线图<a href="dv-ggplot2.html#fig:boxplot-facet-color">9.18</a></p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="dv-ggplot2.html#cb464-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> price, <span class="dt">color =</span> cut)) <span class="op">+</span></span>
<span id="cb464-2"><a href="dv-ggplot2.html#cb464-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb464-3"><a href="dv-ggplot2.html#cb464-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:boxplot-facet-color"></span>
<img src="dv-ggplot2_files/figure-html/boxplot-facet-color-1.png" alt="箱线图" width="70%" />
<p class="caption">
图 9.18: 箱线图
</p>
</div>
<p>我们当然还可以添加钻石的纯净度 clarity 作为分面依据，那么箱线图可以为图 <a href="dv-ggplot2.html#fig:boxplot-facet-color-clarity-1">9.19</a></p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="dv-ggplot2.html#cb465-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> price, <span class="dt">color =</span> cut)) <span class="op">+</span></span>
<span id="cb465-2"><a href="dv-ggplot2.html#cb465-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb465-3"><a href="dv-ggplot2.html#cb465-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(clarity <span class="op">~</span><span class="st"> </span>cut)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:boxplot-facet-color-clarity-1"></span>
<img src="dv-ggplot2_files/figure-html/boxplot-facet-color-clarity-1-1.png" alt="复合分面箱线图" width="70%" />
<p class="caption">
图 9.19: 复合分面箱线图
</p>
</div>
<p>经过观察，我们发现水平分类过多，考虑用切割质量 cut 替换钻石颜色 color 绘图，但是由于分类过细，图信息展示不简练，反而不好，如图 <a href="dv-ggplot2.html#fig:boxplot-facet-color-clarity-2">9.20</a></p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="dv-ggplot2.html#cb466-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price, <span class="dt">color =</span> cut)) <span class="op">+</span></span>
<span id="cb466-2"><a href="dv-ggplot2.html#cb466-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb466-3"><a href="dv-ggplot2.html#cb466-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(clarity <span class="op">~</span><span class="st"> </span>color)</span>
<span id="cb466-4"><a href="dv-ggplot2.html#cb466-4"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price, <span class="dt">color =</span> color)) <span class="op">+</span></span>
<span id="cb466-5"><a href="dv-ggplot2.html#cb466-5"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb466-6"><a href="dv-ggplot2.html#cb466-6"></a><span class="st">  </span><span class="kw">facet_grid</span>(clarity <span class="op">~</span><span class="st"> </span>color)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:boxplot-facet-color-clarity-2"></span>
<img src="dv-ggplot2_files/figure-html/boxplot-facet-color-clarity-2-1.png" alt="切割质量cut上色" width="70%" /><img src="dv-ggplot2_files/figure-html/boxplot-facet-color-clarity-2-2.png" alt="钻石颜色配色" width="70%" />
<p class="caption">
图 9.20: 钻石颜色配色
</p>
</div>
</div>
<div id="ggplot2-barplot" class="section level3">
<h3><span class="header-section-number">9.2.3</span> 条形图</h3>
<p>条形图特别适合分类变量的展示，我们这里展示钻石切割质量 cut 不同等级的数量，当然我们可以直接展示各类的数目，在图层 <code>geom_bar</code> 中指定 <code>stat="identity"</code></p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="dv-ggplot2.html#cb467-1"></a><span class="co"># 需要映射数据框的两个变量，相当于自己先计算了每类的数量</span></span>
<span id="cb467-2"><a href="dv-ggplot2.html#cb467-2"></a><span class="kw">with</span>(diamonds, <span class="kw">table</span>(cut))</span>
<span id="cb467-3"><a href="dv-ggplot2.html#cb467-3"></a><span class="co">#&gt; cut</span></span>
<span id="cb467-4"><a href="dv-ggplot2.html#cb467-4"></a><span class="co">#&gt;      Fair      Good Very Good   Premium     Ideal </span></span>
<span id="cb467-5"><a href="dv-ggplot2.html#cb467-5"></a><span class="co">#&gt;      1610      4906     12082     13791     21551</span></span>
<span id="cb467-6"><a href="dv-ggplot2.html#cb467-6"></a>cut_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">table</span>(diamonds<span class="op">$</span>cut))</span>
<span id="cb467-7"><a href="dv-ggplot2.html#cb467-7"></a><span class="kw">ggplot</span>(cut_df, <span class="kw">aes</span>(<span class="dt">x =</span> Var1, <span class="dt">y =</span> Freq)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-21-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="dv-ggplot2.html#cb468-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:diamonds-barplot-1"></span>
<img src="dv-ggplot2_files/figure-html/diamonds-barplot-1-1.png" alt="频数条形图" width="70%" />
<p class="caption">
图 9.21: 频数条形图
</p>
</div>
<p>还有另外三种表示方法</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="dv-ggplot2.html#cb469-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;count&quot;</span>)</span>
<span id="cb469-2"><a href="dv-ggplot2.html#cb469-2"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> ..count..)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</span>
<span id="cb469-3"><a href="dv-ggplot2.html#cb469-3"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> <span class="kw">stat</span>(count))) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-22-1.png" width="70%" style="display: block; margin: auto;" /><img src="dv-ggplot2_files/figure-html/unnamed-chunk-22-2.png" width="70%" style="display: block; margin: auto;" /><img src="dv-ggplot2_files/figure-html/unnamed-chunk-22-3.png" width="70%" style="display: block; margin: auto;" /></p>
<p>我们还可以在图 <a href="dv-ggplot2.html#fig:diamonds-barplot-1">9.21</a> 的基础上再添加一个分类变量钻石的纯净度 clarity，形成堆积条形图</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="dv-ggplot2.html#cb470-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:diamonds-barplot-2"></span>
<img src="dv-ggplot2_files/figure-html/diamonds-barplot-2-1.png" alt="堆积条形图" width="70%" />
<p class="caption">
图 9.22: 堆积条形图
</p>
</div>
<p>再添加一个分类变量钻石颜色 color 比较好的做法是分面</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="dv-ggplot2.html#cb471-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">fill =</span> clarity)) <span class="op">+</span></span>
<span id="cb471-2"><a href="dv-ggplot2.html#cb471-2"></a><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></span>
<span id="cb471-3"><a href="dv-ggplot2.html#cb471-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:diamonds-barplot-3"></span>
<img src="dv-ggplot2_files/figure-html/diamonds-barplot-3-1.png" alt="分面堆积条形图" width="70%" />
<p class="caption">
图 9.23: 分面堆积条形图
</p>
</div>
<p>实际上，绘制图<a href="dv-ggplot2.html#fig:diamonds-barplot-3">9.23</a>包含了对分类变量的分组计数过程，如下</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="dv-ggplot2.html#cb472-1"></a><span class="kw">with</span>(diamonds, <span class="kw">table</span>(cut, color))</span>
<span id="cb472-2"><a href="dv-ggplot2.html#cb472-2"></a><span class="co">#&gt;            color</span></span>
<span id="cb472-3"><a href="dv-ggplot2.html#cb472-3"></a><span class="co">#&gt; cut            D    E    F    G    H    I    J</span></span>
<span id="cb472-4"><a href="dv-ggplot2.html#cb472-4"></a><span class="co">#&gt;   Fair       163  224  312  314  303  175  119</span></span>
<span id="cb472-5"><a href="dv-ggplot2.html#cb472-5"></a><span class="co">#&gt;   Good       662  933  909  871  702  522  307</span></span>
<span id="cb472-6"><a href="dv-ggplot2.html#cb472-6"></a><span class="co">#&gt;   Very Good 1513 2400 2164 2299 1824 1204  678</span></span>
<span id="cb472-7"><a href="dv-ggplot2.html#cb472-7"></a><span class="co">#&gt;   Premium   1603 2337 2331 2924 2360 1428  808</span></span>
<span id="cb472-8"><a href="dv-ggplot2.html#cb472-8"></a><span class="co">#&gt;   Ideal     2834 3903 3826 4884 3115 2093  896</span></span></code></pre></div>
<p>还有一种堆积的方法是按比例，而不是按数量，如图<a href="dv-ggplot2.html#fig:diamonds-barplot-4">9.24</a></p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="dv-ggplot2.html#cb473-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">fill =</span> clarity)) <span class="op">+</span></span>
<span id="cb473-2"><a href="dv-ggplot2.html#cb473-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span></span>
<span id="cb473-3"><a href="dv-ggplot2.html#cb473-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:diamonds-barplot-4"></span>
<img src="dv-ggplot2_files/figure-html/diamonds-barplot-4-1.png" alt="比例堆积条形图" width="70%" />
<p class="caption">
图 9.24: 比例堆积条形图
</p>
</div>
<p>接下来就是复合条形图</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="dv-ggplot2.html#cb474-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">fill =</span> clarity)) <span class="op">+</span></span>
<span id="cb474-2"><a href="dv-ggplot2.html#cb474-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:diamonds-barplot-5"></span>
<img src="dv-ggplot2_files/figure-html/diamonds-barplot-5-1.png" alt="复合条形图" width="70%" />
<p class="caption">
图 9.25: 复合条形图
</p>
</div>
<p>再添加一个分类变量，就是需要分面大法了，图 <a href="dv-ggplot2.html#fig:diamonds-barplot-5">9.25</a> 展示了三个分类变量，其实我们还可以再添加一个分类变量用作分面的列依据</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="dv-ggplot2.html#cb475-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">fill =</span> clarity)) <span class="op">+</span></span>
<span id="cb475-2"><a href="dv-ggplot2.html#cb475-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb475-3"><a href="dv-ggplot2.html#cb475-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="dt">rows =</span> <span class="kw">vars</span>(cut))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:diamonds-barplot-6"></span>
<img src="dv-ggplot2_files/figure-html/diamonds-barplot-6-1.png" alt="分面复合条形图" width="70%" />
<p class="caption">
图 9.26: 分面复合条形图
</p>
</div>
<p>图 <a href="dv-ggplot2.html#fig:diamonds-barplot-6">9.26</a> 展示的数据如下</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="dv-ggplot2.html#cb476-1"></a><span class="kw">with</span>(diamonds, <span class="kw">table</span>(color, clarity, cut))</span>
<span id="cb476-2"><a href="dv-ggplot2.html#cb476-2"></a><span class="co">#&gt; , , cut = Fair</span></span>
<span id="cb476-3"><a href="dv-ggplot2.html#cb476-3"></a><span class="co">#&gt; </span></span>
<span id="cb476-4"><a href="dv-ggplot2.html#cb476-4"></a><span class="co">#&gt;      clarity</span></span>
<span id="cb476-5"><a href="dv-ggplot2.html#cb476-5"></a><span class="co">#&gt; color   I1  SI2  SI1  VS2  VS1 VVS2 VVS1   IF</span></span>
<span id="cb476-6"><a href="dv-ggplot2.html#cb476-6"></a><span class="co">#&gt;     D    4   56   58   25    5    9    3    3</span></span>
<span id="cb476-7"><a href="dv-ggplot2.html#cb476-7"></a><span class="co">#&gt;     E    9   78   65   42   14   13    3    0</span></span>
<span id="cb476-8"><a href="dv-ggplot2.html#cb476-8"></a><span class="co">#&gt;     F   35   89   83   53   33   10    5    4</span></span>
<span id="cb476-9"><a href="dv-ggplot2.html#cb476-9"></a><span class="co">#&gt;     G   53   80   69   45   45   17    3    2</span></span>
<span id="cb476-10"><a href="dv-ggplot2.html#cb476-10"></a><span class="co">#&gt;     H   52   91   75   41   32   11    1    0</span></span>
<span id="cb476-11"><a href="dv-ggplot2.html#cb476-11"></a><span class="co">#&gt;     I   34   45   30   32   25    8    1    0</span></span>
<span id="cb476-12"><a href="dv-ggplot2.html#cb476-12"></a><span class="co">#&gt;     J   23   27   28   23   16    1    1    0</span></span>
<span id="cb476-13"><a href="dv-ggplot2.html#cb476-13"></a><span class="co">#&gt; </span></span>
<span id="cb476-14"><a href="dv-ggplot2.html#cb476-14"></a><span class="co">#&gt; , , cut = Good</span></span>
<span id="cb476-15"><a href="dv-ggplot2.html#cb476-15"></a><span class="co">#&gt; </span></span>
<span id="cb476-16"><a href="dv-ggplot2.html#cb476-16"></a><span class="co">#&gt;      clarity</span></span>
<span id="cb476-17"><a href="dv-ggplot2.html#cb476-17"></a><span class="co">#&gt; color   I1  SI2  SI1  VS2  VS1 VVS2 VVS1   IF</span></span>
<span id="cb476-18"><a href="dv-ggplot2.html#cb476-18"></a><span class="co">#&gt;     D    8  223  237  104   43   25   13    9</span></span>
<span id="cb476-19"><a href="dv-ggplot2.html#cb476-19"></a><span class="co">#&gt;     E   23  202  355  160   89   52   43    9</span></span>
<span id="cb476-20"><a href="dv-ggplot2.html#cb476-20"></a><span class="co">#&gt;     F   19  201  273  184  132   50   35   15</span></span>
<span id="cb476-21"><a href="dv-ggplot2.html#cb476-21"></a><span class="co">#&gt;     G   19  163  207  192  152   75   41   22</span></span>
<span id="cb476-22"><a href="dv-ggplot2.html#cb476-22"></a><span class="co">#&gt;     H   14  158  235  138   77   45   31    4</span></span>
<span id="cb476-23"><a href="dv-ggplot2.html#cb476-23"></a><span class="co">#&gt;     I    9   81  165  110  103   26   22    6</span></span>
<span id="cb476-24"><a href="dv-ggplot2.html#cb476-24"></a><span class="co">#&gt;     J    4   53   88   90   52   13    1    6</span></span>
<span id="cb476-25"><a href="dv-ggplot2.html#cb476-25"></a><span class="co">#&gt; </span></span>
<span id="cb476-26"><a href="dv-ggplot2.html#cb476-26"></a><span class="co">#&gt; , , cut = Very Good</span></span>
<span id="cb476-27"><a href="dv-ggplot2.html#cb476-27"></a><span class="co">#&gt; </span></span>
<span id="cb476-28"><a href="dv-ggplot2.html#cb476-28"></a><span class="co">#&gt;      clarity</span></span>
<span id="cb476-29"><a href="dv-ggplot2.html#cb476-29"></a><span class="co">#&gt; color   I1  SI2  SI1  VS2  VS1 VVS2 VVS1   IF</span></span>
<span id="cb476-30"><a href="dv-ggplot2.html#cb476-30"></a><span class="co">#&gt;     D    5  314  494  309  175  141   52   23</span></span>
<span id="cb476-31"><a href="dv-ggplot2.html#cb476-31"></a><span class="co">#&gt;     E   22  445  626  503  293  298  170   43</span></span>
<span id="cb476-32"><a href="dv-ggplot2.html#cb476-32"></a><span class="co">#&gt;     F   13  343  559  466  293  249  174   67</span></span>
<span id="cb476-33"><a href="dv-ggplot2.html#cb476-33"></a><span class="co">#&gt;     G   16  327  474  479  432  302  190   79</span></span>
<span id="cb476-34"><a href="dv-ggplot2.html#cb476-34"></a><span class="co">#&gt;     H   12  343  547  376  257  145  115   29</span></span>
<span id="cb476-35"><a href="dv-ggplot2.html#cb476-35"></a><span class="co">#&gt;     I    8  200  358  274  205   71   69   19</span></span>
<span id="cb476-36"><a href="dv-ggplot2.html#cb476-36"></a><span class="co">#&gt;     J    8  128  182  184  120   29   19    8</span></span>
<span id="cb476-37"><a href="dv-ggplot2.html#cb476-37"></a><span class="co">#&gt; </span></span>
<span id="cb476-38"><a href="dv-ggplot2.html#cb476-38"></a><span class="co">#&gt; , , cut = Premium</span></span>
<span id="cb476-39"><a href="dv-ggplot2.html#cb476-39"></a><span class="co">#&gt; </span></span>
<span id="cb476-40"><a href="dv-ggplot2.html#cb476-40"></a><span class="co">#&gt;      clarity</span></span>
<span id="cb476-41"><a href="dv-ggplot2.html#cb476-41"></a><span class="co">#&gt; color   I1  SI2  SI1  VS2  VS1 VVS2 VVS1   IF</span></span>
<span id="cb476-42"><a href="dv-ggplot2.html#cb476-42"></a><span class="co">#&gt;     D   12  421  556  339  131   94   40   10</span></span>
<span id="cb476-43"><a href="dv-ggplot2.html#cb476-43"></a><span class="co">#&gt;     E   30  519  614  629  292  121  105   27</span></span>
<span id="cb476-44"><a href="dv-ggplot2.html#cb476-44"></a><span class="co">#&gt;     F   34  523  608  619  290  146   80   31</span></span>
<span id="cb476-45"><a href="dv-ggplot2.html#cb476-45"></a><span class="co">#&gt;     G   46  492  566  721  566  275  171   87</span></span>
<span id="cb476-46"><a href="dv-ggplot2.html#cb476-46"></a><span class="co">#&gt;     H   46  521  655  532  336  118  112   40</span></span>
<span id="cb476-47"><a href="dv-ggplot2.html#cb476-47"></a><span class="co">#&gt;     I   24  312  367  315  221   82   84   23</span></span>
<span id="cb476-48"><a href="dv-ggplot2.html#cb476-48"></a><span class="co">#&gt;     J   13  161  209  202  153   34   24   12</span></span>
<span id="cb476-49"><a href="dv-ggplot2.html#cb476-49"></a><span class="co">#&gt; </span></span>
<span id="cb476-50"><a href="dv-ggplot2.html#cb476-50"></a><span class="co">#&gt; , , cut = Ideal</span></span>
<span id="cb476-51"><a href="dv-ggplot2.html#cb476-51"></a><span class="co">#&gt; </span></span>
<span id="cb476-52"><a href="dv-ggplot2.html#cb476-52"></a><span class="co">#&gt;      clarity</span></span>
<span id="cb476-53"><a href="dv-ggplot2.html#cb476-53"></a><span class="co">#&gt; color   I1  SI2  SI1  VS2  VS1 VVS2 VVS1   IF</span></span>
<span id="cb476-54"><a href="dv-ggplot2.html#cb476-54"></a><span class="co">#&gt;     D   13  356  738  920  351  284  144   28</span></span>
<span id="cb476-55"><a href="dv-ggplot2.html#cb476-55"></a><span class="co">#&gt;     E   18  469  766 1136  593  507  335   79</span></span>
<span id="cb476-56"><a href="dv-ggplot2.html#cb476-56"></a><span class="co">#&gt;     F   42  453  608  879  616  520  440  268</span></span>
<span id="cb476-57"><a href="dv-ggplot2.html#cb476-57"></a><span class="co">#&gt;     G   16  486  660  910  953  774  594  491</span></span>
<span id="cb476-58"><a href="dv-ggplot2.html#cb476-58"></a><span class="co">#&gt;     H   38  450  763  556  467  289  326  226</span></span>
<span id="cb476-59"><a href="dv-ggplot2.html#cb476-59"></a><span class="co">#&gt;     I   17  274  504  438  408  178  179   95</span></span>
<span id="cb476-60"><a href="dv-ggplot2.html#cb476-60"></a><span class="co">#&gt;     J    2  110  243  232  201   54   29   25</span></span></code></pre></div>
</div>
<div id="ggplot2-line" class="section level3">
<h3><span class="header-section-number">9.2.4</span> 折线图</h3>
<p>时间序列数据的展示，时序图</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="dv-ggplot2.html#cb477-1"></a><span class="kw">ggplot</span>(economics, <span class="kw">aes</span>(date, unemploy)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-25"></span>
<img src="dv-ggplot2_files/figure-html/unnamed-chunk-25-1.png" alt="时序图" width="70%" />
<p class="caption">
图 8.23: 时序图
</p>
</div>
</div>
<div id="ggplot2-histogram" class="section level3">
<h3><span class="header-section-number">9.2.5</span> 直方图</h3>
<p>直方图用来查看连续变量的分布</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="dv-ggplot2.html#cb478-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(price)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">30</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-26"></span>
<img src="dv-ggplot2_files/figure-html/unnamed-chunk-26-1.png" alt="钻石价格的分布" width="70%" />
<p class="caption">
图 8.24: 钻石价格的分布
</p>
</div>
<p>堆积直方图</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="dv-ggplot2.html#cb479-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> price, <span class="dt">fill =</span> cut)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">30</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-27"></span>
<img src="dv-ggplot2_files/figure-html/unnamed-chunk-27-1.png" alt="钻石价格随切割质量的分布" width="70%" />
<p class="caption">
图 9.27: 钻石价格随切割质量的分布
</p>
</div>
<p>基础 R 包与 Ggplot2 包绘制的直方图的对比，Base R 绘图速度快，代码更加稳定，Ggplot2 代码简洁，更美观</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="dv-ggplot2.html#cb480-1"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">2.1</span>, <span class="fl">2.1</span>, <span class="fl">1.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb480-2"><a href="dv-ggplot2.html#cb480-2"></a><span class="kw">plot</span>(<span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">350</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb480-3"><a href="dv-ggplot2.html#cb480-3"></a>  <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">font.main =</span> <span class="dv">1</span>,</span>
<span id="cb480-4"><a href="dv-ggplot2.html#cb480-4"></a>  <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">frame.plot =</span> <span class="ot">FALSE</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>,</span>
<span id="cb480-5"><a href="dv-ggplot2.html#cb480-5"></a>  <span class="co"># xlab = &quot;hp&quot;, ylab = &quot;Frequency&quot;,</span></span>
<span id="cb480-6"><a href="dv-ggplot2.html#cb480-6"></a>  <span class="dt">main =</span> <span class="kw">paste</span>(<span class="st">&quot;Histogram with Base R&quot;</span>, <span class="kw">paste</span>(<span class="kw">rep</span>(<span class="st">&quot; &quot;</span>, <span class="dv">60</span>), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb480-7"><a href="dv-ggplot2.html#cb480-7"></a>)</span>
<span id="cb480-8"><a href="dv-ggplot2.html#cb480-8"></a><span class="kw">axis</span>(</span>
<span id="cb480-9"><a href="dv-ggplot2.html#cb480-9"></a>  <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">at =</span> <span class="kw">seq</span>(<span class="dv">50</span>, <span class="dv">350</span>, <span class="dv">50</span>), <span class="dt">labels =</span> <span class="kw">seq</span>(<span class="dv">50</span>, <span class="dv">350</span>, <span class="dv">50</span>),</span>
<span id="cb480-10"><a href="dv-ggplot2.html#cb480-10"></a>  <span class="dt">tick =</span> <span class="ot">FALSE</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">padj =</span> <span class="dv">0</span>, <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="fl">0.1</span>, <span class="dv">0</span>)</span>
<span id="cb480-11"><a href="dv-ggplot2.html#cb480-11"></a>)</span>
<span id="cb480-12"><a href="dv-ggplot2.html#cb480-12"></a><span class="kw">axis</span>(</span>
<span id="cb480-13"><a href="dv-ggplot2.html#cb480-13"></a>  <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">at =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">2</span>), <span class="dt">labels =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">2</span>),</span>
<span id="cb480-14"><a href="dv-ggplot2.html#cb480-14"></a>  <span class="co"># col = &quot;white&quot;, 坐标轴的颜色</span></span>
<span id="cb480-15"><a href="dv-ggplot2.html#cb480-15"></a>  <span class="co"># col.ticks 刻度线的颜色</span></span>
<span id="cb480-16"><a href="dv-ggplot2.html#cb480-16"></a>  <span class="dt">tick =</span> <span class="ot">FALSE</span>, <span class="co"># 取消刻度线</span></span>
<span id="cb480-17"><a href="dv-ggplot2.html#cb480-17"></a>  <span class="dt">las =</span> <span class="dv">1</span>, <span class="co"># 水平方向</span></span>
<span id="cb480-18"><a href="dv-ggplot2.html#cb480-18"></a>  <span class="dt">hadj =</span> <span class="dv">1</span>, <span class="co"># 右侧对齐</span></span>
<span id="cb480-19"><a href="dv-ggplot2.html#cb480-19"></a>  <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="fl">0.1</span>, <span class="dv">0</span>) <span class="co"># 纵轴边距线设置为 0.1</span></span>
<span id="cb480-20"><a href="dv-ggplot2.html#cb480-20"></a>)</span>
<span id="cb480-21"><a href="dv-ggplot2.html#cb480-21"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">2</span>), <span class="dt">v =</span> <span class="kw">seq</span>(<span class="dv">50</span>, <span class="dv">350</span>, <span class="dv">50</span>), <span class="dt">col =</span> <span class="st">&quot;gray90&quot;</span>, <span class="dt">lty =</span> <span class="st">&quot;solid&quot;</span>)</span>
<span id="cb480-22"><a href="dv-ggplot2.html#cb480-22"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">2</span>), <span class="dt">v =</span> <span class="kw">seq</span>(<span class="dv">75</span>, <span class="dv">325</span>, <span class="dv">50</span>), <span class="dt">col =</span> <span class="st">&quot;gray95&quot;</span>, <span class="dt">lty =</span> <span class="st">&quot;solid&quot;</span>)</span>
<span id="cb480-23"><a href="dv-ggplot2.html#cb480-23"></a><span class="kw">hist</span>(mtcars<span class="op">$</span>hp,</span>
<span id="cb480-24"><a href="dv-ggplot2.html#cb480-24"></a>  <span class="dt">col =</span> <span class="st">&quot;#56B4E9&quot;</span>, <span class="dt">border =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb480-25"><a href="dv-ggplot2.html#cb480-25"></a>  <span class="dt">freq =</span> <span class="ot">TRUE</span>, <span class="dt">add =</span> <span class="ot">TRUE</span></span>
<span id="cb480-26"><a href="dv-ggplot2.html#cb480-26"></a>  <span class="co"># labels = TRUE, axes = TRUE, ylim = c(0, 10.5),</span></span>
<span id="cb480-27"><a href="dv-ggplot2.html#cb480-27"></a>  <span class="co"># xlab = &quot;hp&quot;,main = &quot;Histogram with Base R&quot;</span></span>
<span id="cb480-28"><a href="dv-ggplot2.html#cb480-28"></a>)</span>
<span id="cb480-29"><a href="dv-ggplot2.html#cb480-29"></a><span class="kw">mtext</span>(<span class="st">&quot;hp&quot;</span>, <span class="dv">1</span>, <span class="dt">line =</span> <span class="fl">1.0</span>)</span>
<span id="cb480-30"><a href="dv-ggplot2.html#cb480-30"></a><span class="kw">mtext</span>(<span class="st">&quot;Frequency&quot;</span>, <span class="dv">2</span>, <span class="dt">line =</span> <span class="fl">1.0</span>)</span>
<span id="cb480-31"><a href="dv-ggplot2.html#cb480-31"></a></span>
<span id="cb480-32"><a href="dv-ggplot2.html#cb480-32"></a><span class="kw">ggplot</span>(mtcars) <span class="op">+</span></span>
<span id="cb480-33"><a href="dv-ggplot2.html#cb480-33"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> hp), <span class="dt">fill =</span> <span class="st">&quot;#56B4E9&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">50</span>, <span class="dv">350</span>, <span class="dv">50</span>)) <span class="op">+</span></span>
<span id="cb480-34"><a href="dv-ggplot2.html#cb480-34"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">50</span>, <span class="dv">350</span>, <span class="dv">50</span>)) <span class="op">+</span></span>
<span id="cb480-35"><a href="dv-ggplot2.html#cb480-35"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">2</span>)) <span class="op">+</span></span>
<span id="cb480-36"><a href="dv-ggplot2.html#cb480-36"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;hp&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Frequency&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Histogram with Ggplot2&quot;</span>) <span class="op">+</span></span>
<span id="cb480-37"><a href="dv-ggplot2.html#cb480-37"></a><span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_size =</span> <span class="dv">12</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-28"></span>
<img src="dv-ggplot2_files/figure-html/unnamed-chunk-28-1.png" alt="直方图" width="70%" /><img src="dv-ggplot2_files/figure-html/unnamed-chunk-28-2.png" alt="直方图" width="70%" />
<p class="caption">
图 8.25: 直方图
</p>
</div>
</div>
<div id="ggplot2-violin" class="section level3">
<h3><span class="header-section-number">9.2.6</span> 提琴图</h3>
<p>提琴图</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="dv-ggplot2.html#cb481-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</span>
<span id="cb481-2"><a href="dv-ggplot2.html#cb481-2"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_violin</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:violin"></span>
<img src="dv-ggplot2_files/figure-html/violin-1.png" alt="箱线图" width="70%" /><img src="dv-ggplot2_files/figure-html/violin-2.png" alt="小提琴图" width="70%" />
<p class="caption">
图 9.28: 小提琴图
</p>
</div>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="dv-ggplot2.html#cb482-1"></a><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(class, cty)) <span class="op">+</span></span>
<span id="cb482-2"><a href="dv-ggplot2.html#cb482-2"></a><span class="st">  </span><span class="kw">geom_violin</span>() <span class="op">+</span></span>
<span id="cb482-3"><a href="dv-ggplot2.html#cb482-3"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb482-4"><a href="dv-ggplot2.html#cb482-4"></a>    <span class="dt">title =</span> <span class="st">&quot;Violin plot&quot;</span>,</span>
<span id="cb482-5"><a href="dv-ggplot2.html#cb482-5"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;City Mileage vs Class of vehicle&quot;</span>,</span>
<span id="cb482-6"><a href="dv-ggplot2.html#cb482-6"></a>    <span class="dt">caption =</span> <span class="st">&quot;Source: mpg&quot;</span>,</span>
<span id="cb482-7"><a href="dv-ggplot2.html#cb482-7"></a>    <span class="dt">x =</span> <span class="st">&quot;Class of Vehicle&quot;</span>,</span>
<span id="cb482-8"><a href="dv-ggplot2.html#cb482-8"></a>    <span class="dt">y =</span> <span class="st">&quot;City Mileage&quot;</span></span>
<span id="cb482-9"><a href="dv-ggplot2.html#cb482-9"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:violin-mpg"></span>
<img src="dv-ggplot2_files/figure-html/violin-mpg-1.png" alt="城市里程与车辆类别" width="70%" />
<p class="caption">
图 9.29: 城市里程与车辆类别
</p>
</div>
<p>蜂群图 <a href="https://github.com/eclarke/ggbeeswarm">ggbeeswarm</a> 是分类散点图加箱线图的合体</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="dv-ggplot2.html#cb483-1"></a><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> class, <span class="dt">y =</span> hwy, <span class="dt">color =</span> class)) <span class="op">+</span></span>
<span id="cb483-2"><a href="dv-ggplot2.html#cb483-2"></a><span class="st">  </span>ggbeeswarm<span class="op">::</span><span class="kw">geom_quasirandom</span>()</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-29-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-jitter" class="section level3">
<h3><span class="header-section-number">9.2.7</span> 抖动图</h3>
<p>抖动图适合数据量比较小的情况</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="dv-ggplot2.html#cb484-1"></a><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> class, <span class="dt">y =</span> hwy, <span class="dt">color =</span> class)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-30-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>抖不抖，还是抖一下</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="dv-ggplot2.html#cb485-1"></a><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x =</span> Species, <span class="dt">y =</span> Sepal.Length)) <span class="op">+</span></span>
<span id="cb485-2"><a href="dv-ggplot2.html#cb485-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> Species), <span class="dt">size =</span> <span class="dv">5</span>, <span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">colour =</span> <span class="st">&quot;grey20&quot;</span>) <span class="op">+</span></span>
<span id="cb485-3"><a href="dv-ggplot2.html#cb485-3"></a><span class="st">  </span><span class="co"># geom_boxplot(outlier.colour = NA, fill = NA, colour = &quot;grey20&quot;) +</span></span>
<span id="cb485-4"><a href="dv-ggplot2.html#cb485-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Not Jittered&quot;</span>)</span>
<span id="cb485-5"><a href="dv-ggplot2.html#cb485-5"></a></span>
<span id="cb485-6"><a href="dv-ggplot2.html#cb485-6"></a><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x =</span> Species, <span class="dt">y =</span> Sepal.Length)) <span class="op">+</span></span>
<span id="cb485-7"><a href="dv-ggplot2.html#cb485-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> Species),</span>
<span id="cb485-8"><a href="dv-ggplot2.html#cb485-8"></a>    <span class="dt">size =</span> <span class="dv">5</span>, <span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">colour =</span> <span class="st">&quot;grey20&quot;</span>,</span>
<span id="cb485-9"><a href="dv-ggplot2.html#cb485-9"></a>    <span class="dt">position =</span> <span class="kw">position_jitter</span>(<span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">height =</span> <span class="fl">0.1</span>)</span>
<span id="cb485-10"><a href="dv-ggplot2.html#cb485-10"></a>  ) <span class="op">+</span></span>
<span id="cb485-11"><a href="dv-ggplot2.html#cb485-11"></a><span class="st">  </span><span class="co"># geom_boxplot(outlier.colour = NA, fill = NA, colour = &quot;grey20&quot;) +</span></span>
<span id="cb485-12"><a href="dv-ggplot2.html#cb485-12"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Jittered&quot;</span>)</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-31-1.png" width="70%" style="display: block; margin: auto;" /><img src="dv-ggplot2_files/figure-html/unnamed-chunk-31-2.png" width="70%" style="display: block; margin: auto;" /></p>
<p>在数据量比较大的时候，可以用箱线图、密度图、提琴图</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="dv-ggplot2.html#cb486-1"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-32"></span>
<img src="dv-ggplot2_files/figure-html/unnamed-chunk-32-1.png" alt="抖动图的反例" width="70%" />
<p class="caption">
图 9.30: 抖动图的反例
</p>
</div>
<p>上色和分面都不好使的抖动图，因为区分度变小</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="dv-ggplot2.html#cb487-1"></a><span class="kw">ggplot</span>(sub_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> price, <span class="dt">color =</span> color)) <span class="op">+</span></span>
<span id="cb487-2"><a href="dv-ggplot2.html#cb487-2"></a><span class="st">  </span><span class="kw">geom_jitter</span>() <span class="op">+</span></span>
<span id="cb487-3"><a href="dv-ggplot2.html#cb487-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(clarity <span class="op">~</span><span class="st"> </span>cut)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-33"></span>
<img src="dv-ggplot2_files/figure-html/unnamed-chunk-33-1.png" alt="根据钻石颜色上色" width="70%" />
<p class="caption">
图 8.26: 根据钻石颜色上色
</p>
</div>
<p>箱线图此时不宜分的过细</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="dv-ggplot2.html#cb488-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> price, <span class="dt">color =</span> color)) <span class="op">+</span></span>
<span id="cb488-2"><a href="dv-ggplot2.html#cb488-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb488-3"><a href="dv-ggplot2.html#cb488-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(cut <span class="op">~</span><span class="st"> </span>clarity)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:boxplot-facet-cut-clarity"></span>
<img src="dv-ggplot2_files/figure-html/boxplot-facet-cut-clarity-1.png" alt="箱线图" width="70%" />
<p class="caption">
图 9.31: 箱线图
</p>
</div>
<p>所以这样更好，先按纯净度分面，再对比不同的颜色，钻石价格的差异</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="dv-ggplot2.html#cb489-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> price, <span class="dt">color =</span> color)) <span class="op">+</span></span>
<span id="cb489-2"><a href="dv-ggplot2.html#cb489-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb489-3"><a href="dv-ggplot2.html#cb489-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>clarity)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:boxplot-facet-clarity"></span>
<img src="dv-ggplot2_files/figure-html/boxplot-facet-clarity-1.png" alt="钻石按纯净度分面" width="70%" />
<p class="caption">
图 9.32: 钻石按纯净度分面
</p>
</div>
<p>最好只比较一个维度，不同颜色钻石的价格对比</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="dv-ggplot2.html#cb490-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> price, <span class="dt">color =</span> color)) <span class="op">+</span></span>
<span id="cb490-2"><a href="dv-ggplot2.html#cb490-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:boxplot-color"></span>
<img src="dv-ggplot2_files/figure-html/boxplot-color-1.png" alt="不同颜色钻石的价格比较" width="70%" />
<p class="caption">
图 9.33: 不同颜色钻石的价格比较
</p>
</div>
</div>
<div id="ggplot2-ridge" class="section level3">
<h3><span class="header-section-number">9.2.8</span> 密度图</h3>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="dv-ggplot2.html#cb491-1"></a><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty)) <span class="op">+</span></span>
<span id="cb491-2"><a href="dv-ggplot2.html#cb491-2"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> <span class="kw">factor</span>(cyl)), <span class="dt">alpha =</span> <span class="fl">0.8</span>) <span class="op">+</span></span>
<span id="cb491-3"><a href="dv-ggplot2.html#cb491-3"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb491-4"><a href="dv-ggplot2.html#cb491-4"></a>    <span class="dt">title =</span> <span class="st">&quot;Density plot&quot;</span>,</span>
<span id="cb491-5"><a href="dv-ggplot2.html#cb491-5"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;City Mileage Grouped by Number of cylinders&quot;</span>,</span>
<span id="cb491-6"><a href="dv-ggplot2.html#cb491-6"></a>    <span class="dt">caption =</span> <span class="st">&quot;Source: mpg&quot;</span>,</span>
<span id="cb491-7"><a href="dv-ggplot2.html#cb491-7"></a>    <span class="dt">x =</span> <span class="st">&quot;City Mileage&quot;</span>,</span>
<span id="cb491-8"><a href="dv-ggplot2.html#cb491-8"></a>    <span class="dt">fill =</span> <span class="st">&quot;# Cylinders&quot;</span></span>
<span id="cb491-9"><a href="dv-ggplot2.html#cb491-9"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:mpg-cyl-density"></span>
<img src="dv-ggplot2_files/figure-html/mpg-cyl-density-1.png" alt="按汽缸数分组的城市里程" width="70%" />
<p class="caption">
图 9.34: 按汽缸数分组的城市里程
</p>
</div>
<p>添加透明度，解决遮挡</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="dv-ggplot2.html#cb492-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> price, <span class="dt">fill =</span> cut)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>()</span>
<span id="cb492-2"><a href="dv-ggplot2.html#cb492-2"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> price, <span class="dt">fill =</span> cut)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:density"></span>
<img src="dv-ggplot2_files/figure-html/density-1.png" alt="密度图" width="70%" /><img src="dv-ggplot2_files/figure-html/density-2.png" alt="添加透明度的密度图" width="70%" />
<p class="caption">
图 9.35: 添加透明度的密度图
</p>
</div>
<p>堆积密度图</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="dv-ggplot2.html#cb493-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> price, <span class="dt">fill =</span> cut)) <span class="op">+</span></span>
<span id="cb493-2"><a href="dv-ggplot2.html#cb493-2"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:stack-density"></span>
<img src="dv-ggplot2_files/figure-html/stack-density-1.png" alt="堆积密度图" width="70%" />
<p class="caption">
图 9.36: 堆积密度图
</p>
</div>
<p>条件密度估计</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="dv-ggplot2.html#cb494-1"></a><span class="co"># You can use position=&quot;fill&quot; to produce a conditional density estimate</span></span>
<span id="cb494-2"><a href="dv-ggplot2.html#cb494-2"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(carat, <span class="kw">stat</span>(count), <span class="dt">fill =</span> cut)) <span class="op">+</span></span>
<span id="cb494-3"><a href="dv-ggplot2.html#cb494-3"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-34"></span>
<img src="dv-ggplot2_files/figure-html/unnamed-chunk-34-1.png" alt="条件密度估计图" width="70%" />
<p class="caption">
图 8.27: 条件密度估计图
</p>
</div>
<p>岭线图是密度图的一种变体，可以防止密度曲线重叠在一起</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="dv-ggplot2.html#cb495-1"></a><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></span>
<span id="cb495-2"><a href="dv-ggplot2.html#cb495-2"></a><span class="st">  </span>ggridges<span class="op">::</span><span class="kw">geom_density_ridges</span>(<span class="kw">aes</span>(<span class="dt">x =</span> price, <span class="dt">y =</span> color, <span class="dt">fill =</span> color))</span>
<span id="cb495-3"><a href="dv-ggplot2.html#cb495-3"></a><span class="co">#&gt; Picking joint bandwidth of 535</span></span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-35-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>二维的密度图又是一种延伸</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="dv-ggplot2.html#cb496-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span></span>
<span id="cb496-2"><a href="dv-ggplot2.html#cb496-2"></a><span class="st">  </span><span class="kw">geom_density_2d</span>(<span class="kw">aes</span>(<span class="dt">color =</span> cut)) <span class="op">+</span></span>
<span id="cb496-3"><a href="dv-ggplot2.html#cb496-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-36-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p><code>stat</code> 函数，特别是 nlevel 参数，在密度曲线之间填充我们又可以得到热力图</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="dv-ggplot2.html#cb497-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span></span>
<span id="cb497-2"><a href="dv-ggplot2.html#cb497-2"></a><span class="st">  </span><span class="kw">stat_density_2d</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> <span class="kw">stat</span>(nlevel)), <span class="dt">geom =</span> <span class="st">&quot;polygon&quot;</span>) <span class="op">+</span></span>
<span id="cb497-3"><a href="dv-ggplot2.html#cb497-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>cut)</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-37-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p><code>gemo_hex</code> 也是二维密度图的一种变体，特别适合数据量比较大的情形</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="dv-ggplot2.html#cb498-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_hex</span>() <span class="op">+</span></span>
<span id="cb498-2"><a href="dv-ggplot2.html#cb498-2"></a><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>()</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-38-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-rose" class="section level3">
<h3><span class="header-section-number">9.2.9</span> 玫瑰图</h3>
<p>南丁格尔风玫瑰图<a href="99-references.html#fn31" class="footnote-ref" id="fnref31"><sup>31</sup></a> 可以作为堆积条形图，分组条形图</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="dv-ggplot2.html#cb499-1"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">fill =</span> clarity)) <span class="op">+</span></span>
<span id="cb499-2"><a href="dv-ggplot2.html#cb499-2"></a><span class="st">  </span><span class="kw">geom_bar</span>()</span>
<span id="cb499-3"><a href="dv-ggplot2.html#cb499-3"></a><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">fill =</span> clarity)) <span class="op">+</span></span>
<span id="cb499-4"><a href="dv-ggplot2.html#cb499-4"></a><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></span>
<span id="cb499-5"><a href="dv-ggplot2.html#cb499-5"></a><span class="st">  </span><span class="kw">coord_polar</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:stack-to-rose"></span>
<img src="dv-ggplot2_files/figure-html/stack-to-rose-1.png" alt="堆积条形图转风玫瑰图" width="70%" /><img src="dv-ggplot2_files/figure-html/stack-to-rose-2.png" alt="堆积条形图转风玫瑰图" width="70%" />
<p class="caption">
图 9.37: 堆积条形图转风玫瑰图
</p>
</div>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="dv-ggplot2.html#cb500-1"></a><span class="co"># 风玫瑰图 http://blog.csdn.net/Bone_ACE/article/details/47624987</span></span>
<span id="cb500-2"><a href="dv-ggplot2.html#cb500-2"></a><span class="kw">set.seed</span>(<span class="dv">2018</span>)</span>
<span id="cb500-3"><a href="dv-ggplot2.html#cb500-3"></a><span class="co"># 随机生成100次风向，并汇集到16个区间内</span></span>
<span id="cb500-4"><a href="dv-ggplot2.html#cb500-4"></a>direction &lt;-<span class="st"> </span><span class="kw">cut_interval</span>(<span class="kw">runif</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">360</span>), <span class="dt">n =</span> <span class="dv">16</span>)</span>
<span id="cb500-5"><a href="dv-ggplot2.html#cb500-5"></a><span class="co"># 随机生成100次风速，并划分成4种强度</span></span>
<span id="cb500-6"><a href="dv-ggplot2.html#cb500-6"></a>mag &lt;-<span class="st"> </span><span class="kw">cut_interval</span>(<span class="kw">rgamma</span>(<span class="dv">100</span>, <span class="dv">15</span>), <span class="dv">4</span>)</span>
<span id="cb500-7"><a href="dv-ggplot2.html#cb500-7"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">direction =</span> direction, <span class="dt">mag =</span> mag)</span>
<span id="cb500-8"><a href="dv-ggplot2.html#cb500-8"></a><span class="co"># 将风向映射到X轴，频数映射到Y轴，风速大小映射到填充色，生成条形图后再转为极坐标形式即可</span></span>
<span id="cb500-9"><a href="dv-ggplot2.html#cb500-9"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> direction, <span class="dt">y =</span> ..count.., <span class="dt">fill =</span> mag))</span>
<span id="cb500-10"><a href="dv-ggplot2.html#cb500-10"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb500-11"><a href="dv-ggplot2.html#cb500-11"></a><span class="st">  </span><span class="kw">coord_polar</span>() <span class="op">+</span></span>
<span id="cb500-12"><a href="dv-ggplot2.html#cb500-12"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></span>
<span id="cb500-13"><a href="dv-ggplot2.html#cb500-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Magnitude&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:wind-rose"></span>
<img src="dv-ggplot2_files/figure-html/wind-rose-1.png" alt="风玫瑰图" width="70%" />
<p class="caption">
图 9.38: 风玫瑰图
</p>
</div>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="dv-ggplot2.html#cb501-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span></span>
<span id="cb501-2"><a href="dv-ggplot2.html#cb501-2"></a><span class="st">  </span><span class="kw">coord_polar</span>() <span class="op">+</span></span>
<span id="cb501-3"><a href="dv-ggplot2.html#cb501-3"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></span>
<span id="cb501-4"><a href="dv-ggplot2.html#cb501-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Magnitude&quot;</span>)</span></code></pre></div>
<p><img src="dv-ggplot2_files/figure-html/unnamed-chunk-39-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-wordcloud" class="section level3">
<h3><span class="header-section-number">9.2.10</span> 词云图</h3>
<p>词云 <a href="https://github.com/lepennec/ggwordcloud">ggwordcloud</a></p>
</div>
</div>
<div id="ggplot2-session-info" class="section level2">
<h2><span class="header-section-number">9.3</span> 运行环境</h2>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="dv-ggplot2.html#cb502-1"></a>xfun<span class="op">::</span><span class="kw">session_info</span>(</span>
<span id="cb502-2"><a href="dv-ggplot2.html#cb502-2"></a>  <span class="dt">packages =</span> <span class="kw">c</span>(</span>
<span id="cb502-3"><a href="dv-ggplot2.html#cb502-3"></a>    <span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;magrittr&quot;</span>, <span class="st">&quot;colorspace&quot;</span>,</span>
<span id="cb502-4"><a href="dv-ggplot2.html#cb502-4"></a>    <span class="st">&quot;nlme&quot;</span>, <span class="st">&quot;mgcv&quot;</span>, <span class="st">&quot;ggbeeswarm&quot;</span>, <span class="st">&quot;ggridges&quot;</span>, <span class="st">&quot;hexbin&quot;</span></span>
<span id="cb502-5"><a href="dv-ggplot2.html#cb502-5"></a>  )</span>
<span id="cb502-6"><a href="dv-ggplot2.html#cb502-6"></a>)</span>
<span id="cb502-7"><a href="dv-ggplot2.html#cb502-7"></a><span class="co">#&gt; R version 3.6.1 (2019-07-05)</span></span>
<span id="cb502-8"><a href="dv-ggplot2.html#cb502-8"></a><span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span id="cb502-9"><a href="dv-ggplot2.html#cb502-9"></a><span class="co">#&gt; Running under: Debian GNU/Linux 10 (buster)</span></span>
<span id="cb502-10"><a href="dv-ggplot2.html#cb502-10"></a><span class="co">#&gt; </span></span>
<span id="cb502-11"><a href="dv-ggplot2.html#cb502-11"></a><span class="co">#&gt; Locale:</span></span>
<span id="cb502-12"><a href="dv-ggplot2.html#cb502-12"></a><span class="co">#&gt;   LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span id="cb502-13"><a href="dv-ggplot2.html#cb502-13"></a><span class="co">#&gt;   LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span id="cb502-14"><a href="dv-ggplot2.html#cb502-14"></a><span class="co">#&gt;   LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span id="cb502-15"><a href="dv-ggplot2.html#cb502-15"></a><span class="co">#&gt;   LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span id="cb502-16"><a href="dv-ggplot2.html#cb502-16"></a><span class="co">#&gt;   LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span id="cb502-17"><a href="dv-ggplot2.html#cb502-17"></a><span class="co">#&gt;   LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span id="cb502-18"><a href="dv-ggplot2.html#cb502-18"></a><span class="co">#&gt; </span></span>
<span id="cb502-19"><a href="dv-ggplot2.html#cb502-19"></a><span class="co">#&gt; Package version:</span></span>
<span id="cb502-20"><a href="dv-ggplot2.html#cb502-20"></a><span class="co">#&gt;   assertthat_0.2.1   backports_1.1.4    beeswarm_0.2.3    </span></span>
<span id="cb502-21"><a href="dv-ggplot2.html#cb502-21"></a><span class="co">#&gt;   cli_1.1.0          colorspace_1.4-1   crayon_1.3.4      </span></span>
<span id="cb502-22"><a href="dv-ggplot2.html#cb502-22"></a><span class="co">#&gt;   digest_0.6.20      ellipsis_0.2.0.1   fansi_0.4.0       </span></span>
<span id="cb502-23"><a href="dv-ggplot2.html#cb502-23"></a><span class="co">#&gt;   ggbeeswarm_0.6.0   ggplot2_3.2.0      ggridges_0.5.1    </span></span>
<span id="cb502-24"><a href="dv-ggplot2.html#cb502-24"></a><span class="co">#&gt;   glue_1.3.1         graphics_3.6.1     grDevices_3.6.1   </span></span>
<span id="cb502-25"><a href="dv-ggplot2.html#cb502-25"></a><span class="co">#&gt;   grid_3.6.1         gtable_0.3.0       hexbin_1.27.3     </span></span>
<span id="cb502-26"><a href="dv-ggplot2.html#cb502-26"></a><span class="co">#&gt;   labeling_0.3       lattice_0.20.38    lazyeval_0.2.2    </span></span>
<span id="cb502-27"><a href="dv-ggplot2.html#cb502-27"></a><span class="co">#&gt;   magrittr_1.5       MASS_7.3.51.4      Matrix_1.2.17     </span></span>
<span id="cb502-28"><a href="dv-ggplot2.html#cb502-28"></a><span class="co">#&gt;   methods_3.6.1      mgcv_1.8.28        munsell_0.5.0     </span></span>
<span id="cb502-29"><a href="dv-ggplot2.html#cb502-29"></a><span class="co">#&gt;   nlme_3.1.140       pillar_1.4.2       pkgconfig_2.0.2   </span></span>
<span id="cb502-30"><a href="dv-ggplot2.html#cb502-30"></a><span class="co">#&gt;   plyr_1.8.4         R6_2.4.0           RColorBrewer_1.1.2</span></span>
<span id="cb502-31"><a href="dv-ggplot2.html#cb502-31"></a><span class="co">#&gt;   Rcpp_1.0.2         reshape2_1.4.3     rlang_0.4.0       </span></span>
<span id="cb502-32"><a href="dv-ggplot2.html#cb502-32"></a><span class="co">#&gt;   scales_1.0.0       splines_3.6.1      stats_3.6.1       </span></span>
<span id="cb502-33"><a href="dv-ggplot2.html#cb502-33"></a><span class="co">#&gt;   stringi_1.4.3      stringr_1.4.0      tibble_2.1.3      </span></span>
<span id="cb502-34"><a href="dv-ggplot2.html#cb502-34"></a><span class="co">#&gt;   tools_3.6.1        utf8_1.1.4         utils_3.6.1       </span></span>
<span id="cb502-35"><a href="dv-ggplot2.html#cb502-35"></a><span class="co">#&gt;   vctrs_0.2.0        vipor_0.4.5        viridisLite_0.3.0 </span></span>
<span id="cb502-36"><a href="dv-ggplot2.html#cb502-36"></a><span class="co">#&gt;   withr_2.1.2        zeallot_0.1.0</span></span></code></pre></div>

</div>
</div>
<script>
window.onload = function() {

  var imgs = document.querySelectorAll('img');

  // Upon clicking an image, open a new window with the
  // dimensions of the image, pointing the `data-url` link
  var on_click = function (e) {
    var d = e.target.dataset || {};
    if (d.url) {
      // Add some extra height for the modebar
      var height = 'height=' + (e.target.clientHeight * 1.05);
      var width = 'width=' + e.target.clientWidth;
      var param = 'location=yes,' + height + ',' + width + ',scrollbars=yes,status=yes';
      window.open(e.target.dataset.url, '_blank', param);
    }
  };

  var on_hover = function (e) {
    var d = e.target.dataset || {};
    if (d.url) {
      e.target.style.cursor = 'pointer';
    }
  };

  for (var i = 0; i < imgs.length; i++) {
    imgs[i].addEventListener('click', on_click);
    imgs[i].addEventListener('mouseover', on_hover);
  }
};
</script>
            </section>

          </div>
        </div>
      </div>
<a href="dv-plot.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dv-plotly.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/XiangyunHuang/RGraphics/edit/master/dv-ggplot2.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
