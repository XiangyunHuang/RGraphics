# 交互式图形 {#interactive-graphics}

## plotly

```r
library(plotly, warn.conflicts = FALSE, quietly = TRUE)
p1 <- plot_ly(diamonds, x = ~price) %>% add_histogram(name = "plotly.js")

price_hist <- function(method = "FD") {
  h <- hist(diamonds$price, breaks = method, plot = FALSE)
  plot_ly(x = h$mids, y = h$counts) %>% add_bars(name = method)
}

subplot(
  p1, price_hist(), price_hist("Sturges"),  price_hist("Scott"),
  nrows = 4, shareX = TRUE
)
```

Orca (Open-source Report Creator App) 软件针对 plotly.js 库渲染的图形具有很强的导出功能，[安装 Orca](https://github.com/plotly/orca#installation) 后，`plotly::orca` 函数可以将基于 htmlwidget 的 plotly 图形对象导出为高质量静态图片，支持导出 png、pdf 和 svg 等格式。

```{r bars-numeric, echo = FALSE, fig.cap = "(ref:bars-numeric)", out.extra = ifelse(is_latex,'','data-url="/interactives/bars-numeric.html"')}
knitr::include_graphics("interactives/bars-numeric.svg")
```

(ref:bars-numeric) 直方图


## 饼图 {#sec:pie}

```{r}
library(ggplot2)
library(plotly)

USPersonalExpenditure <- data.frame("Categorie" = rownames(USPersonalExpenditure), USPersonalExpenditure)
data <- USPersonalExpenditure[, c("Categorie", "X1960")]

colors <- c("rgb(211,94,96)", "rgb(128,133,133)", "rgb(144,103,167)", "rgb(171,104,87)", "rgb(114,147,203)")

p <- plot_ly(data,
  labels = ~Categorie, values = ~X1960, type = "pie",
  textposition = "inside",
  textinfo = "label+percent",
  insidetextfont = list(color = "#FFFFFF"),
  hoverinfo = "text",
  text = ~ paste("$", X1960, " billions"),
  marker = list(
    colors = colors,
    line = list(color = "#FFFFFF", width = 1)
  ),
  # The 'pull' attribute can also be used to create space between the sectors
  showlegend = FALSE
) %>%
  layout(
    title = "United States Personal Expenditures by Categories in 1960",
    xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
    yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE)
  )

p
```

